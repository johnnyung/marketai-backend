[
  {
    "file": "src/routes/analyticsRoutes.ts",
    "line": 42,
    "code": "await catalystHunterService.huntInsiderPlays();"
  },
  {
    "file": "src/routes/brain.ts",
    "line": 4,
    "code": "import fmpService from '../services/fmpService.js';"
  },
  {
    "file": "src/routes/brain.ts",
    "line": 21,
    "code": "* HELPER: Map FMP Capabilities to Source Status objects"
  },
  {
    "file": "src/routes/brain.ts",
    "line": 24,
    "code": "const caps = fmpService.capabilities;"
  },
  {
    "file": "src/routes/brain.ts",
    "line": 28,
    "code": "{ id: 'fmp', label: 'FMP Stable Feed', capKey: 'quote' },"
  },
  {
    "file": "src/routes/brain.ts",
    "line": 30,
    "code": "{ id: 'insider', label: 'Insider Trades', capKey: 'insider' },"
  },
  {
    "file": "src/routes/brain.ts",
    "line": 31,
    "code": "{ id: 'institutional', label: 'Institutional', capKey: 'institutional' },"
  },
  {
    "file": "src/routes/brain.ts",
    "line": 32,
    "code": "{ id: 'economic', label: 'Macro Economic', capKey: 'economic' },"
  },
  {
    "file": "src/routes/brain.ts",
    "line": 33,
    "code": "{ id: 'options', label: 'Options Flow', capKey: 'options' },"
  },
  {
    "file": "src/routes/brain.ts",
    "line": 64,
    "code": "notes = 'Not included in FMP Plan';"
  },
  {
    "file": "src/routes/brain.ts",
    "line": 98,
    "code": "if (fmpService.capabilities.quote === 'UNKNOWN') {"
  },
  {
    "file": "src/routes/brain.ts",
    "line": 99,
    "code": "await fmpService.getPrice('AAPL'); // Wake up FMP"
  },
  {
    "file": "src/routes/calendar.ts",
    "line": 3,
    "code": "import economicCalendarService from '../services/economicCalendarService.js';"
  },
  {
    "file": "src/routes/calendar.ts",
    "line": 7,
    "code": "// GET /api/calendar/events - Get economic calendar events"
  },
  {
    "file": "src/routes/calendar.ts",
    "line": 16,
    "code": "FROM economic_events"
  },
  {
    "file": "src/routes/calendar.ts",
    "line": 58,
    "code": "FROM economic_events"
  },
  {
    "file": "src/routes/calendar.ts",
    "line": 77,
    "code": "FROM economic_events"
  },
  {
    "file": "src/routes/calendar.ts",
    "line": 93,
    "code": "const result = await economicCalendarService.fetchAndStoreEvents();"
  },
  {
    "file": "src/routes/calendar.ts",
    "line": 112,
    "code": "const result = await economicCalendarService.fetchAndStoreEvents();"
  },
  {
    "file": "src/routes/calendar.ts",
    "line": 123,
    "code": "// POST /api/calendar/events - Add economic event (admin only)"
  },
  {
    "file": "src/routes/calendar.ts",
    "line": 140,
    "code": "`INSERT INTO economic_events ("
  },
  {
    "file": "src/routes/commandCenterRoutes.ts",
    "line": 19,
    "code": "COALESCE(SUM(CASE WHEN category = 'insider' THEN 1 ELSE 0 END), 0) as insider,"
  },
  {
    "file": "src/routes/cryptoCorrelationRoutes.ts",
    "line": 314,
    "code": "AVG((ticker_data->>'historical_accuracy')::float) as avg_accuracy,"
  },
  {
    "file": "src/routes/dailyIntelligence.ts",
    "line": 28,
    "code": "economicIndicatorsCount: report.economicIndicators.length,"
  },
  {
    "file": "src/routes/dailyIntelligence.ts",
    "line": 67,
    "code": "economicIndicators: report.economic_indicators || [],"
  },
  {
    "file": "src/routes/dailyIntelligence.ts",
    "line": 157,
    "code": "economicIndicators: report.economic_indicators || [],"
  },
  {
    "file": "src/routes/dailyIntelligenceRoutes.ts",
    "line": 28,
    "code": "economicIndicatorsCount: report.economicIndicators.length,"
  },
  {
    "file": "src/routes/dailyIntelligenceRoutes.ts",
    "line": 66,
    "code": "economicIndicators: JSON.parse(report.economic_indicators || '[]'),"
  },
  {
    "file": "src/routes/dailyIntelligenceRoutes.ts",
    "line": 115,
    "code": "economicIndicators: JSON.parse(report.economic_indicators || '[]'),"
  },
  {
    "file": "src/routes/data.ts",
    "line": 22,
    "code": "insider: allData.filter(d => d.type === 'insider_trade'),"
  },
  {
    "file": "src/routes/data.ts",
    "line": 25,
    "code": "economic: allData.filter(d => d.type === 'economic'),"
  },
  {
    "file": "src/routes/data.ts",
    "line": 32,
    "code": "insider: grouped.insider.length,"
  },
  {
    "file": "src/routes/data.ts",
    "line": 35,
    "code": "economic: grouped.economic.length"
  },
  {
    "file": "src/routes/data.ts",
    "line": 72,
    "code": "* GET /api/data/insider"
  },
  {
    "file": "src/routes/data.ts",
    "line": 73,
    "code": "* Get insider trading activity (SEC Form 4)"
  },
  {
    "file": "src/routes/data.ts",
    "line": 75,
    "code": "router.get('/insider', async (req, res) => {"
  },
  {
    "file": "src/routes/data.ts",
    "line": 77,
    "code": "console.log('üëî [/data/insider] Fetching insider activity...');"
  },
  {
    "file": "src/routes/data.ts",
    "line": 79,
    "code": "const activity = await dataIngestionService.fetchInsiderActivity();"
  },
  {
    "file": "src/routes/data.ts",
    "line": 88,
    "code": "console.error('‚ùå [/data/insider] Error:', error);"
  },
  {
    "file": "src/routes/data.ts",
    "line": 89,
    "code": "res.status(500).json({ error: 'Failed to fetch insider data' });"
  },
  {
    "file": "src/routes/data.ts",
    "line": 138,
    "code": "* GET /api/data/economic"
  },
  {
    "file": "src/routes/data.ts",
    "line": 139,
    "code": "* Get economic calendar and events"
  },
  {
    "file": "src/routes/data.ts",
    "line": 141,
    "code": "router.get('/economic', async (req, res) => {"
  },
  {
    "file": "src/routes/data.ts",
    "line": 143,
    "code": "console.log('üìä [/data/economic] Fetching economic calendar...');"
  },
  {
    "file": "src/routes/data.ts",
    "line": 145,
    "code": "const events = await dataIngestionService.fetchEconomicCalendar();"
  },
  {
    "file": "src/routes/data.ts",
    "line": 154,
    "code": "console.error('‚ùå [/data/economic] Error:', error);"
  },
  {
    "file": "src/routes/data.ts",
    "line": 155,
    "code": "res.status(500).json({ error: 'Failed to fetch economic data' });"
  },
  {
    "file": "src/routes/data.ts",
    "line": 174,
    "code": "insider: tickerData.filter(d => d.type === 'insider_trade'),"
  },
  {
    "file": "src/routes/data.ts",
    "line": 201,
    "code": "insider: 'active',"
  },
  {
    "file": "src/routes/data.ts",
    "line": 204,
    "code": "economic: 'active'"
  },
  {
    "file": "src/routes/dataCollectionRoutes.ts",
    "line": 172,
    "code": "type: 'OPTIONS',"
  },
  {
    "file": "src/routes/debug/env.js",
    "line": 8,
    "code": "fmp_key_present: !!process.env.FMP_API_KEY,"
  },
  {
    "file": "src/routes/debug/envDebug.ts",
    "line": 7,
    "code": "FMP_API_KEY: process.env.FMP_API_KEY ? \"SET\" : \"MISSING\","
  },
  {
    "file": "src/routes/debug/fmpDebug.ts",
    "line": 2,
    "code": "import fmpService from \"../../services/fmpService.js\";"
  },
  {
    "file": "src/routes/debug/fmpDebug.ts",
    "line": 6,
    "code": "router.get(\"/fmp/quote/:ticker\", async (req, res) => {"
  },
  {
    "file": "src/routes/debug/fmpDebug.ts",
    "line": 8,
    "code": "const result = await fmpService.getPrice(req.params.ticker);"
  },
  {
    "file": "src/routes/debug/fmpDebug.ts",
    "line": 15,
    "code": "router.get(\"/fmp/test\", async (req, res) => {"
  },
  {
    "file": "src/routes/debug/fmpDebug.ts",
    "line": 16,
    "code": "const result = await fmpService.getPrice(\"AAPL\");"
  },
  {
    "file": "src/routes/debug/healthDebug.ts",
    "line": 2,
    "code": "import fmpService from \"../../services/fmpService.js\";"
  },
  {
    "file": "src/routes/debug/healthDebug.ts",
    "line": 9,
    "code": "fmp_key_present: !!process.env.FMP_API_KEY,"
  },
  {
    "file": "src/routes/debug/healthDebug.ts",
    "line": 10,
    "code": "fmp_quote: await fmpService.getPrice(\"AAPL\"),"
  },
  {
    "file": "src/routes/debug/index.ts",
    "line": 3,
    "code": "import fmpDebug from \"./fmpDebug.js\";"
  },
  {
    "file": "src/routes/debug/index.ts",
    "line": 10,
    "code": "router.use(\"/fmp\", fmpDebug);"
  },
  {
    "file": "src/routes/debug.ts",
    "line": 2,
    "code": "import fmpService from '../services/fmpService.js';"
  },
  {
    "file": "src/routes/debug.ts",
    "line": 17,
    "code": "hasFmpKey: !!process.env.FMP_API_KEY,"
  },
  {
    "file": "src/routes/debug.ts",
    "line": 22,
    "code": "// Direct FMP quote test: /api/debug/fmp/quote/AAPL"
  },
  {
    "file": "src/routes/debug.ts",
    "line": 23,
    "code": "router.get('/fmp/quote/:ticker', async (req, res) => {"
  },
  {
    "file": "src/routes/debug.ts",
    "line": 26,
    "code": "const quote = await fmpService.getPrice(ticker);"
  },
  {
    "file": "src/routes/debug.ts",
    "line": 27,
    "code": "res.json({ ok: !!quote, ticker, quote });"
  },
  {
    "file": "src/routes/debug.ts",
    "line": 29,
    "code": "console.error('[DEBUG] FMP quote error:', err.message);"
  },
  {
    "file": "src/routes/debug.ts",
    "line": 48,
    "code": "const [fmpStatus, universe] = await Promise.all(["
  },
  {
    "file": "src/routes/debug.ts",
    "line": 49,
    "code": "fmpService.checkConnection(),"
  },
  {
    "file": "src/routes/debug.ts",
    "line": 54,
    "code": "fmp: fmpStatus,"
  },
  {
    "file": "src/routes/debug.ts",
    "line": 61,
    "code": "res.json({ ok: !!fmpStatus.success, health });"
  },
  {
    "file": "src/routes/debugEnv.ts",
    "line": 9,
    "code": "FMP_ENV_PRESENT: !!process.env.FMP_API_KEY,"
  },
  {
    "file": "src/routes/debugEnv.ts",
    "line": 10,
    "code": "raw_key_start: process.env.FMP_API_KEY ? process.env.FMP_API_KEY.substring(0, 5) + '...' : 'NULL',"
  },
  {
    "file": "src/routes/debugFmp.ts",
    "line": 2,
    "code": "import fmpService from '../services/fmpService.js';"
  },
  {
    "file": "src/routes/debugFmp.ts",
    "line": 6,
    "code": "router.get('/fmp/:ticker', async (req, res) => {"
  },
  {
    "file": "src/routes/debugFmp.ts",
    "line": 11,
    "code": "const price = await fmpService.getPrice(ticker);"
  },
  {
    "file": "src/routes/debugFmp.ts",
    "line": 14,
    "code": "const debugInfo = fmpService.lastDebug || {};"
  },
  {
    "file": "src/routes/digestCleanup.ts",
    "line": 193,
    "code": "timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,"
  },
  {
    "file": "src/routes/eventIntelligenceRoutes.ts",
    "line": 40,
    "code": "async function getHistoricalContext(notes: string) {"
  },
  {
    "file": "src/routes/eventIntelligenceRoutes.ts",
    "line": 47,
    "code": "FROM historical_events"
  },
  {
    "file": "src/routes/eventIntelligenceRoutes.ts",
    "line": 63,
    "code": "const history = await getHistoricalContext(notes);"
  },
  {
    "file": "src/routes/eventIntelligenceRoutes.ts",
    "line": 87,
    "code": "\"historical_parallels\": ["
  },
  {
    "file": "src/routes/eventIntelligenceRoutes.ts",
    "line": 123,
    "code": "JSON.stringify(analysis.historical_parallels),"
  },
  {
    "file": "src/routes/events.ts",
    "line": 5,
    "code": "// GET /api/events/calendar - Get economic calendar"
  },
  {
    "file": "src/routes/events.ts",
    "line": 7,
    "code": "// TODO: Integrate with economic calendar API"
  },
  {
    "file": "src/routes/fundamentalsRoutes.ts",
    "line": 3,
    "code": "import fmpService from '../services/fmpService.js';"
  },
  {
    "file": "src/routes/fundamentalsRoutes.ts",
    "line": 31,
    "code": "router.get('/profile/:ticker', authenticateToken, async (req, res) => {"
  },
  {
    "file": "src/routes/fundamentalsRoutes.ts",
    "line": 33,
    "code": "const profile = await fmpService.getCompanyProfile(req.params.ticker);"
  },
  {
    "file": "src/routes/fundamentalsRoutes.ts",
    "line": 34,
    "code": "res.json({ success: true, data: profile });"
  },
  {
    "file": "src/routes/fundamentalsRoutes.ts",
    "line": 43,
    "code": "const [income, balance, cash, ratios] = await Promise.all(["
  },
  {
    "file": "src/routes/fundamentalsRoutes.ts",
    "line": 44,
    "code": "fmpService.getIncomeStatement(ticker),"
  },
  {
    "file": "src/routes/fundamentalsRoutes.ts",
    "line": 45,
    "code": "fmpService.getBalanceSheet(ticker),"
  },
  {
    "file": "src/routes/fundamentalsRoutes.ts",
    "line": 46,
    "code": "fmpService.getCashFlowStatement(ticker),"
  },
  {
    "file": "src/routes/fundamentalsRoutes.ts",
    "line": 47,
    "code": "fmpService.getFinancialRatios(ticker)"
  },
  {
    "file": "src/routes/fundamentalsRoutes.ts",
    "line": 49,
    "code": "res.json({ success: true, data: { income, balance, cash, ratios } });"
  },
  {
    "file": "src/routes/health.ts",
    "line": 2,
    "code": "import fmpService from '../services/fmpService.js';"
  },
  {
    "file": "src/routes/health.ts",
    "line": 6,
    "code": "// GET /api/health/fmp"
  },
  {
    "file": "src/routes/health.ts",
    "line": 7,
    "code": "router.get('/fmp', async (req, res) => {"
  },
  {
    "file": "src/routes/health.ts",
    "line": 10,
    "code": "if (fmpService.capabilities.quote === 'UNKNOWN') {"
  },
  {
    "file": "src/routes/health.ts",
    "line": 11,
    "code": "await fmpService.getPrice('AAPL');"
  },
  {
    "file": "src/routes/health.ts",
    "line": 14,
    "code": "const key = process.env.FMP_API_KEY || '';"
  },
  {
    "file": "src/routes/health.ts",
    "line": 15,
    "code": "const debug = fmpService.lastDebug || {};"
  },
  {
    "file": "src/routes/health.ts",
    "line": 18,
    "code": "const capList = Object.entries(fmpService.capabilities).map(([key, val]) => ({"
  },
  {
    "file": "src/routes/health.ts",
    "line": 27,
    "code": "status: fmpService.capabilities.quote === 'OK' ? \"ONLINE\" : \"ERROR\","
  },
  {
    "file": "src/routes/health.ts",
    "line": 28,
    "code": "prefix: \"/api/latest\","
  },
  {
    "file": "src/routes/historyRoutes.ts",
    "line": 20,
    "code": "const result = await pool.query('SELECT * FROM historical_events ORDER BY event_date DESC');"
  },
  {
    "file": "src/routes/ingestionRoutes.ts",
    "line": 3,
    "code": "import insiderService from '../services/ingestion/insiderIngestionService.js';"
  },
  {
    "file": "src/routes/ingestionRoutes.ts",
    "line": 4,
    "code": "import economicService from '../services/ingestion/economicIngestionService.js';"
  },
  {
    "file": "src/routes/ingestionRoutes.ts",
    "line": 5,
    "code": "import institutionalService from '../services/ingestion/institutionalIngestionService.js';"
  },
  {
    "file": "src/routes/ingestionRoutes.ts",
    "line": 6,
    "code": "import optionsService from '../services/ingestion/optionsIngestionService.js';"
  },
  {
    "file": "src/routes/ingestionRoutes.ts",
    "line": 10,
    "code": "import historicalService from '../services/ingestion/historicalIngestionService.js';"
  },
  {
    "file": "src/routes/ingestionRoutes.ts",
    "line": 34,
    "code": "router.post('/insider', (req, res) => runIngest(res, insiderService, 'Insider'));"
  },
  {
    "file": "src/routes/ingestionRoutes.ts",
    "line": 35,
    "code": "router.post('/economic', (req, res) => runIngest(res, economicService, 'Economic'));"
  },
  {
    "file": "src/routes/ingestionRoutes.ts",
    "line": 36,
    "code": "router.post('/institutional', (req, res) => runIngest(res, institutionalService, 'Institutional'));"
  },
  {
    "file": "src/routes/ingestionRoutes.ts",
    "line": 37,
    "code": "router.post('/options', (req, res) => runIngest(res, optionsService, 'Options'));"
  },
  {
    "file": "src/routes/ingestionRoutes.ts",
    "line": 47,
    "code": "router.post('/historical', (req, res) => runIngest(res, historicalService, 'Historical Events'));"
  },
  {
    "file": "src/routes/ingestionRoutes.ts",
    "line": 54,
    "code": "insiderService.run(),"
  },
  {
    "file": "src/routes/ingestionRoutes.ts",
    "line": 55,
    "code": "economicService.run()"
  },
  {
    "file": "src/routes/insiderRoutes.ts",
    "line": 2,
    "code": "import insiderIntentService from '../services/insiderIntentService.js';"
  },
  {
    "file": "src/routes/insiderRoutes.ts",
    "line": 6,
    "code": "const result = await insiderIntentService.analyzeIntent(req.params.ticker);"
  },
  {
    "file": "src/routes/market.ts",
    "line": 17,
    "code": "// GET /api/market/quote/:ticker - Get detailed quote"
  },
  {
    "file": "src/routes/market.ts",
    "line": 18,
    "code": "router.get('/quote/:ticker', async (req, res) => {"
  },
  {
    "file": "src/routes/market.ts",
    "line": 21,
    "code": "const quote = await alphaVantageService.getStockQuote(ticker);"
  },
  {
    "file": "src/routes/market.ts",
    "line": 22,
    "code": "res.json(quote);"
  },
  {
    "file": "src/routes/marketPriceRoutes.ts",
    "line": 12,
    "code": "`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${ticker}&apikey=${ALPHA_VANTAGE_KEY"
  },
  {
    "file": "src/routes/marketPriceRoutes.ts",
    "line": 15,
    "code": "const price = parseFloat(data['Global Quote']?.['05. price'] || '0');"
  },
  {
    "file": "src/routes/marketPriceRoutes.ts",
    "line": 16,
    "code": "const change = parseFloat(data['Global Quote']?.['09. change'] || '0');"
  },
  {
    "file": "src/routes/marketPriceRoutes.ts",
    "line": 17,
    "code": "const changePercent = parseFloat(data['Global Quote']?.['10. change percent']?.replace('%', '') || '"
  },
  {
    "file": "src/routes/options.ts",
    "line": 2,
    "code": "import unusualOptionsEngine from \"../services/unusualOptionsEngine.js\";"
  },
  {
    "file": "src/routes/options.ts",
    "line": 9,
    "code": "const result = await unusualOptionsEngine.analyze(ticker);"
  },
  {
    "file": "src/routes/portfolio.ts",
    "line": 14,
    "code": "metrics: {"
  },
  {
    "file": "src/routes/realDeepDiveRoutes.ts",
    "line": 16,
    "code": "`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${ticker}&apikey=${process.env.ALPHA"
  },
  {
    "file": "src/routes/realDeepDiveRoutes.ts",
    "line": 19,
    "code": "const currentPrice = parseFloat(priceData['Global Quote']?.['05. price'] || '0');"
  },
  {
    "file": "src/routes/realDeepDiveRoutes.ts",
    "line": 56,
    "code": "const historical = await pool.query(`"
  },
  {
    "file": "src/routes/realDeepDiveRoutes.ts",
    "line": 57,
    "code": "SELECT * FROM historical_events ORDER BY collected_at DESC LIMIT 5"
  },
  {
    "file": "src/routes/realDeepDiveRoutes.ts",
    "line": 81,
    "code": "**HISTORICAL PATTERNS:**"
  },
  {
    "file": "src/routes/realDeepDiveRoutes.ts",
    "line": 82,
    "code": "${JSON.stringify(historical.rows, null, 2)}"
  },
  {
    "file": "src/routes/realDeepDiveRoutes.ts",
    "line": 146,
    "code": "\"insider_ownership\": 10,"
  },
  {
    "file": "src/routes/realDeepDiveRoutes.ts",
    "line": 147,
    "code": "\"recent_insider_trades\": [],"
  },
  {
    "file": "src/routes/system.ts",
    "line": 28,
    "code": "if (process.env.FMP_API_KEY) {"
  },
  {
    "file": "src/routes/systemStatusRoutes.ts",
    "line": 22,
    "code": "{ id: 'fmp', name: 'FMP', display: 'FMP Data' },"
  },
  {
    "file": "src/routes/systemStatusRoutes.ts",
    "line": 34,
    "code": "const table = source.id === 'research_agent' ? 'historical_events' : 'pattern_matches';"
  },
  {
    "file": "src/schedulers/calendarScheduler.ts",
    "line": 3,
    "code": "import economicCalendarService from '../services/economicCalendarService.js';"
  },
  {
    "file": "src/schedulers/calendarScheduler.ts",
    "line": 11,
    "code": "console.log('üìÖ Running scheduled economic calendar update...');"
  },
  {
    "file": "src/schedulers/calendarScheduler.ts",
    "line": 13,
    "code": "const result = await economicCalendarService.fetchAndStoreEvents();"
  },
  {
    "file": "src/schedulers/calendarScheduler.ts",
    "line": 20,
    "code": "console.log('üìÖ Economic calendar scheduler started (daily 6 AM UTC)');"
  },
  {
    "file": "src/schedulers/calendarScheduler.ts",
    "line": 27,
    "code": "console.log('üìÖ Running economic calendar update now...');"
  },
  {
    "file": "src/schedulers/calendarScheduler.ts",
    "line": 28,
    "code": "const result = await economicCalendarService.fetchAndStoreEvents();"
  },
  {
    "file": "src/scripts/add_expiry_column.ts",
    "line": 16,
    "code": "ADD COLUMN IF NOT EXISTS volatility_profile VARCHAR(20); -- 'High', 'Medium', 'Low'"
  },
  {
    "file": "src/scripts/add_history_constraint.ts",
    "line": 12,
    "code": "console.log('üîß Fixing historical_events table constraints...');"
  },
  {
    "file": "src/scripts/add_history_constraint.ts",
    "line": 19,
    "code": "DELETE FROM historical_events a USING ("
  },
  {
    "file": "src/scripts/add_history_constraint.ts",
    "line": 21,
    "code": "FROM historical_events"
  },
  {
    "file": "src/scripts/add_history_constraint.ts",
    "line": 32,
    "code": "ALTER TABLE historical_events"
  },
  {
    "file": "src/scripts/add_history_constraint.ts",
    "line": 33,
    "code": "ADD CONSTRAINT historical_events_event_key UNIQUE (event);"
  },
  {
    "file": "src/scripts/apply_schema_fix.ts",
    "line": 26,
    "code": "`CREATE TABLE IF NOT EXISTS insider_intent_logs ("
  },
  {
    "file": "src/scripts/audit/contract_validator.ts",
    "line": 26,
    "code": "{ route: '/api/insider/intent/AAPL', verb: 'GET', expected_keys: ['success', 'data.classification'] "
  },
  {
    "file": "src/scripts/audit/db_x_advanced.ts",
    "line": 20,
    "code": "'historical_events',"
  },
  {
    "file": "src/scripts/audit/db_x_scan.ts",
    "line": 8,
    "code": "const tables = ['ai_stock_tips', 'trades', 'digest_entries', 'historical_events', 'correlation_patte"
  },
  {
    "file": "src/scripts/audit/deep_brain_check.ts",
    "line": 11,
    "code": "insider: 50,"
  },
  {
    "file": "src/scripts/audit/deep_brain_stress.ts",
    "line": 11,
    "code": "insider: 0, // Should be ignored by dynamic scoring"
  },
  {
    "file": "src/scripts/audit/deep_brain_stress.ts",
    "line": 25,
    "code": "if (consensus.breakdown['insider'] !== 0) {"
  },
  {
    "file": "src/scripts/audit/deep_brain_wiring.ts",
    "line": 10,
    "code": "insider: 55,"
  },
  {
    "file": "src/scripts/audit/e2e_flow.ts",
    "line": 19,
    "code": "{ path: \"/api/insider/intent/AAPL\", label: \"Insider Intent\" },"
  },
  {
    "file": "src/scripts/audit/e2e_lifecycle_test.ts",
    "line": 36,
    "code": "const quote = await marketDataService.getStockPrice(TICKER);"
  },
  {
    "file": "src/scripts/audit/e2e_lifecycle_test.ts",
    "line": 37,
    "code": "if (!quote || quote.price === 0) throw new Error(\"Market Data Service returned null\");"
  },
  {
    "file": "src/scripts/audit/e2e_lifecycle_test.ts",
    "line": 38,
    "code": "timeline.push({ hop: '1. Raw Ingestion', status: 'PASS', latency_ms: Date.now() - t1, details: `Fetc"
  },
  {
    "file": "src/scripts/audit/e2e_lifecycle_test.ts",
    "line": 46,
    "code": "`, [JSON.stringify(quote)]);"
  },
  {
    "file": "src/scripts/audit/e2e_lifecycle_test.ts",
    "line": 83,
    "code": "`, [TICKER, quote.price]);"
  },
  {
    "file": "src/scripts/audit/e2e_signal_flow.ts",
    "line": 76,
    "code": "path: '/api/insider',"
  },
  {
    "file": "src/scripts/audit/e2e_signal_flow.ts",
    "line": 77,
    "code": "name: 'Insider Engines',"
  },
  {
    "file": "src/scripts/audit/execution_simulation.ts",
    "line": 61,
    "code": "const quote = await marketDataService.getStockPrice(trade.ticker);"
  },
  {
    "file": "src/scripts/audit/execution_simulation.ts",
    "line": 62,
    "code": "const price = quote?.price || 100;"
  },
  {
    "file": "src/scripts/audit/execution_simulation.ts",
    "line": 63,
    "code": "tradeLog.steps.price_check = { price, source: quote?.source || 'Mock' };"
  },
  {
    "file": "src/scripts/audit/final_integration_verify.ts",
    "line": 111,
    "code": "console.log(\"      ‚ö†Ô∏è  Warning: Recent signals lack advanced metrics (System might be warming up)\");"
  },
  {
    "file": "src/scripts/audit/full_stack_integrity.ts",
    "line": 15,
    "code": "{ file: 'services/comprehensiveDataEngine.ts', calls: 'insiderIntentService.analyzeIntent', desc: 'I"
  },
  {
    "file": "src/scripts/audit/ingestion_fallback_check.ts",
    "line": 8,
    "code": "const quote = await marketDataService.getStockPrice('AAPL');"
  },
  {
    "file": "src/scripts/audit/ingestion_fallback_check.ts",
    "line": 9,
    "code": "if (!quote) throw new Error(\"Ingestion failed to return data\");"
  },
  {
    "file": "src/scripts/audit/ingestion_fallback_check.ts",
    "line": 10,
    "code": "console.log(`‚úÖ Ingestion Active: ${quote.source}`);"
  },
  {
    "file": "src/scripts/audit/ingestion_fallback_test.ts",
    "line": 4,
    "code": "console.log(\"üåê Ingestion Cortex: Testing FMP ‚Üí Tiingo ‚Üí Yahoo fallback chain...\");"
  },
  {
    "file": "src/scripts/audit/ingestion_fallback_test.ts",
    "line": 8,
    "code": "const fmp = (await import('../../services/fmpService.js')).default;"
  },
  {
    "file": "src/scripts/audit/ingestion_fallback_test.ts",
    "line": 14,
    "code": "// Direct FMP Test"
  },
  {
    "file": "src/scripts/audit/ingestion_fallback_test.ts",
    "line": 16,
    "code": "const fmpPrice = await fmp.getPrice(ticker);"
  },
  {
    "file": "src/scripts/audit/ingestion_fallback_test.ts",
    "line": 17,
    "code": "console.log(`  ‚úÖ FMP Price for ${ticker}: ${fmpPrice}`);"
  },
  {
    "file": "src/scripts/audit/ingestion_fallback_test.ts",
    "line": 19,
    "code": "console.warn(`  ‚ö†Ô∏è FMP failed for ${ticker}: ${e.message}`);"
  },
  {
    "file": "src/scripts/audit/ingestion_matrix.ts",
    "line": 6,
    "code": "import fmpService from '../../services/fmpService.js';"
  },
  {
    "file": "src/scripts/audit/ingestion_matrix.ts",
    "line": 16,
    "code": "import insiderIntentService from '../../services/insiderIntentService.js';"
  },
  {
    "file": "src/scripts/audit/ingestion_matrix.ts",
    "line": 93,
    "code": "await runTest('FMP Stable', () => fmpService.getPrice('AAPL'));"
  },
  {
    "file": "src/scripts/audit/ingestion_matrix.ts",
    "line": 103,
    "code": "// 3. INSTITUTIONAL & INSIDER"
  },
  {
    "file": "src/scripts/audit/ingestion_matrix.ts",
    "line": 104,
    "code": "await runTest('SEC Insider', () => secEdgarService.getRecentInsiderTrades(5));"
  },
  {
    "file": "src/scripts/audit/ingestion_matrix.ts",
    "line": 105,
    "code": "await runTest('Insider Intent (v102)', () => insiderIntentService.analyzeIntent('AAPL'), 'insider_in"
  },
  {
    "file": "src/scripts/audit/pssl_vlee_scan.ts",
    "line": 9,
    "code": "'fmpService.ts',"
  },
  {
    "file": "src/scripts/audit/pssl_vlee_scan.ts",
    "line": 16,
    "code": "'insiderIntentService.ts',"
  },
  {
    "file": "src/scripts/audit/pssl_vlee_scan.ts",
    "line": 32,
    "code": "'insiderPatternService.ts',"
  },
  {
    "file": "src/scripts/audit/pssl_vlee_scan.ts",
    "line": 33,
    "code": "'historicalRAGEngine.ts',"
  },
  {
    "file": "src/scripts/audit/regression_scan.ts",
    "line": 16,
    "code": "{ file: 'services/insiderIntentService.ts', signature: 'analyzeIntent', minBytes: 2000 },"
  },
  {
    "file": "src/scripts/audit/regression_scan.ts",
    "line": 26,
    "code": "{ file: 'services/catalystHunterService.ts', signature: 'huntInsiderPlays', minBytes: 2000 },"
  },
  {
    "file": "src/scripts/audit/routes_ping.ts",
    "line": 18,
    "code": "'/api/insider',"
  },
  {
    "file": "src/scripts/audit/schema_deep_scan.ts",
    "line": 38,
    "code": "'insider_data': 'jsonb',"
  },
  {
    "file": "src/scripts/audit/schema_deep_scan.ts",
    "line": 40,
    "code": "'volatility_profile': 'character varying',"
  },
  {
    "file": "src/scripts/audit/schema_deep_scan.ts",
    "line": 44,
    "code": "'historical_events': { 'recovery_pattern': 'text', 'affected_sectors': 'jsonb' },"
  },
  {
    "file": "src/scripts/audit/schema_deep_scan.ts",
    "line": 49,
    "code": "'insider_intent_logs': { 'ticker': 'character varying', 'classification': 'character varying' },"
  },
  {
    "file": "src/scripts/audit/test_1_engine_activation.ts",
    "line": 3,
    "code": "import insiderIntentService from '../../services/insiderIntentService.js';"
  },
  {
    "file": "src/scripts/audit/test_1_engine_activation.ts",
    "line": 19,
    "code": "insiderIntentService.analyzeIntent(TICKER).then(r => r ? 'OK' : 'FAIL'),"
  },
  {
    "file": "src/scripts/audit/test_1_engine_activation.ts",
    "line": 29,
    "code": "const engines = ['Gamma', 'Insider', 'Narrative', 'Currency', 'Divergence', 'MultiAgent', 'Sentiment"
  },
  {
    "file": "src/scripts/audit/test_2_route_wiring.ts",
    "line": 10,
    "code": "'/api/insider/intent/AAPL',"
  },
  {
    "file": "src/scripts/audit/test_3_db_schema.ts",
    "line": 7,
    "code": "'ai_stock_tips', 'trades', 'digest_entries', 'historical_events',"
  },
  {
    "file": "src/scripts/audit/test_3_db_schema.ts",
    "line": 8,
    "code": "'gamma_snapshots', 'narrative_pressure_logs', 'insider_intent_logs',"
  },
  {
    "file": "src/scripts/audit/test_portfolio_analysis.ts",
    "line": 15,
    "code": "console.log(`Total Value: $${result.portfolio_metrics.total_value.toFixed(2)}`);"
  },
  {
    "file": "src/scripts/audit/test_portfolio_analysis.ts",
    "line": 16,
    "code": "console.log(`Risk Level: ${result.portfolio_metrics.risk_level}`);"
  },
  {
    "file": "src/scripts/audit/test_top3_restore.ts",
    "line": 19,
    "code": "console.log('‚ö†Ô∏è WARNING: No picks returned, but system is stable.');"
  },
  {
    "file": "src/scripts/audit/vlee_scan.ts",
    "line": 4,
    "code": "'gammaExposureService.ts', 'insiderIntentService.ts', 'narrativePressureService.ts',"
  },
  {
    "file": "src/scripts/audit/vlee_scan.ts",
    "line": 9,
    "code": "'insiderPatternService.ts', 'tribunalService.ts', 'neuralChatService.ts',"
  },
  {
    "file": "src/scripts/check_build_env.ts",
    "line": 1,
    "code": "if (!process.env.FMP_API_KEY) {"
  },
  {
    "file": "src/scripts/check_build_env.ts",
    "line": 2,
    "code": "console.error(\"\\nüõë BUILD ERROR: FMP_API_KEY is missing in environment.\");"
  },
  {
    "file": "src/scripts/check_db_status.ts",
    "line": 17,
    "code": "(SELECT COUNT(*) FROM historical_events) as long_term_memory,"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 9,
    "code": "const FMP_KEY = \"RqU4R074T8aTT9V5aMLm25j3Ff4AT3Ko\";"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 12,
    "code": "// Endpoints to test for FMP (New accounts often blocked on v3/quote)"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 13,
    "code": "const FMP_CANDIDATES = ["
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 14,
    "code": "{ name: 'Quote Short', url: `https://financialmodelingprep.com/stable/quote-short/AAPL?apikey=${FMP_"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 15,
    "code": "{ name: 'Real-time',   url: `https://financialmodelingprep.com/stable/stock/real-time-price/AAPL?api"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 16,
    "code": "{ name: 'Profile',     url: `https://financialmodelingprep.com/stable/profile/AAPL?apikey=${FMP_KEY}"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 17,
    "code": "{ name: 'V4 Standard', url: `https://financialmodelingprep.com/stable/quote/AAPL?apikey=${FMP_KEY}` "
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 20,
    "code": "async function findWorkingFMPEndpoint() {"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 21,
    "code": "console.log(\"üîç Probing FMP Endpoints for your Key...\");"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 22,
    "code": "for (const ep of FMP_CANDIDATES) {"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 46,
    "code": "async function rewriteServices(fmpConfig: any) {"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 50,
    "code": "let fmpCodeBlock = \"\";"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 52,
    "code": "if (fmpConfig) {"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 54,
    "code": "const urlTemplate = fmpConfig.url.replace('AAPL', '\\${ticker}');"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 56,
    "code": "fmpCodeBlock = `"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 57,
    "code": "// 1. FMP (Primary - ${fmpConfig.name})"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 72,
    "code": "return { symbol: ticker, price, change: 0, changePercent: 0, volume: vol, source: 'FMP' };"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 74,
    "code": "} catch (e) { /* FMP Failed, drop to next */ }"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 82,
    "code": "interface StockQuote {"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 92,
    "code": "async getStockPrice(symbol: string): Promise<StockQuote | null> {"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 97,
    "code": "${fmpCodeBlock}"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 134,
    "code": "const workingFMP = await findWorkingFMPEndpoint();"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 136,
    "code": "if (!workingFMP) {"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 137,
    "code": "console.log(\"‚ö†Ô∏è  WARNING: No working FMP endpoint found for this key.\");"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 140,
    "code": "console.log(`üéØ Locked onto FMP Endpoint: ${workingFMP.name}`);"
  },
  {
    "file": "src/scripts/configure_data_layers.ts",
    "line": 143,
    "code": "await rewriteServices(workingFMP);"
  },
  {
    "file": "src/scripts/debug_fmp.ts",
    "line": 3,
    "code": "const FMP_KEY = \"RqU4R074T8aTT9V5aMLm25j3Ff4AT3Ko\";"
  },
  {
    "file": "src/scripts/debug_fmp.ts",
    "line": 6,
    "code": "console.log(\"üîë DEBUGGING FMP ENDPOINTS...\");"
  },
  {
    "file": "src/scripts/debug_fmp.ts",
    "line": 9,
    "code": "{ name: 'v3 Quote Short', url: `https://financialmodelingprep.com/stable/quote-short/AAPL?apikey=${F"
  },
  {
    "file": "src/scripts/debug_fmp.ts",
    "line": 10,
    "code": "{ name: 'v3 Quote',       url: `https://financialmodelingprep.com/stable/quote/AAPL?apikey=${FMP_KEY"
  },
  {
    "file": "src/scripts/debug_fmp.ts",
    "line": 11,
    "code": "{ name: 'v3 Profile',     url: `https://financialmodelingprep.com/stable/profile/AAPL?apikey=${FMP_K"
  },
  {
    "file": "src/scripts/debug_fmp.ts",
    "line": 12,
    "code": "{ name: 'v4 Price',       url: `https://financialmodelingprep.com/stable/quote/AAPL?apikey=${FMP_KEY"
  },
  {
    "file": "src/scripts/deep_probe.ts",
    "line": 1,
    "code": "import fmpService from '../services/fmpService.js';"
  },
  {
    "file": "src/scripts/deep_probe.ts",
    "line": 7,
    "code": "console.log('Key Present:', !!process.env.FMP_API_KEY);"
  },
  {
    "file": "src/scripts/deep_probe.ts",
    "line": 9,
    "code": "// 1. Test FMP Connectivity"
  },
  {
    "file": "src/scripts/deep_probe.ts",
    "line": 10,
    "code": "console.log('--- 1. Testing FMP Connection ---');"
  },
  {
    "file": "src/scripts/deep_probe.ts",
    "line": 12,
    "code": "const quote = await fmpService.getPrice('AAPL');"
  },
  {
    "file": "src/scripts/deep_probe.ts",
    "line": 13,
    "code": "if (quote) console.log('‚úÖ FMP Quote: Success (AAPL)', quote.price);"
  },
  {
    "file": "src/scripts/deep_probe.ts",
    "line": 14,
    "code": "else console.error('‚ùå FMP Quote: Failed (Returned null)');"
  },
  {
    "file": "src/scripts/deep_probe.ts",
    "line": 16,
    "code": "console.error('‚ùå FMP Connection Error:', e.message);"
  },
  {
    "file": "src/scripts/engine_diagnostics.ts",
    "line": 19,
    "code": "{ key: 'insider', label: 'Insider Intent', scope: 'TICKER' },"
  },
  {
    "file": "src/scripts/engine_diagnostics.ts",
    "line": 24,
    "code": "{ key: 'ife', label: 'Institutional Flow', scope: 'TICKER' },"
  },
  {
    "file": "src/scripts/engine_diagnostics.ts",
    "line": 26,
    "code": "{ key: 'uoa', label: 'Unusual Options', scope: 'TICKER' },"
  },
  {
    "file": "src/scripts/engine_diagnostics.ts",
    "line": 124,
    "code": "// but generally should be stable. We allow variance but log it."
  },
  {
    "file": "src/scripts/engine_diagnostics.ts",
    "line": 170,
    "code": "// 4. HISTORICAL COMPARISON"
  },
  {
    "file": "src/scripts/fmp_autodiscover.ts",
    "line": 15,
    "code": "{ name: 'Quote Short', url: `https://financialmodelingprep.com/stable/quote-short/${STOCK}?apikey=${"
  },
  {
    "file": "src/scripts/fmp_autodiscover.ts",
    "line": 16,
    "code": "{ name: 'Real-time',   url: `https://financialmodelingprep.com/stable/stock/real-time-price/${STOCK}"
  },
  {
    "file": "src/scripts/fmp_autodiscover.ts",
    "line": 17,
    "code": "{ name: 'Quote v3',    url: `https://financialmodelingprep.com/stable/quote/${STOCK}?apikey=${API_KE"
  },
  {
    "file": "src/scripts/fmp_autodiscover.ts",
    "line": 18,
    "code": "{ name: 'Profile',     url: `https://financialmodelingprep.com/stable/profile/${STOCK}?apikey=${API_"
  },
  {
    "file": "src/scripts/fmp_autodiscover.ts",
    "line": 19,
    "code": "{ name: 'OTC Quote',   url: `https://financialmodelingprep.com/stable/otc/real-time-price/${STOCK}?a"
  },
  {
    "file": "src/scripts/fmp_autodiscover.ts",
    "line": 22,
    "code": "{ name: 'Full History', url: `https://financialmodelingprep.com/stable/historical-price-full/${STOCK"
  },
  {
    "file": "src/scripts/fmp_autodiscover.ts",
    "line": 23,
    "code": "{ name: '4 Hour Chart', url: `https://financialmodelingprep.com/stable/historical-chart/4hour/${STOC"
  },
  {
    "file": "src/scripts/fmp_autodiscover.ts",
    "line": 24,
    "code": "{ name: 'Daily Chart',  url: `https://financialmodelingprep.com/stable/historical-chart/1day/${STOCK"
  },
  {
    "file": "src/scripts/fmp_autodiscover.ts",
    "line": 38,
    "code": "if (res.data.historical) valid = true;"
  },
  {
    "file": "src/scripts/fmp_autodiscover.ts",
    "line": 68,
    "code": "interface StockQuote {"
  },
  {
    "file": "src/scripts/fmp_autodiscover.ts",
    "line": 79,
    "code": "async getStockPrice(symbol: string): Promise<StockQuote | null> {"
  },
  {
    "file": "src/scripts/fmp_autodiscover.ts",
    "line": 104,
    "code": "source: 'FMP(${priceConfig.name})'"
  },
  {
    "file": "src/scripts/fmp_autodiscover.ts",
    "line": 108,
    "code": "console.error(\\`FMP Live Error for \\${ticker}: \\${e.message}\\`);"
  },
  {
    "file": "src/scripts/fmp_autodiscover.ts",
    "line": 125,
    "code": "// 2. HISTORICAL SERVICE"
  },
  {
    "file": "src/scripts/fmp_autodiscover.ts",
    "line": 131,
    "code": "class HistoricalDataService {"
  },
  {
    "file": "src/scripts/fmp_autodiscover.ts",
    "line": 143,
    "code": "// Handle different FMP formats"
  },
  {
    "file": "src/scripts/fmp_autodiscover.ts",
    "line": 144,
    "code": "if (res.data.historical) rawData = res.data.historical;"
  },
  {
    "file": "src/scripts/fmp_autodiscover.ts",
    "line": 158,
    "code": "console.error(\\`FMP History Error: \\${e.message}\\`);"
  },
  {
    "file": "src/scripts/fmp_autodiscover.ts",
    "line": 163,
    "code": "export default new HistoricalDataService();"
  },
  {
    "file": "src/scripts/fmp_autodiscover.ts",
    "line": 167,
    "code": "fs.writeFileSync(path.join(__dirname, '../services/historicalDataService.ts'), historyServiceCode);"
  },
  {
    "file": "src/scripts/fmp_url_investigator.ts",
    "line": 14,
    "code": "const KEY = process.env.FMP_API_KEY;"
  },
  {
    "file": "src/scripts/fmp_url_investigator.ts",
    "line": 26,
    "code": "name: \"V3 Standard (Path Param)\","
  },
  {
    "file": "src/scripts/fmp_url_investigator.ts",
    "line": 27,
    "code": "url: `https://financialmodelingprep.com/api/v3/quote/AAPL?apikey=${KEY}`"
  },
  {
    "file": "src/scripts/fmp_url_investigator.ts",
    "line": 30,
    "code": "name: \"V3 Standard (Query Param)\","
  },
  {
    "file": "src/scripts/fmp_url_investigator.ts",
    "line": 31,
    "code": "url: `https://financialmodelingprep.com/api/v3/quote?symbol=AAPL&apikey=${KEY}`"
  },
  {
    "file": "src/scripts/fmp_url_investigator.ts",
    "line": 34,
    "code": "name: \"Stable Root (Query Param)\","
  },
  {
    "file": "src/scripts/fmp_url_investigator.ts",
    "line": 35,
    "code": "url: `https://financialmodelingprep.com/stable/quote?symbol=AAPL&apikey=${KEY}`"
  },
  {
    "file": "src/scripts/fmp_url_investigator.ts",
    "line": 38,
    "code": "name: \"V4 Standard\","
  },
  {
    "file": "src/scripts/fmp_url_investigator.ts",
    "line": 39,
    "code": "url: `https://financialmodelingprep.com/api/v4/quote?symbol=AAPL&apikey=${KEY}`"
  },
  {
    "file": "src/scripts/fmp_url_investigator.ts",
    "line": 42,
    "code": "name: \"SP500 V3 (Path)\","
  },
  {
    "file": "src/scripts/fmp_url_investigator.ts",
    "line": 43,
    "code": "url: `https://financialmodelingprep.com/api/v3/sp500_constituent?apikey=${KEY}`"
  },
  {
    "file": "src/scripts/fmp_url_investigator.ts",
    "line": 46,
    "code": "name: \"SP500 Stable (Query)\","
  },
  {
    "file": "src/scripts/fmp_url_investigator.ts",
    "line": 47,
    "code": "url: `https://financialmodelingprep.com/stable/sp500_constituents?apikey=${KEY}`"
  },
  {
    "file": "src/scripts/fmp_url_investigator.ts",
    "line": 50,
    "code": "name: \"Treasury V3 (No Param)\","
  },
  {
    "file": "src/scripts/fmp_url_investigator.ts",
    "line": 51,
    "code": "url: `https://financialmodelingprep.com/api/v3/treasury?apikey=${KEY}`"
  },
  {
    "file": "src/scripts/fmp_url_investigator.ts",
    "line": 54,
    "code": "name: \"Treasury V4 (Query)\","
  },
  {
    "file": "src/scripts/fmp_url_investigator.ts",
    "line": 55,
    "code": "url: `https://financialmodelingprep.com/api/v4/treasury?apikey=${KEY}`"
  },
  {
    "file": "src/scripts/force_schema_update.ts",
    "line": 54,
    "code": "await client.query('ALTER TABLE pattern_matches ALTER COLUMN historical_match TYPE TEXT');"
  },
  {
    "file": "src/scripts/force_seed_status.ts",
    "line": 15,
    "code": "'fmp', 'alpha', 'coingecko', 'whale',"
  },
  {
    "file": "src/scripts/full_system_test.ts",
    "line": 5,
    "code": "import fmpService from '../services/fmpService.js';"
  },
  {
    "file": "src/scripts/full_system_test.ts",
    "line": 16,
    "code": "console.log('1Ô∏è‚É£  Checking FMP Connection...');"
  },
  {
    "file": "src/scripts/full_system_test.ts",
    "line": 17,
    "code": "const health = await fmpService.checkConnection();"
  },
  {
    "file": "src/scripts/full_system_test.ts",
    "line": 19,
    "code": "console.error('‚ùå FMP Connection Failed. Check API Key.');"
  },
  {
    "file": "src/scripts/full_system_test.ts",
    "line": 22,
    "code": "console.log('‚úÖ FMP Connected.');"
  },
  {
    "file": "src/scripts/full_system_test.ts",
    "line": 26,
    "code": "const caps = fmpService.capabilities;"
  },
  {
    "file": "src/scripts/full_top3_probe.ts",
    "line": 79,
    "code": "console.warn('‚ö†Ô∏è  No bundles generated. Check FMP API Key/Quota.');"
  },
  {
    "file": "src/scripts/learning_engine_v12_validator.ts",
    "line": 97,
    "code": "const dsc = await drawdownSensitivityService.getRiskProfile('crypto_alpha');"
  },
  {
    "file": "src/scripts/learning_engine_v12_validator.ts",
    "line": 225,
    "code": "'drawdown_sensitivity_profiles',"
  },
  {
    "file": "src/scripts/marketai_full_system_validator.ts",
    "line": 7,
    "code": "import fmpService from '../services/fmpService.js';"
  },
  {
    "file": "src/scripts/marketai_full_system_validator.ts",
    "line": 16,
    "code": "import insiderIntentService from '../services/insiderIntentService.js';"
  },
  {
    "file": "src/scripts/marketai_full_system_validator.ts",
    "line": 97,
    "code": "const fmp = await fmpService.getPrice(TEST_TICKER);"
  },
  {
    "file": "src/scripts/marketai_full_system_validator.ts",
    "line": 98,
    "code": "check(!!fmp && fmp.price > 0, \"FMP Data Feed\");"
  },
  {
    "file": "src/scripts/marketai_full_system_validator.ts",
    "line": 121,
    "code": "const [gamma, insider, narrative, shock, div, agents, sentiment, shadow, regime] = await Promise.all"
  },
  {
    "file": "src/scripts/marketai_full_system_validator.ts",
    "line": 123,
    "code": "insiderIntentService.analyzeIntent(TEST_TICKER),"
  },
  {
    "file": "src/scripts/marketai_full_system_validator.ts",
    "line": 134,
    "code": "check(insider.classification !== undefined, \"Insider Intent Engine\");"
  },
  {
    "file": "src/scripts/marketai_full_system_validator.ts",
    "line": 164,
    "code": "check(!!health.metrics.profitability, \"Profitability Metrics\");"
  },
  {
    "file": "src/scripts/marketai_full_system_validator.ts",
    "line": 192,
    "code": "'High', // Vol Profile"
  },
  {
    "file": "src/scripts/marketai_full_system_validator.ts",
    "line": 235,
    "code": "'/api/insider/intent/AAPL',"
  },
  {
    "file": "src/scripts/marketai_full_system_validator.ts",
    "line": 270,
    "code": "'ai_stock_tips', 'trades', 'digest_entries', 'historical_events',"
  },
  {
    "file": "src/scripts/marketai_full_system_validator.ts",
    "line": 271,
    "code": "'gamma_snapshots', 'narrative_pressure_logs', 'insider_intent_logs',"
  },
  {
    "file": "src/scripts/migrate_history.ts",
    "line": 12,
    "code": "console.log('üîÑ Migrating historical_events table...');"
  },
  {
    "file": "src/scripts/migrate_history.ts",
    "line": 16,
    "code": "ALTER TABLE historical_events"
  },
  {
    "file": "src/scripts/migrate_history.ts",
    "line": 23,
    "code": "ALTER TABLE historical_events"
  },
  {
    "file": "src/scripts/migrate_history.ts",
    "line": 30,
    "code": "ALTER TABLE historical_events"
  },
  {
    "file": "src/scripts/migration_carm.ts",
    "line": 25,
    "code": "metrics JSONB, -- { yield_spread: -0.4, credit_spread: 1.2, oil_vol: 25 }"
  },
  {
    "file": "src/scripts/migration_gmf.ts",
    "line": 20,
    "code": "-- Core Metrics"
  },
  {
    "file": "src/scripts/migration_gmf.ts",
    "line": 21,
    "code": "inflation_trend VARCHAR(20), -- HEATING, COOLING, STABLE"
  },
  {
    "file": "src/scripts/migration_iat.ts",
    "line": 15,
    "code": "// Store track records for individual insiders (e.g., \"Tim Cook\")"
  },
  {
    "file": "src/scripts/migration_iat.ts",
    "line": 17,
    "code": "CREATE TABLE IF NOT EXISTS insider_track_records ("
  },
  {
    "file": "src/scripts/migration_iat.ts",
    "line": 19,
    "code": "insider_name VARCHAR(255) NOT NULL,"
  },
  {
    "file": "src/scripts/migration_iat.ts",
    "line": 26,
    "code": "UNIQUE(insider_name, company_ticker)"
  },
  {
    "file": "src/scripts/migration_iat.ts",
    "line": 31,
    "code": "console.log('‚úÖ IAT Schema Applied (insider_track_records).');"
  },
  {
    "file": "src/scripts/migration_ife.ts",
    "line": 16,
    "code": "CREATE TABLE IF NOT EXISTS institutional_flow_metrics ("
  },
  {
    "file": "src/scripts/migration_ife.ts",
    "line": 21,
    "code": "institutional_ownership_pct NUMERIC,"
  },
  {
    "file": "src/scripts/migration_ife.ts",
    "line": 30,
    "code": "institutional_conviction_score INTEGER, -- 0-100"
  },
  {
    "file": "src/scripts/migration_ife.ts",
    "line": 40,
    "code": "console.log('‚úÖ IFE Schema Applied (institutional_flow_metrics).');"
  },
  {
    "file": "src/scripts/migration_meta.ts",
    "line": 24,
    "code": "drift_metrics JSONB,  -- Confidence drift stats"
  },
  {
    "file": "src/scripts/migration_meta.ts",
    "line": 26,
    "code": "recommendations TEXT[] -- \"Fix FMP Key\", \"Recalibrate Momentum\""
  },
  {
    "file": "src/scripts/migration_meta_learning.ts",
    "line": 26,
    "code": "const signals = ['momentum', 'value', 'catalyst', 'insider', 'gamma', 'shadow', 'narrative', 'fsi', "
  },
  {
    "file": "src/scripts/migration_meta_learning.ts",
    "line": 45,
    "code": "drift_metrics JSONB,     -- Model drift"
  },
  {
    "file": "src/scripts/migration_pot.ts",
    "line": 29,
    "code": "-- Outcome Metrics"
  },
  {
    "file": "src/scripts/migration_pot_p10.ts",
    "line": 39,
    "code": "if (m === 'SEP') mod = 0.9; // Historically weak"
  },
  {
    "file": "src/scripts/migration_pot_p11.ts",
    "line": 21,
    "code": "engine_weights JSONB, -- { gamma: 1.2, insider: 0.9, ... }"
  },
  {
    "file": "src/scripts/migration_pot_p11.ts",
    "line": 38,
    "code": "\"insider\": 1.0,"
  },
  {
    "file": "src/scripts/migration_pot_p3.ts",
    "line": 20,
    "code": "-- Agent Performance Metrics"
  },
  {
    "file": "src/scripts/migration_pot_p6.ts",
    "line": 16,
    "code": "CREATE TABLE IF NOT EXISTS drawdown_sensitivity_profiles ("
  },
  {
    "file": "src/scripts/migration_pot_p6.ts",
    "line": 17,
    "code": "profile_key VARCHAR(50) PRIMARY KEY, -- e.g. 'blue_chip', 'crypto_alpha'"
  },
  {
    "file": "src/scripts/migration_pot_p6.ts",
    "line": 31,
    "code": "// Seed default profiles to ensure day-1 functionality"
  },
  {
    "file": "src/scripts/migration_pot_p6.ts",
    "line": 33,
    "code": "INSERT INTO drawdown_sensitivity_profiles (profile_key, avg_mae_pct, max_tolerable_drawdown, recover"
  },
  {
    "file": "src/scripts/migration_pot_p6.ts",
    "line": 38,
    "code": "('insider_play', 4.0, 8.0, 0.75, 1.1, 0, 10),"
  },
  {
    "file": "src/scripts/migration_pot_p6.ts",
    "line": 40,
    "code": "ON CONFLICT (profile_key) DO NOTHING;"
  },
  {
    "file": "src/scripts/migration_pot_p6.ts",
    "line": 44,
    "code": "console.log('‚úÖ DSC Schema Applied (drawdown_sensitivity_profiles).');"
  },
  {
    "file": "src/scripts/migration_pot_p8.ts",
    "line": 20,
    "code": "-- Trap Metrics"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 10,
    "code": "import fmpService from '../services/fmpService.js';"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 19,
    "code": "console.log('\\nüì° STARTING FMP CAPABILITY SCAN');"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 22,
    "code": "if (!process.env.FMP_API_KEY) {"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 23,
    "code": "console.error('‚ùå CRITICAL: No FMP_API_KEY found.');"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 63,
    "code": "await check('getPrice', () => fmpService.getPrice(TEST_TICKER));"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 64,
    "code": "await check('getBatchPrices', () => fmpService.getBatchPrices([TEST_TICKER, 'MSFT']));"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 65,
    "code": "await check('getDailyCandles', () => fmpService.getDailyCandles(TEST_TICKER, 10));"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 66,
    "code": "await check('getIntraday', () => fmpService.getIntraday(TEST_TICKER, '5min'));"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 69,
    "code": "await check('getPriceTargets', () => fmpService.getPriceTargets(TEST_TICKER));"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 70,
    "code": "await check('getAnalystEstimates', () => fmpService.getAnalystEstimates(TEST_TICKER));"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 72,
    "code": "// --- 3. INSTITUTIONAL ---"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 73,
    "code": "await check('getInstitutionalHolders', () => fmpService.getInstitutionalHolders(TEST_TICKER));"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 74,
    "code": "await check('getInsiderTrades', () => fmpService.getInsiderTrades(TEST_TICKER));"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 75,
    "code": "await check('getEtfHoldings', () => fmpService.getEtfHoldings('SPY'));"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 78,
    "code": "await check('getOptionChain', () => fmpService.getOptionChain(TEST_TICKER));"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 80,
    "code": "// --- 5. MACROECONOMICS ---"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 81,
    "code": "await check('getEconomicData (GDP)', () => fmpService.getEconomicData('GDP'));"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 82,
    "code": "await check('getEconomicData (CPI)', () => fmpService.getEconomicData('CPI'));"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 83,
    "code": "await check('getEconomicData (PPI)', () => fmpService.getEconomicData('PPI'));"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 84,
    "code": "await check('getEconomicData (Unrate)', () => fmpService.getEconomicData('unemploymentRate'));"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 85,
    "code": "await check('getTreasuryRates', () => fmpService.getTreasuryRates());"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 88,
    "code": "await check('getMarketNews', () => fmpService.getMarketNews(5));"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 89,
    "code": "await check('getCompanyNews', () => fmpService.getCompanyNews(TEST_TICKER));"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 92,
    "code": "await check('getCompanyProfile', () => fmpService.getCompanyProfile(TEST_TICKER));"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 93,
    "code": "await check('getKeyMetrics', () => fmpService.getKeyMetrics(TEST_TICKER));"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 94,
    "code": "await check('getFinancialRatios', () => fmpService.getFinancialRatios(TEST_TICKER));"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 104,
    "code": "console.log(`üíæ Saving report to logs/fmp_capabilities.json...`);"
  },
  {
    "file": "src/scripts/probe_fmp_capabilities.ts",
    "line": 107,
    "code": "path.join(process.cwd(), 'logs', 'fmp_capabilities.json'),"
  },
  {
    "file": "src/scripts/purgeMockData.ts",
    "line": 12,
    "code": "'Options Flow', 'Twitter Sentiment', 'StockTwits', 'Financial News',"
  },
  {
    "file": "src/scripts/purgeMockData.ts",
    "line": 13,
    "code": "'Press Releases', 'Insider Trading', 'Political News', 'Extended Hours',"
  },
  {
    "file": "src/scripts/purgeMockData.ts",
    "line": 14,
    "code": "'Geopolitical Events', 'Economic Indicators', 'Institutional Holdings',"
  },
  {
    "file": "src/scripts/purgeMockData.ts",
    "line": 17,
    "code": "'OpenInsider', 'Market Indices', 'ETF Flows', 'Treasury Yields', 'IPO Filings',"
  },
  {
    "file": "src/scripts/purgeMockData.ts",
    "line": 21,
    "code": "'Finnhub Quote', 'Commodity Prices'"
  },
  {
    "file": "src/scripts/purge_ancient_history.ts",
    "line": 16,
    "code": "DELETE FROM historical_events"
  },
  {
    "file": "src/scripts/purge_ancient_history.ts",
    "line": 22,
    "code": "console.log(`‚úÖ Purged ${res.rowCount} irrelevant historical records.`);"
  },
  {
    "file": "src/scripts/purity_probe.ts",
    "line": 10,
    "code": "import fmpService from '../services/fmpService.js';"
  },
  {
    "file": "src/scripts/purity_probe.ts",
    "line": 13,
    "code": "console.log('\\nüß™ STARTING DATA PURITY PROBE V3 (FINAL COMPLIANCE)');"
  },
  {
    "file": "src/scripts/purity_probe.ts",
    "line": 16,
    "code": "if (!process.env.FMP_API_KEY) {"
  },
  {
    "file": "src/scripts/purity_probe.ts",
    "line": 17,
    "code": "console.error('‚ùå CRITICAL: No FMP_API_KEY found in environment.');"
  },
  {
    "file": "src/scripts/purity_probe.ts",
    "line": 25,
    "code": "console.log('üì° Testing FMP Direct Connectivity...');"
  },
  {
    "file": "src/scripts/purity_probe.ts",
    "line": 27,
    "code": "const q = await fmpService.getPrice('AAPL');"
  },
  {
    "file": "src/scripts/purity_probe.ts",
    "line": 28,
    "code": "if (!q || !q.price) console.error('‚ùå FMP Price: NULL/ZERO (Data Gap)');"
  },
  {
    "file": "src/scripts/purity_probe.ts",
    "line": 29,
    "code": "else console.log(`‚úÖ FMP Price: ${q.price} (Real Data)`);"
  },
  {
    "file": "src/scripts/purity_probe.ts",
    "line": 31,
    "code": "console.error('‚ùå FMP Failure:', e.message);"
  },
  {
    "file": "src/scripts/repair_history_db.ts",
    "line": 60,
    "code": "description: \"Global economic shutdown due to virus.\","
  },
  {
    "file": "src/scripts/repair_history_db.ts",
    "line": 70,
    "code": "console.log('üõ†Ô∏è  Repairing historical_events table...');"
  },
  {
    "file": "src/scripts/repair_history_db.ts",
    "line": 74,
    "code": "await pool.query('DROP TABLE IF EXISTS historical_events');"
  },
  {
    "file": "src/scripts/repair_history_db.ts",
    "line": 79,
    "code": "CREATE TABLE historical_events ("
  },
  {
    "file": "src/scripts/repair_history_db.ts",
    "line": 99,
    "code": "INSERT INTO historical_events"
  },
  {
    "file": "src/scripts/repair_history_db.ts",
    "line": 110,
    "code": "console.log(`‚úÖ Successfully injected ${count} historical events.`);"
  },
  {
    "file": "src/scripts/repair_price_service.ts",
    "line": 10,
    "code": "import fmpService from '../services/fmpService.js';"
  },
  {
    "file": "src/scripts/repair_price_service.ts",
    "line": 19,
    "code": "const apiKey = process.env.FMP_API_KEY;"
  },
  {
    "file": "src/scripts/repair_price_service.ts",
    "line": 26,
    "code": "// 1. RAW AXIOS CHECK (Quote Short)"
  },
  {
    "file": "src/scripts/repair_price_service.ts",
    "line": 27,
    "code": "const rawUrl = `https://financialmodelingprep.com/api/v3/quote-short/${ticker}?apikey=${apiKey}`;"
  },
  {
    "file": "src/scripts/repair_price_service.ts",
    "line": 60,
    "code": "console.log(`   üëâ Testing fmpService.getPrice('${ticker}')...`);"
  },
  {
    "file": "src/scripts/repair_price_service.ts",
    "line": 62,
    "code": "const servicePrice = await fmpService.getPrice(ticker);"
  },
  {
    "file": "src/scripts/repair_price_service.ts",
    "line": 63,
    "code": "console.log(`   ‚úÖ fmpService Result:`, JSON.stringify(servicePrice));"
  },
  {
    "file": "src/scripts/repair_price_service.ts",
    "line": 65,
    "code": "console.error(`   ‚ùå fmpService Threw:`, e.message);"
  },
  {
    "file": "src/scripts/repair_schema_integrity.ts",
    "line": 13,
    "code": "const tables = ['correlation_patterns', 'historical_events', 'raw_data_collection'];"
  },
  {
    "file": "src/scripts/repair_schema_v2.ts",
    "line": 15,
    "code": "'historical_events',"
  },
  {
    "file": "src/scripts/run_top3_failure_diagnostics.ts",
    "line": 4,
    "code": "import fmpService from '../services/fmpService.js';"
  },
  {
    "file": "src/scripts/run_top3_failure_diagnostics.ts",
    "line": 36,
    "code": "const fmp = await fmpService.checkConnection();"
  },
  {
    "file": "src/scripts/run_top3_failure_diagnostics.ts",
    "line": 37,
    "code": "console.log(fmp.success ? '   ‚úÖ FMP Connection: OK' : '   ‚ùå FMP Connection: FAILED (This causes the "
  },
  {
    "file": "src/scripts/seed_active_tips.ts",
    "line": 23,
    "code": "reason: 'Strong Gamma Exposure + Insider Buying detected.',"
  },
  {
    "file": "src/scripts/seed_active_tips.ts",
    "line": 30,
    "code": "advanced_explanation: 'Setup driven by high gamma and insider alignment. DSC adjusted stop.'"
  },
  {
    "file": "src/scripts/seed_archetypes.ts",
    "line": 24,
    "code": "event: \"Institutional Rotation (Smart Money Flip)\","
  },
  {
    "file": "src/scripts/seed_archetypes.ts",
    "line": 68,
    "code": "// Using the existing historical_events table but adding abstract archetypes"
  },
  {
    "file": "src/scripts/seed_archetypes.ts",
    "line": 70,
    "code": "const res = await pool.query(\"SELECT id FROM historical_events WHERE event = $1\", [item.event]);"
  },
  {
    "file": "src/scripts/seed_archetypes.ts",
    "line": 73,
    "code": "INSERT INTO historical_events"
  },
  {
    "file": "src/scripts/seed_corporate_legends.ts",
    "line": 28,
    "code": "description: \"Real identity verification (Facebook) defeated anonymous/customizable profiles (MySpac"
  },
  {
    "file": "src/scripts/seed_corporate_legends.ts",
    "line": 63,
    "code": "recovery_pattern: \"Capital destruction until consolidation/truce. First mover (Uber) eventually domi"
  },
  {
    "file": "src/scripts/seed_corporate_legends.ts",
    "line": 72,
    "code": "description: \"Shift to supply-side economics, tax cuts, and deregulation.\","
  },
  {
    "file": "src/scripts/seed_corporate_legends.ts",
    "line": 96,
    "code": "const res = await pool.query(\"SELECT id FROM historical_events WHERE event = $1\", [item.event]);"
  },
  {
    "file": "src/scripts/seed_corporate_legends.ts",
    "line": 99,
    "code": "INSERT INTO historical_events"
  },
  {
    "file": "src/scripts/seed_correlation_data.ts",
    "line": 40,
    "code": "console.log('   ‚è≥ Generating 24 weeks of historical weekend moves...');"
  },
  {
    "file": "src/scripts/seed_correlation_data.ts",
    "line": 58,
    "code": "console.log('   ‚úÖ Historical data seeded.');"
  },
  {
    "file": "src/scripts/seed_crisis_history.ts",
    "line": 11,
    "code": "// RICH HISTORICAL DATA SPECIFIC TO CURRENT EVENTS"
  },
  {
    "file": "src/scripts/seed_crisis_history.ts",
    "line": 54,
    "code": "const exists = await pool.query(\"SELECT id FROM historical_events WHERE event = $1\", [item.event]);"
  },
  {
    "file": "src/scripts/seed_crisis_history.ts",
    "line": 59,
    "code": "UPDATE historical_events SET"
  },
  {
    "file": "src/scripts/seed_crisis_history.ts",
    "line": 69,
    "code": "INSERT INTO historical_events"
  },
  {
    "file": "src/scripts/seed_deep_history.ts",
    "line": 87,
    "code": "description: \"Global economic shutdown due to virus.\","
  },
  {
    "file": "src/scripts/seed_deep_history.ts",
    "line": 97,
    "code": "console.log('üå± Seeding Historical Knowledge Base...');"
  },
  {
    "file": "src/scripts/seed_deep_history.ts",
    "line": 101,
    "code": "CREATE TABLE IF NOT EXISTS historical_events ("
  },
  {
    "file": "src/scripts/seed_deep_history.ts",
    "line": 118,
    "code": "const res = await pool.query(\"SELECT id FROM historical_events WHERE event = $1\", [item.event]);"
  },
  {
    "file": "src/scripts/seed_deep_history.ts",
    "line": 121,
    "code": "INSERT INTO historical_events"
  },
  {
    "file": "src/scripts/seed_deep_history.ts",
    "line": 133,
    "code": "console.log(`‚úÖ Injected ${count} historical events.`);"
  },
  {
    "file": "src/scripts/seed_history.ts",
    "line": 112,
    "code": "console.log('üå± Seeding Historical Knowledge Base...');"
  },
  {
    "file": "src/scripts/seed_history.ts",
    "line": 117,
    "code": "CREATE TABLE IF NOT EXISTS historical_events ("
  },
  {
    "file": "src/scripts/seed_history.ts",
    "line": 134,
    "code": "const exists = await pool.query(\"SELECT id FROM historical_events WHERE description = $1\", [item.des"
  },
  {
    "file": "src/scripts/seed_history.ts",
    "line": 138,
    "code": "INSERT INTO historical_events"
  },
  {
    "file": "src/scripts/seed_history.ts",
    "line": 154,
    "code": "console.log(`‚úÖ Successfully injected ${count} historical events.`);"
  },
  {
    "file": "src/scripts/seed_reliability_data.ts",
    "line": 12,
    "code": "const agents = ['Momentum', 'Value', 'Catalyst', 'ShadowLiquidity', 'FSIFundamentals', 'InsiderInten"
  },
  {
    "file": "src/scripts/seed_system_status.ts",
    "line": 14,
    "code": "'fmp', 'alpha', 'coingecko', 'whale', // Core"
  },
  {
    "file": "src/scripts/selfEvolving_full_test.ts",
    "line": 11,
    "code": "import insiderIntentService from '../services/insiderIntentService.js';"
  },
  {
    "file": "src/scripts/selfEvolving_full_test.ts",
    "line": 57,
    "code": "const quote = await marketDataService.getStockPrice('AAPL');"
  },
  {
    "file": "src/scripts/selfEvolving_full_test.ts",
    "line": 58,
    "code": "if (quote && quote.price > 0) log('Market Data', 'PASS', `Live Feed Active (${quote.source})`);"
  },
  {
    "file": "src/scripts/setup_correlation_tables.ts",
    "line": 13,
    "code": "// 1. Historical Prices Table (Granular)"
  },
  {
    "file": "src/scripts/setup_correlation_tables.ts",
    "line": 36,
    "code": "win_rate DECIMAL,                -- Historical accuracy"
  },
  {
    "file": "src/scripts/setup_earnings_memory.ts",
    "line": 17,
    "code": "pattern_type VARCHAR(50), -- 'RUN_UP', 'DUMP', 'VOLATILITY_CRUSH', 'INSIDER_ACCUMULATION'"
  },
  {
    "file": "src/scripts/setup_event_analysis_db.ts",
    "line": 20,
    "code": "found_correlations JSONB, -- Historical matches found in DB"
  },
  {
    "file": "src/scripts/setup_hunter_db.ts",
    "line": 16,
    "code": "signal_type VARCHAR(50), -- 'Insider', 'Policy', 'Supply Chain'"
  },
  {
    "file": "src/scripts/setup_market_echo.ts",
    "line": 17,
    "code": "historical_event_name VARCHAR(255),"
  },
  {
    "file": "src/scripts/setup_options_radar.ts",
    "line": 11,
    "code": "console.log('   Creating Options Radar tables...');"
  },
  {
    "file": "src/scripts/setup_options_radar.ts",
    "line": 15,
    "code": "CREATE TABLE IF NOT EXISTS options_alerts ("
  },
  {
    "file": "src/scripts/setup_options_radar.ts",
    "line": 29,
    "code": "await pool.query(`CREATE INDEX IF NOT EXISTS idx_options_ticker ON options_alerts(ticker);`);"
  },
  {
    "file": "src/scripts/setup_options_radar.ts",
    "line": 31,
    "code": "console.log('   ‚úÖ Created options_alerts table.');"
  },
  {
    "file": "src/scripts/setup_paper_trading.ts",
    "line": 32,
    "code": "// 2. Trades Table (Historical Ledger)"
  },
  {
    "file": "src/scripts/success_validator.ts",
    "line": 20,
    "code": "if (!process.env.FMP_API_KEY) {"
  },
  {
    "file": "src/scripts/success_validator.ts",
    "line": 27,
    "code": "macro: [], sentiment: [], insider: []"
  },
  {
    "file": "src/scripts/success_validator.ts",
    "line": 44,
    "code": "data.insider.push(bundle.engines.insider.score);"
  },
  {
    "file": "src/scripts/system_diagnostic.ts",
    "line": 24,
    "code": "'DATABASE_URL', 'FMP_API_KEY', 'TIINGO_API_KEY',"
  },
  {
    "file": "src/scripts/system_diagnostic.ts",
    "line": 69,
    "code": "async function checkFMP() {"
  },
  {
    "file": "src/scripts/system_diagnostic.ts",
    "line": 70,
    "code": "console.log('\\n3. FMP API (Financial Modeling Prep)');"
  },
  {
    "file": "src/scripts/system_diagnostic.ts",
    "line": 72,
    "code": "const key = process.env.FMP_API_KEY;"
  },
  {
    "file": "src/scripts/system_diagnostic.ts",
    "line": 73,
    "code": "if (!key) return log('FMP', 'FAIL', 'Skipping (No Key)');"
  },
  {
    "file": "src/scripts/system_diagnostic.ts",
    "line": 75,
    "code": "// TEST A: STABLE (Stocks)"
  },
  {
    "file": "src/scripts/system_diagnostic.ts",
    "line": 77,
    "code": "const url = `https://financialmodelingprep.com/stable/quote?symbol=AAPL&apikey=${key}`;"
  },
  {
    "file": "src/scripts/system_diagnostic.ts",
    "line": 80,
    "code": "log('FMP STABLE', 'OK', `AAPL Price: $${res.data[0].price}`);"
  },
  {
    "file": "src/scripts/system_diagnostic.ts",
    "line": 82,
    "code": "log('FMP STABLE', 'WARN', 'Returned Empty Array', res.data);"
  },
  {
    "file": "src/scripts/system_diagnostic.ts",
    "line": 85,
    "code": "log('FMP STABLE', 'FAIL', `HTTP ${e.response?.status || 'Error'}`, e.message);"
  },
  {
    "file": "src/scripts/system_diagnostic.ts",
    "line": 89,
    "code": "// TEST B: STABLE (Indices - Often Blocked on Free/Starter)"
  },
  {
    "file": "src/scripts/system_diagnostic.ts",
    "line": 91,
    "code": "const url = `https://financialmodelingprep.com/stable/quote?symbol=^VIX&apikey=${key}`;"
  },
  {
    "file": "src/scripts/system_diagnostic.ts",
    "line": 93,
    "code": "log('FMP INDICES', 'OK', '^VIX access permitted');"
  },
  {
    "file": "src/scripts/system_diagnostic.ts",
    "line": 96,
    "code": "log('FMP INDICES', 'WARN', 'Indices Blocked (Expected on Starter Plan)');"
  },
  {
    "file": "src/scripts/system_diagnostic.ts",
    "line": 98,
    "code": "log('FMP INDICES', 'FAIL', `HTTP ${e.response?.status || 'Error'}`, e.message);"
  },
  {
    "file": "src/scripts/system_diagnostic.ts",
    "line": 130,
    "code": "const url = `https://query2.finance.yahoo.com/v8/finance/quote?symbols=${t}`;"
  },
  {
    "file": "src/scripts/system_diagnostic.ts",
    "line": 135,
    "code": "const data = res.data?.quoteResponse?.result?.[0];"
  },
  {
    "file": "src/scripts/system_diagnostic.ts",
    "line": 181,
    "code": "const url = 'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd';"
  },
  {
    "file": "src/scripts/system_diagnostic.ts",
    "line": 196,
    "code": "await checkFMP();"
  },
  {
    "file": "src/scripts/system_integrity_scan.ts",
    "line": 4,
    "code": "import fmpService from '../services/fmpService.js';"
  },
  {
    "file": "src/scripts/system_integrity_scan.ts",
    "line": 96,
    "code": "// 1. Check FMP Connection"
  },
  {
    "file": "src/scripts/system_integrity_scan.ts",
    "line": 98,
    "code": "const fmpStatus = await fmpService.checkConnection();"
  },
  {
    "file": "src/scripts/system_integrity_scan.ts",
    "line": 100,
    "code": "check: 'API Connection (FMP)',"
  },
  {
    "file": "src/scripts/system_integrity_scan.ts",
    "line": 101,
    "code": "status: fmpStatus.success ? 'PASS' : 'FAIL',"
  },
  {
    "file": "src/scripts/system_integrity_scan.ts",
    "line": 102,
    "code": "details: fmpStatus.message"
  },
  {
    "file": "src/scripts/system_integrity_scan.ts",
    "line": 105,
    "code": "results.push({ check: 'API Connection (FMP)', status: 'FAIL', details: (e as Error).message });"
  },
  {
    "file": "src/scripts/system_integrity_scan.ts",
    "line": 155,
    "code": "if (analysis.portfolio_metrics && analysis.positions) {"
  },
  {
    "file": "src/scripts/system_integrity_scan.ts",
    "line": 159,
    "code": "details: `Analyzed ${analysis.positions.length} positions. Risk: ${analysis.portfolio_metrics.risk_l"
  },
  {
    "file": "src/scripts/test_cdc.ts",
    "line": 18,
    "code": "const metrics = await confidenceDriftService.getDriftCorrection();"
  },
  {
    "file": "src/scripts/test_cdc.ts",
    "line": 19,
    "code": "console.log(`   Factor: x${metrics.correction_factor.toFixed(3)} | Bias: ${metrics.drift_bias.toFixe"
  },
  {
    "file": "src/scripts/test_cdc.ts",
    "line": 21,
    "code": "if (metrics.correction_factor > 0.5 && metrics.correction_factor < 1.5) {"
  },
  {
    "file": "src/scripts/test_data_pipeline.ts",
    "line": 7,
    "code": "console.log(\"   (FMP Key Present: \" + (!!process.env.FMP_API_KEY) + \")\");"
  },
  {
    "file": "src/scripts/test_dsc.ts",
    "line": 8,
    "code": "// 1. Test Profile Fetch"
  },
  {
    "file": "src/scripts/test_dsc.ts",
    "line": 9,
    "code": "const cryptoProfile = await drawdownSensitivityService.getRiskProfile('crypto_alpha');"
  },
  {
    "file": "src/scripts/test_dsc.ts",
    "line": 10,
    "code": "const blueProfile = await drawdownSensitivityService.getRiskProfile('blue_chip');"
  },
  {
    "file": "src/scripts/test_dsc.ts",
    "line": 12,
    "code": "console.log(`   Crypto Modifier: ${cryptoProfile.stop_loss_modifier}x (Should be > 1.0)`);"
  },
  {
    "file": "src/scripts/test_dsc.ts",
    "line": 13,
    "code": "console.log(`   BlueChip Modifier: ${blueProfile.stop_loss_modifier}x (Should be 1.0)`);"
  },
  {
    "file": "src/scripts/test_dsc.ts",
    "line": 15,
    "code": "if (cryptoProfile.stop_loss_modifier <= 1.0) {"
  },
  {
    "file": "src/scripts/test_dve.ts",
    "line": 16,
    "code": "console.log(`   PE: ${result.metrics.pe_ratio}`);"
  },
  {
    "file": "src/scripts/test_dve.ts",
    "line": 17,
    "code": "console.log(`   PEG: ${result.metrics.peg_ratio}`);"
  },
  {
    "file": "src/scripts/test_dve.ts",
    "line": 18,
    "code": "console.log(`   FCF Yield: ${result.metrics.fcf_yield}%`);"
  },
  {
    "file": "src/scripts/test_dve.ts",
    "line": 25,
    "code": "if (result.fair_value > 0 || result.metrics.pe_ratio > 0) {"
  },
  {
    "file": "src/scripts/test_fmp_access.ts",
    "line": 5,
    "code": "const FMP_KEY = process.env.FMP_API_KEY;"
  },
  {
    "file": "src/scripts/test_fmp_access.ts",
    "line": 8,
    "code": "console.log('üîë Testing FMP API Key...');"
  },
  {
    "file": "src/scripts/test_fmp_access.ts",
    "line": 10,
    "code": "if (!FMP_KEY) {"
  },
  {
    "file": "src/scripts/test_fmp_access.ts",
    "line": 11,
    "code": "console.error('‚ùå CRITICAL: FMP_API_KEY is missing from process.env');"
  },
  {
    "file": "src/scripts/test_fmp_access.ts",
    "line": 16,
    "code": "console.log(`   Key found (starts with): ${FMP_KEY.substring(0, 4)}...`);"
  },
  {
    "file": "src/scripts/test_fmp_access.ts",
    "line": 21,
    "code": "const stockRes = await axios.get(`https://financialmodelingprep.com/stable/quote/AAPL?apikey=${FMP_K"
  },
  {
    "file": "src/scripts/test_fmp_access.ts",
    "line": 34,
    "code": "const cryptoRes = await axios.get(`https://financialmodelingprep.com/stable/quote/BTCUSD?apikey=${FM"
  },
  {
    "file": "src/scripts/test_fmp_full.ts",
    "line": 9,
    "code": "if (!process.env.FMP_API_KEY) {"
  },
  {
    "file": "src/scripts/test_fmp_full.ts",
    "line": 13,
    "code": "const API_KEY = process.env.FMP_API_KEY;"
  },
  {
    "file": "src/scripts/test_fmp_full.ts",
    "line": 14,
    "code": "const BASE_URL = 'https://financialmodelingprep.com/stable';"
  },
  {
    "file": "src/scripts/test_fmp_full.ts",
    "line": 27,
    "code": "{ name: 'Quote', path: '/quote?symbol={symbol}' },"
  },
  {
    "file": "src/scripts/test_fmp_full.ts",
    "line": 28,
    "code": "{ name: 'Profile', path: '/profile?symbol={symbol}' },"
  },
  {
    "file": "src/scripts/test_fmp_full.ts",
    "line": 29,
    "code": "{ name: 'Historical Daily', path: '/historical-price-full/{symbol}' },"
  },
  {
    "file": "src/scripts/test_fmp_full.ts",
    "line": 30,
    "code": "{ name: 'Intraday (5min)', path: '/historical-chart/5min/{symbol}' },"
  },
  {
    "file": "src/scripts/test_fmp_full.ts",
    "line": 31,
    "code": "{ name: 'Key Metrics (TTM)', path: '/key-metrics-ttm?symbol={symbol}' },"
  },
  {
    "file": "src/scripts/test_fmp_full.ts",
    "line": 32,
    "code": "{ name: 'Ratios (TTM)', path: '/ratios-ttm?symbol={symbol}' },"
  },
  {
    "file": "src/scripts/test_fmp_full.ts",
    "line": 34,
    "code": "{ name: 'Institutional', path: '/institutional-ownership?symbol={symbol}' },"
  },
  {
    "file": "src/scripts/test_fmp_full.ts",
    "line": 37,
    "code": "{ name: 'Economic (GDP)', path: '/economic?name=GDP', global: true },"
  },
  {
    "file": "src/scripts/test_fmp_full.ts",
    "line": 38,
    "code": "{ name: 'Economic (10Y)', path: '/economic?name=10Y', global: true },"
  },
  {
    "file": "src/scripts/test_fmp_full.ts",
    "line": 45,
    "code": "console.log('\\nüì° FMP STABLE API TEST HARNESS');"
  },
  {
    "file": "src/scripts/test_fmp_full.ts",
    "line": 49,
    "code": "console.error('‚ùå CRITICAL: FMP_API_KEY is missing from environment.');"
  },
  {
    "file": "src/scripts/test_fmp_full.ts",
    "line": 147,
    "code": "console.log('üéâ ALL CHECKS PASSED. FMP Connection is Healthy.');"
  },
  {
    "file": "src/scripts/test_fmp_full_revised.ts",
    "line": 10,
    "code": "const API_KEY = process.env.FMP_API_KEY;"
  },
  {
    "file": "src/scripts/test_fmp_full_revised.ts",
    "line": 11,
    "code": "const BASE_URL = 'https://financialmodelingprep.com/stable';"
  },
  {
    "file": "src/scripts/test_fmp_full_revised.ts",
    "line": 15,
    "code": "console.log('\\nüì° FMP STABLE API VALIDATION (PHASE 37)');"
  },
  {
    "file": "src/scripts/test_fmp_full_revised.ts",
    "line": 19,
    "code": "{ name: 'Quote', path: `/quote?symbol=${SYMBOL}` },"
  },
  {
    "file": "src/scripts/test_fmp_full_revised.ts",
    "line": 20,
    "code": "{ name: 'Profile', path: `/profile?symbol=${SYMBOL}` },"
  },
  {
    "file": "src/scripts/test_fmp_full_revised.ts",
    "line": 21,
    "code": "{ name: 'Ratios TTM', path: `/ratios-ttm?symbol=${SYMBOL}` },"
  },
  {
    "file": "src/scripts/test_fmp_full_revised.ts",
    "line": 22,
    "code": "{ name: 'Key Metrics', path: `/key-metrics-ttm?symbol=${SYMBOL}` },"
  },
  {
    "file": "src/scripts/test_fmp_full_revised.ts",
    "line": 25,
    "code": "{ name: 'Economic (GDP)', path: `/economic?name=GDP` },"
  },
  {
    "file": "src/scripts/test_fmp_full_revised.ts",
    "line": 27,
    "code": "{ name: 'Institutional', path: `/institutional-ownership?symbol=${SYMBOL}` },"
  },
  {
    "file": "src/scripts/test_fmp_full_revised.ts",
    "line": 28,
    "code": "{ name: 'Historical', path: `/historical-price-full?symbol=${SYMBOL}` }"
  },
  {
    "file": "src/scripts/test_fmp_new.ts",
    "line": 5,
    "code": "const FMP_KEY = process.env.FMP_API_KEY;"
  },
  {
    "file": "src/scripts/test_fmp_new.ts",
    "line": 8,
    "code": "console.log('üîë Testing Updated FMP Endpoints...');"
  },
  {
    "file": "src/scripts/test_fmp_new.ts",
    "line": 10,
    "code": "// 1. Test Quote Short (Live)"
  },
  {
    "file": "src/scripts/test_fmp_new.ts",
    "line": 12,
    "code": "console.log('   Testing /quote-short/AAPL...');"
  },
  {
    "file": "src/scripts/test_fmp_new.ts",
    "line": 13,
    "code": "const res = await axios.get(`https://financialmodelingprep.com/stable/quote-short/AAPL?apikey=${FMP_"
  },
  {
    "file": "src/scripts/test_fmp_new.ts",
    "line": 18,
    "code": "// 2. Test Historical Full (History)"
  },
  {
    "file": "src/scripts/test_fmp_new.ts",
    "line": 20,
    "code": "console.log('   Testing /historical-price-full/BTCUSD...');"
  },
  {
    "file": "src/scripts/test_fmp_new.ts",
    "line": 21,
    "code": "const res = await axios.get(`https://financialmodelingprep.com/stable/historical-price-full/BTCUSD?a"
  },
  {
    "file": "src/scripts/test_fmp_new.ts",
    "line": 22,
    "code": "if(res.data && res.data.historical) console.log(`   ‚úÖ History Success: ${res.data.historical.length}"
  },
  {
    "file": "src/scripts/test_fmp_raw.ts",
    "line": 12,
    "code": "const apiKey = process.env.FMP_API_KEY;"
  },
  {
    "file": "src/scripts/test_fmp_raw.ts",
    "line": 19,
    "code": "const url = `https://financialmodelingprep.com/api/v3/quote/${symbol}?apikey=${apiKey}`;"
  },
  {
    "file": "src/scripts/test_fmp_raw.ts",
    "line": 21,
    "code": "console.log('\\nüß™ RAW FMP CONNECTIVITY TEST');"
  },
  {
    "file": "src/scripts/test_fmp_stable.ts",
    "line": 10,
    "code": "import fmpService from '../services/fmpService.js';"
  },
  {
    "file": "src/scripts/test_fmp_stable.ts",
    "line": 13,
    "code": "console.log('\\nüì° FMP STABLE API TEST HARNESS');"
  },
  {
    "file": "src/scripts/test_fmp_stable.ts",
    "line": 38,
    "code": "await check('Quote', () => fmpService.getPrice(SYMBOL));"
  },
  {
    "file": "src/scripts/test_fmp_stable.ts",
    "line": 39,
    "code": "await check('Profile', () => fmpService.getCompanyProfile(SYMBOL));"
  },
  {
    "file": "src/scripts/test_fmp_stable.ts",
    "line": 40,
    "code": "await check('Ratios TTM', () => fmpService.getFinancialRatios(SYMBOL));"
  },
  {
    "file": "src/scripts/test_fmp_stable.ts",
    "line": 41,
    "code": "await check('Daily Candles', () => fmpService.getDailyCandles(SYMBOL, 10));"
  },
  {
    "file": "src/scripts/test_fmp_stable.ts",
    "line": 42,
    "code": "await check('Intraday 5m', () => fmpService.getIntraday(SYMBOL));"
  },
  {
    "file": "src/scripts/test_fmp_stable.ts",
    "line": 43,
    "code": "await check('Analyst Targets', () => fmpService.getPriceTargets(SYMBOL));"
  },
  {
    "file": "src/scripts/test_fmp_stable.ts",
    "line": 44,
    "code": "await check('Institutional', () => fmpService.getInstitutionalHolders(SYMBOL));"
  },
  {
    "file": "src/scripts/test_fmp_stable.ts",
    "line": 45,
    "code": "await check('Insider Trades', () => fmpService.getInsiderTrades(SYMBOL));"
  },
  {
    "file": "src/scripts/test_fmp_stable.ts",
    "line": 46,
    "code": "await check('Economic (GDP)', () => fmpService.getEconomicData('GDP'));"
  },
  {
    "file": "src/scripts/test_fmp_stable.ts",
    "line": 47,
    "code": "await check('Market News', () => fmpService.getMarketNews(5));"
  },
  {
    "file": "src/scripts/test_fmp_stable.ts",
    "line": 48,
    "code": "await check('SP500 List', () => fmpService.getSP500List());"
  },
  {
    "file": "src/scripts/test_fmp_stable.ts",
    "line": 52,
    "code": "console.log(JSON.stringify(fmpService.getCapabilities(), null, 2));"
  },
  {
    "file": "src/scripts/test_history.ts",
    "line": 1,
    "code": "import historicalDataService from '../services/historicalDataService.js';"
  },
  {
    "file": "src/scripts/test_history.ts",
    "line": 6,
    "code": "console.log(\"üîç Testing Historical Data Engine...\");"
  },
  {
    "file": "src/scripts/test_history.ts",
    "line": 10,
    "code": "const aapl = await historicalDataService.getPriceHistory('AAPL');"
  },
  {
    "file": "src/scripts/test_history.ts",
    "line": 16,
    "code": "const btc = await historicalDataService.getPriceHistory('BTC');"
  },
  {
    "file": "src/scripts/test_history.ts",
    "line": 22,
    "code": "const tsm = await historicalDataService.getPriceHistory('TSMC');"
  },
  {
    "file": "src/scripts/test_iat.ts",
    "line": 2,
    "code": "import insiderAccuracyService from '../services/insiderAccuracyService.js';"
  },
  {
    "file": "src/scripts/test_iat.ts",
    "line": 5,
    "code": "console.log(\"üß™ TESTING INSIDER ACCURACY TRACKER (IAT)...\");"
  },
  {
    "file": "src/scripts/test_iat.ts",
    "line": 7,
    "code": "// Choose a ticker with insider activity"
  },
  {
    "file": "src/scripts/test_iat.ts",
    "line": 9,
    "code": "console.log(`   Auditing Insiders for ${ticker}...`);"
  },
  {
    "file": "src/scripts/test_iat.ts",
    "line": 11,
    "code": "const result = await insiderAccuracyService.analyze(ticker);"
  },
  {
    "file": "src/scripts/test_iat.ts",
    "line": 15,
    "code": "console.log(`   Top Insider: ${result.top_insider}`);"
  },
  {
    "file": "src/scripts/test_iat.ts",
    "line": 16,
    "code": "console.log(`   Top Accuracy: ${result.top_insider_accuracy}%`);"
  },
  {
    "file": "src/scripts/test_ife.ts",
    "line": 2,
    "code": "import institutionalFlowEngine from '../services/institutionalFlowEngine.js';"
  },
  {
    "file": "src/scripts/test_ife.ts",
    "line": 5,
    "code": "console.log(\"üß™ TESTING INSTITUTIONAL FLOW ENGINE...\");"
  },
  {
    "file": "src/scripts/test_ife.ts",
    "line": 8,
    "code": "const ife = await institutionalFlowEngine.analyzeFlows(ticker);"
  },
  {
    "file": "src/scripts/test_iof.ts",
    "line": 2,
    "code": "import institutionalOrderFlowService from '../services/institutionalOrderFlowService.js';"
  },
  {
    "file": "src/scripts/test_iof.ts",
    "line": 5,
    "code": "console.log(\"üß™ TESTING INSTITUTIONAL ORDER FLOW ENGINE (IOF)...\");"
  },
  {
    "file": "src/scripts/test_iof.ts",
    "line": 10,
    "code": "const result = await institutionalOrderFlowService.analyze(ticker);"
  },
  {
    "file": "src/scripts/test_iof.ts",
    "line": 14,
    "code": "console.log(`   Net Flow: $${result.metrics.net_flow_millions}M`);"
  },
  {
    "file": "src/scripts/test_iof.ts",
    "line": 15,
    "code": "console.log(`   Block Trades: ${result.metrics.block_trade_count}`);"
  },
  {
    "file": "src/scripts/test_iof.ts",
    "line": 16,
    "code": "console.log(`   Dark Prints: ${result.metrics.dark_pool_prints}`);"
  },
  {
    "file": "src/scripts/test_iof.ts",
    "line": 23,
    "code": "if (result.metrics.relative_volume > 0) {"
  },
  {
    "file": "src/scripts/test_ipe.ts",
    "line": 1,
    "code": "import insiderPatternEngine from '../services/insiderPatternEngine.js';"
  },
  {
    "file": "src/scripts/test_ipe.ts",
    "line": 5,
    "code": "console.log(`\\n[TEST_IPE] Running Insider Pattern Engine for ${ticker}...\\n`);"
  },
  {
    "file": "src/scripts/test_ipe.ts",
    "line": 7,
    "code": "const result = await insiderPatternEngine.analyze(ticker);"
  },
  {
    "file": "src/scripts/test_mbe.ts",
    "line": 12,
    "code": "console.log(`   Sector Breadth: ${result.metrics.sector_breadth}%`);"
  },
  {
    "file": "src/scripts/test_mbe.ts",
    "line": 13,
    "code": "console.log(`   RSP/SPY Div: ${result.metrics.rsp_spy_divergence}`);"
  },
  {
    "file": "src/scripts/test_neural_link.ts",
    "line": 8,
    "code": "import economicSurpriseService from '../services/economicSurpriseService.js';"
  },
  {
    "file": "src/scripts/test_neural_link.ts",
    "line": 11,
    "code": "// B. INSTITUTIONAL FLOWS"
  },
  {
    "file": "src/scripts/test_neural_link.ts",
    "line": 14,
    "code": "import optionsRadarService from '../services/optionsRadarService.js';"
  },
  {
    "file": "src/scripts/test_neural_link.ts",
    "line": 15,
    "code": "import institutionalFlowService from '../services/institutionalFlowService.js';"
  },
  {
    "file": "src/scripts/test_neural_link.ts",
    "line": 17,
    "code": "// C. BEHAVIORAL & HISTORICAL"
  },
  {
    "file": "src/scripts/test_neural_link.ts",
    "line": 21,
    "code": "import insiderPatternService from '../services/insiderPatternService.js';"
  },
  {
    "file": "src/scripts/test_neural_link.ts",
    "line": 82,
    "code": "await testVector(\"Economic Surprise (ESI)\", () => economicSurpriseService.calculateESI());"
  },
  {
    "file": "src/scripts/test_neural_link.ts",
    "line": 85,
    "code": "console.log(\"\\n--- [B] INSTITUTIONAL FLOWS ---\");"
  },
  {
    "file": "src/scripts/test_neural_link.ts",
    "line": 88,
    "code": "await testVector(\"Options Radar\", () => optionsRadarService.scanFlows());"
  },
  {
    "file": "src/scripts/test_neural_link.ts",
    "line": 89,
    "code": "await testVector(\"Institutional Flow\", () => institutionalFlowService.scanFlows());"
  },
  {
    "file": "src/scripts/test_neural_link.ts",
    "line": 91,
    "code": "console.log(\"\\n--- [C] BEHAVIORAL & HISTORICAL ---\");"
  },
  {
    "file": "src/scripts/test_neural_link.ts",
    "line": 95,
    "code": "await testVector(\"Insider Pattern Break\", () => insiderPatternService.analyzePattern('NVDA')); // Te"
  },
  {
    "file": "src/scripts/test_neural_link.ts",
    "line": 107,
    "code": "await testVector(\"Catalyst Hunter\", () => catalystHunterService.huntInsiderPlays());"
  },
  {
    "file": "src/scripts/test_ofi.ts",
    "line": 2,
    "code": "import optionsFlowIntelligenceEngine from '../services/optionsFlowIntelligenceEngine.js';"
  },
  {
    "file": "src/scripts/test_ofi.ts",
    "line": 5,
    "code": "console.log(\"üß™ TESTING OPTIONS FLOW INTELLIGENCE (OFI)...\");"
  },
  {
    "file": "src/scripts/test_ofi.ts",
    "line": 10,
    "code": "const result = await optionsFlowIntelligenceEngine.analyze(ticker);"
  },
  {
    "file": "src/scripts/test_pot_layer.ts",
    "line": 16,
    "code": "agent_signals: { gamma: 'bullish', insider: 'buying' }"
  },
  {
    "file": "src/scripts/test_resilience.ts",
    "line": 2,
    "code": "import historicalDataService from '../services/historicalDataService.js';"
  },
  {
    "file": "src/scripts/test_resilience.ts",
    "line": 5,
    "code": "console.log('üîë Testing Resilient Engine (FMP Pro)...');"
  },
  {
    "file": "src/scripts/test_resilience.ts",
    "line": 22,
    "code": "const hist = await historicalDataService.getPriceHistory('BTC');"
  },
  {
    "file": "src/scripts/test_seas.ts",
    "line": 9,
    "code": "console.log(`   Checking Historical Pattern for ${ticker}...`);"
  },
  {
    "file": "src/scripts/test_unified.ts",
    "line": 5,
    "code": "const FMP_KEY = process.env.FMP_API_KEY;"
  },
  {
    "file": "src/scripts/test_unified.ts",
    "line": 10,
    "code": "console.log(`   Keys Loaded: FMP=${!!FMP_KEY}, Tiingo=${!!TIINGO_KEY}`);"
  },
  {
    "file": "src/scripts/test_unified.ts",
    "line": 36,
    "code": "let fmpTicker = symbol;"
  },
  {
    "file": "src/scripts/test_unified.ts",
    "line": 41,
    "code": "fmpTicker = `${clean}USD`;"
  },
  {
    "file": "src/scripts/test_unified.ts",
    "line": 45,
    "code": "// 1. FMP"
  },
  {
    "file": "src/scripts/test_unified.ts",
    "line": 46,
    "code": "if (FMP_KEY) {"
  },
  {
    "file": "src/scripts/test_unified.ts",
    "line": 48,
    "code": "const url = `https://financialmodelingprep.com/stable/quote-short/${fmpTicker}?apikey=${FMP_KEY}`;"
  },
  {
    "file": "src/scripts/test_unified.ts",
    "line": 51,
    "code": "console.log(`   ‚úÖ FMP: ${fmpTicker} ($${res.data[0].price})`);"
  },
  {
    "file": "src/scripts/test_unified_consistency.ts",
    "line": 21,
    "code": "console.log(\"      ‚ö†Ô∏è  War Room returned null (Check FMP key or rate limits)\");"
  },
  {
    "file": "src/scripts/test_uoa.ts",
    "line": 2,
    "code": "import unusualOptionsEngine from '../services/unusualOptionsEngine.js';"
  },
  {
    "file": "src/scripts/test_uoa.ts",
    "line": 5,
    "code": "console.log(\"üß™ TESTING UNUSUAL OPTIONS ACTIVITY (UOA)...\");"
  },
  {
    "file": "src/scripts/test_uoa.ts",
    "line": 7,
    "code": "// We try a ticker that likely has options. AAPL or TSLA are good candidates."
  },
  {
    "file": "src/scripts/test_uoa.ts",
    "line": 11,
    "code": "const result = await unusualOptionsEngine.analyze(ticker);"
  },
  {
    "file": "src/scripts/test_uoa.ts",
    "line": 16,
    "code": "console.log(`   Call/Put Ratio: ${result.metrics.call_put_ratio}`);"
  },
  {
    "file": "src/scripts/test_uoa.ts",
    "line": 17,
    "code": "console.log(`   Net Premium Flow: $${result.metrics.net_premium_flow}`);"
  },
  {
    "file": "src/scripts/test_uoa.ts",
    "line": 24,
    "code": "if (result.metrics.call_put_ratio > 0) {"
  },
  {
    "file": "src/scripts/test_uoa.ts",
    "line": 28,
    "code": "console.log(\"   ‚ö†Ô∏è  No options data returned (or API limit). Engine logic is safe.\");"
  },
  {
    "file": "src/scripts/test_v113_full_restore.ts",
    "line": 4,
    "code": "import fmpService from '../services/fmpService.js';"
  },
  {
    "file": "src/scripts/test_v113_full_restore.ts",
    "line": 44,
    "code": "// Data Source Check (FMP)"
  },
  {
    "file": "src/scripts/test_v113_full_restore.ts",
    "line": 46,
    "code": "const profile = await fmpService.getCompanyProfile(TEST_TICKER);"
  },
  {
    "file": "src/scripts/test_v113_full_restore.ts",
    "line": 47,
    "code": "if (profile && profile.symbol === TEST_TICKER) {"
  },
  {
    "file": "src/scripts/test_v113_full_restore.ts",
    "line": 48,
    "code": "LOG('INGESTION', 'FMP Connection Active', 'PASS');"
  },
  {
    "file": "src/scripts/test_v113_full_restore.ts",
    "line": 50,
    "code": "throw new Error('Profile missing');"
  },
  {
    "file": "src/scripts/test_v113_full_restore.ts",
    "line": 53,
    "code": "LOG('INGESTION', 'FMP Connection Failed (Fallback mode active?)', 'INFO');"
  },
  {
    "file": "src/scripts/test_v113_full_restore.ts",
    "line": 80,
    "code": "if (engines.narrative && engines.insider && engines.gamma) {"
  },
  {
    "file": "src/scripts/test_v113_full_restore.ts",
    "line": 81,
    "code": "LOG('DEEP_BRAIN', `Narrative: ${engines.narrative.score} | Insider: ${engines.insider.score}`, 'PASS"
  },
  {
    "file": "src/scripts/test_v113_full_restore.ts",
    "line": 142,
    "code": "LOG('PORTFOLIO', `Risk Level: ${analysis.portfolio_metrics.risk_level}`, 'PASS');"
  },
  {
    "file": "src/scripts/test_volsurf.ts",
    "line": 7,
    "code": "// AAPL is standard for options data"
  },
  {
    "file": "src/scripts/v113_validator.ts",
    "line": 48,
    "code": "const quote = await marketDataService.getStockPrice('AAPL');"
  },
  {
    "file": "src/scripts/v113_validator.ts",
    "line": 49,
    "code": "if (quote && quote.price > 0) {"
  },
  {
    "file": "src/scripts/v113_validator.ts",
    "line": 50,
    "code": "log('Data Feed', 'PASS', `Live Quote Active: AAPL @ $${quote.price}`);"
  },
  {
    "file": "src/scripts/v113_validator.ts",
    "line": 65,
    "code": "if (fsi.metrics.profitability) {"
  },
  {
    "file": "src/scripts/v113_validator.ts",
    "line": 66,
    "code": "log('FSI Metrics', 'PASS', `Deep Parsing: ${fsi.metrics.profitability}`);"
  },
  {
    "file": "src/scripts/v113_validator.ts",
    "line": 68,
    "code": "log('FSI Metrics', 'WARN', 'Missing granular metrics');"
  },
  {
    "file": "src/scripts/v113_validator.ts",
    "line": 149,
    "code": "const tables = ['financial_health_snapshots', 'ai_stock_tips', 'digest_entries', 'prediction_results"
  },
  {
    "file": "src/scripts/v113_validator.ts",
    "line": 160,
    "code": "console.log(\"‚úÖ DIAGNOSTIC RESULT: GREEN (SYSTEM STABLE)\");"
  },
  {
    "file": "src/scripts/variance_probe.ts",
    "line": 18,
    "code": "metrics: Record<string, number>;"
  },
  {
    "file": "src/scripts/variance_probe.ts",
    "line": 39,
    "code": "console.log(`üì° Scanning ${candidates.length} tickers via FMP Stable API...`);"
  },
  {
    "file": "src/scripts/variance_probe.ts",
    "line": 45,
    "code": "const metrics = {"
  },
  {
    "file": "src/scripts/variance_probe.ts",
    "line": 55,
    "code": "results.push({ ticker: t, metrics });"
  },
  {
    "file": "src/scripts/variance_probe.ts",
    "line": 56,
    "code": "console.log(`‚úÖ (Score: ${metrics['FINAL'].toFixed(0)})`);"
  },
  {
    "file": "src/scripts/variance_probe.ts",
    "line": 73,
    "code": "const keys = Object.keys(results[0].metrics);"
  },
  {
    "file": "src/scripts/variance_probe.ts",
    "line": 80,
    "code": "const val = r.metrics[k];"
  },
  {
    "file": "src/scripts/variance_probe.ts",
    "line": 92,
    "code": "const values = results.map(r => r.metrics[key]);"
  },
  {
    "file": "src/scripts/verify_production_env.ts",
    "line": 4,
    "code": "const requiredKeys = ['JWT_SECRET', 'FMP_API_KEY'];"
  },
  {
    "file": "src/scripts/verify_tiingo.ts",
    "line": 39,
    "code": "const res = await axios.get('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies"
  },
  {
    "file": "src/server.ts",
    "line": 33,
    "code": "console.log('[BOOT] FMP_API_KEY Present:', !!process.env.FMP_API_KEY);"
  },
  {
    "file": "src/server.ts",
    "line": 42,
    "code": "import debugFmpRoutes from './routes/debugFmp.js';"
  },
  {
    "file": "src/server.ts",
    "line": 44,
    "code": "import optionsRoutes from './routes/options.js';"
  },
  {
    "file": "src/server.ts",
    "line": 67,
    "code": "app.use('/api/options', optionsRoutes);"
  },
  {
    "file": "src/server.ts",
    "line": 72,
    "code": "app.use('/api/debug', debugFmpRoutes);"
  },
  {
    "file": "src/server.ts",
    "line": 82,
    "code": "data_ready: !!process.env.FMP_API_KEY"
  },
  {
    "file": "src/services/accuracyFeedbackService.ts",
    "line": 19,
    "code": "ife: 1.0, // Institutional Flow"
  },
  {
    "file": "src/services/accuracyFeedbackService.ts",
    "line": 24,
    "code": "uoa: 1.0, // Unusual Options"
  },
  {
    "file": "src/services/accuracyFeedbackService.ts",
    "line": 26,
    "code": "ipe: 1.0, // Insider Patterns"
  },
  {
    "file": "src/services/agentReliabilityService.ts",
    "line": 13,
    "code": "'ShadowLiquidity', 'NarrativePressure', 'InsiderIntent',"
  },
  {
    "file": "src/services/agentReliabilityService.ts",
    "line": 20,
    "code": "* Main entry point: Analyzes historical performance of all agents."
  },
  {
    "file": "src/services/agentReliabilityService.ts",
    "line": 60,
    "code": "this.attribute(stats['InsiderIntent'], signals.insider?.classification === 'OPPORTUNISTIC', outcome,"
  },
  {
    "file": "src/services/aiPatternDetectionEngine.ts",
    "line": 69,
    "code": "FROM crypto_historical_prices"
  },
  {
    "file": "src/services/aiPatternDetectionEngine.ts",
    "line": 104,
    "code": "FROM stock_historical_prices"
  },
  {
    "file": "src/services/aiTickerExtractor.ts",
    "line": 139,
    "code": "\"reasoning\": \"User discussing large call options position with earnings catalyst\","
  },
  {
    "file": "src/services/alphaReplayService.ts",
    "line": 15,
    "code": "console.log('      üìº Alpha Replay: Simulating Historical Hedge Fund Strategies...');"
  },
  {
    "file": "src/services/alphaReplayService.ts",
    "line": 22,
    "code": "// 2. Define Historical Playbooks"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 14,
    "code": "interface StockQuote {"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 34,
    "code": "const url = `${BASE_URL}?function=GLOBAL_QUOTE&symbol=${ticker}&apikey=${API_KEY}`;"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 48,
    "code": "const quote = data['Global Quote'];"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 50,
    "code": "if (!quote || !quote['05. price']) {"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 56,
    "code": "price: parseFloat(quote['05. price']),"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 57,
    "code": "change: parseFloat(quote['09. change']),"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 58,
    "code": "changePercent: parseFloat(quote['10. change percent'].replace('%', '')),"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 59,
    "code": "timestamp: quote['07. latest trading day'],"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 64,
    "code": "* Get detailed stock quote"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 66,
    "code": "export async function getStockQuote(ticker: string): Promise<StockQuote> {"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 71,
    "code": "const url = `${BASE_URL}?function=GLOBAL_QUOTE&symbol=${ticker}&apikey=${API_KEY}`;"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 80,
    "code": "const quote = data['Global Quote'];"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 82,
    "code": "if (!quote || !quote['05. price']) {"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 88,
    "code": "price: parseFloat(quote['05. price']),"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 89,
    "code": "open: parseFloat(quote['02. open']),"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 90,
    "code": "high: parseFloat(quote['03. high']),"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 91,
    "code": "low: parseFloat(quote['04. low']),"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 92,
    "code": "volume: parseInt(quote['06. volume']),"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 93,
    "code": "previousClose: parseFloat(quote['08. previous close']),"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 94,
    "code": "change: parseFloat(quote['09. change']),"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 95,
    "code": "changePercent: parseFloat(quote['10. change percent'].replace('%', '')),"
  },
  {
    "file": "src/services/alphavantage.ts",
    "line": 124,
    "code": "getStockQuote,"
  },
  {
    "file": "src/services/analystConsensusEngine.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/analystConsensusEngine.ts",
    "line": 17,
    "code": "const targets = await fmpService.getPriceTargets(ticker);"
  },
  {
    "file": "src/services/analystConsensusEngine.ts",
    "line": 41,
    "code": "const candles = await fmpService.getDailyCandles(ticker, 20);"
  },
  {
    "file": "src/services/analystDivergenceService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/analystDivergenceService.ts",
    "line": 14,
    "code": "const targets = await fmpService.getPriceTargets(ticker);"
  },
  {
    "file": "src/services/analystDivergenceService.ts",
    "line": 20,
    "code": "// FMP usually returns latest target first, or a list. We want the most recent aggregate."
  },
  {
    "file": "src/services/analystDivergenceService.ts",
    "line": 22,
    "code": "// For v4/price-target, it often returns a list. We'll take the latest one."
  },
  {
    "file": "src/services/beneficiaryRouterService.ts",
    "line": 4,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/beneficiaryRouterService.ts",
    "line": 81,
    "code": "// Verify ticker exists via FMP (light check)"
  },
  {
    "file": "src/services/beneficiaryRouterService.ts",
    "line": 83,
    "code": "const profile = await fmpService.getCompanyProfile(node.ticker);"
  },
  {
    "file": "src/services/beneficiaryRouterService.ts",
    "line": 84,
    "code": "if (profile) {"
  },
  {
    "file": "src/services/buybackMomentumEngine.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/catalystHunterService.ts",
    "line": 8,
    "code": "async huntInsiderPlays() {"
  },
  {
    "file": "src/services/ceoLanguageService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/ceoLanguageService.ts",
    "line": 9,
    "code": "interface CEOProfile {"
  },
  {
    "file": "src/services/ceoLanguageService.ts",
    "line": 20,
    "code": "async analyze(ticker: string): Promise<CEOProfile | null> {"
  },
  {
    "file": "src/services/ceoLanguageService.ts",
    "line": 24,
    "code": "const transcript = await (fmpService as any).getEarningsTranscript?.(ticker);"
  },
  {
    "file": "src/services/ceoLanguageService.ts",
    "line": 35,
    "code": "ACT AS: FBI Behavioral Profiler."
  },
  {
    "file": "src/services/chainReactionService.ts",
    "line": 62,
    "code": "TASK: Trace the economic chain reaction (L1 -> L2 -> L3)."
  },
  {
    "file": "src/services/collectors/congressCollector.ts",
    "line": 29,
    "code": "category: 'insider',"
  },
  {
    "file": "src/services/collectors/congressCollector.ts",
    "line": 44,
    "code": "category: 'insider',"
  },
  {
    "file": "src/services/collectors/cryptoCollector.ts",
    "line": 5,
    "code": "const FMP_KEY = process.env.FMP_API_KEY;"
  },
  {
    "file": "src/services/collectors/cryptoCollector.ts",
    "line": 8,
    "code": "// Renamed function for compatibility, but logic upgraded to FMP"
  },
  {
    "file": "src/services/collectors/cryptoCollector.ts",
    "line": 11,
    "code": "// 1. Try FMP First (Paid/Stable)"
  },
  {
    "file": "src/services/collectors/cryptoCollector.ts",
    "line": 12,
    "code": "if (FMP_KEY) {"
  },
  {
    "file": "src/services/collectors/cryptoCollector.ts",
    "line": 14,
    "code": "const url = `https://financialmodelingprep.com/stable/quote?symbol=BTCUSD,ETHUSD,SOLUSD,DOGEUSD,XRPU"
  },
  {
    "file": "src/services/collectors/cryptoCollector.ts",
    "line": 25,
    "code": "VALUES ('FMP Crypto', 'crypto', $1, NOW(), $2)"
  },
  {
    "file": "src/services/collectors/cryptoCollector.ts",
    "line": 32,
    "code": "// FMP Failed, fall through to backup"
  },
  {
    "file": "src/services/collectors/cryptoCollector.ts",
    "line": 33,
    "code": "console.warn(\"FMP Crypto Failed, falling back...\");"
  },
  {
    "file": "src/services/collectors/cryptoCollector.ts",
    "line": 39,
    "code": "const res = await axios.get('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,sola"
  },
  {
    "file": "src/services/collectors/fredCollector.ts",
    "line": 28,
    "code": "category: 'economic',"
  },
  {
    "file": "src/services/collectors/insiderCollector.ts",
    "line": 6,
    "code": "export async function collectInsiderTrades() {"
  },
  {
    "file": "src/services/collectors/insiderCollector.ts",
    "line": 47,
    "code": "category: 'insider_trade',"
  },
  {
    "file": "src/services/collectors/insiderCollector.ts",
    "line": 51,
    "code": "content: `Insider Filing: ${title}`,"
  },
  {
    "file": "src/services/collectors/whaleCollector.ts",
    "line": 11,
    "code": "const res = await axios.get('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=vo"
  },
  {
    "file": "src/services/commodityShockService.ts",
    "line": 59,
    "code": "const quote = await marketDataService.getStockPrice(comm.ticker);"
  },
  {
    "file": "src/services/commodityShockService.ts",
    "line": 62,
    "code": "if (quote && quote.changePercent > 0.5) {"
  },
  {
    "file": "src/services/commodityShockService.ts",
    "line": 69,
    "code": "reason: `Supply Threat Detected: \"${triggerHeadline.substring(0, 60)}...\". ${comm.ticker} reacting ("
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 3,
    "code": "// UPDATED: November 2025 - Uses NEW FMP /stable/ endpoints"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 12,
    "code": "const FMP_API_KEY = process.env.FMP_API_KEY;"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 13,
    "code": "const FMP_BASE_URL = 'https://financialmodelingprep.com/stable';"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 42,
    "code": "* NEW FMP API: Fetch data using /stable/ endpoints (November 2025)"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 44,
    "code": "private async fetchFMPData(endpoint: string): Promise<any> {"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 45,
    "code": "if (!FMP_API_KEY) {"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 46,
    "code": "console.log('  ‚ö†Ô∏è FMP_API_KEY not configured, using general knowledge');"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 51,
    "code": "const url = `${FMP_BASE_URL}${endpoint}`;"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 53,
    "code": "const fullUrl = `${url}${separator}apikey=${FMP_API_KEY}`;"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 61,
    "code": "console.log(`  ‚ö†Ô∏è FMP request failed: ${endpoint}`);"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 70,
    "code": "* Gather comprehensive company data using NEW FMP /stable/ API"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 77,
    "code": "profile: null,"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 78,
    "code": "quote: null,"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 80,
    "code": "insiders: [],"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 81,
    "code": "ratios: null,"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 82,
    "code": "metrics: null,"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 87,
    "code": "institutional: null"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 90,
    "code": "// Company Profile (NEW: /stable/profile)"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 91,
    "code": "const profile = await this.fetchFMPData(`/profile?symbol=${ticker}`);"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 92,
    "code": "if (profile && Array.isArray(profile) && profile.length > 0) {"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 93,
    "code": "data.profile = profile[0];"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 94,
    "code": "console.log(`    - Profile: Yes`);"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 97,
    "code": "// Real-time quote (NEW: /stable/quote)"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 98,
    "code": "const quote = await this.fetchFMPData(`/quote?symbol=${ticker}`);"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 99,
    "code": "if (quote && Array.isArray(quote) && quote.length > 0) {"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 100,
    "code": "data.quote = quote[0];"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 101,
    "code": "console.log(`    - Quote: Yes`);"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 104,
    "code": "// Key executives (NEW: /stable/key-executives)"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 105,
    "code": "const executives = await this.fetchFMPData(`/key-executives?symbol=${ticker}`);"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 111,
    "code": "// Insider trading (NEW: /stable/insider-trading/search)"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 112,
    "code": "const insiders = await this.fetchFMPData(`/insider-trading/search?symbol=${ticker}&page=0&limit=10`)"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 113,
    "code": "if (insiders && Array.isArray(insiders)) {"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 114,
    "code": "data.insiders = insiders;"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 115,
    "code": "console.log(`    - Insiders: ${insiders.length}`);"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 118,
    "code": "// Financial ratios TTM (NEW: /stable/ratios-ttm)"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 119,
    "code": "const ratios = await this.fetchFMPData(`/ratios-ttm?symbol=${ticker}`);"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 120,
    "code": "if (ratios && Array.isArray(ratios) && ratios.length > 0) {"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 121,
    "code": "data.ratios = ratios[0];"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 122,
    "code": "console.log(`    - Ratios: Yes`);"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 125,
    "code": "// Key metrics TTM (NEW: /stable/key-metrics-ttm)"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 126,
    "code": "const metrics = await this.fetchFMPData(`/key-metrics-ttm?symbol=${ticker}`);"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 127,
    "code": "if (metrics && Array.isArray(metrics) && metrics.length > 0) {"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 128,
    "code": "data.metrics = metrics[0];"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 129,
    "code": "console.log(`    - Metrics: Yes`);"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 132,
    "code": "// Financial growth (NEW: /stable/financial-growth)"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 133,
    "code": "const growth = await this.fetchFMPData(`/financial-growth?symbol=${ticker}&limit=1`);"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 139,
    "code": "// Income statement (NEW: /stable/income-statement)"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 140,
    "code": "const income = await this.fetchFMPData(`/income-statement?symbol=${ticker}&limit=1`);"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 146,
    "code": "// Balance sheet (NEW: /stable/balance-sheet-statement)"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 147,
    "code": "const balance = await this.fetchFMPData(`/balance-sheet-statement?symbol=${ticker}&limit=1`);"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 153,
    "code": "// Cash flow statement (NEW: /stable/cash-flow-statement)"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 154,
    "code": "const cashflow = await this.fetchFMPData(`/cash-flow-statement?symbol=${ticker}&limit=1`);"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 160,
    "code": "// Institutional holders (NEW: /stable/institutional-ownership/latest)"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 161,
    "code": "const institutional = await this.fetchFMPData(`/institutional-ownership/symbol-positions-summary?sym"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 162,
    "code": "if (institutional && Array.isArray(institutional)) {"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 163,
    "code": "data.institutional = institutional.slice(0, 10);"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 164,
    "code": "console.log(`    - Institutional: ${institutional.length}`);"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 174,
    "code": "async analyzeCompany(ticker: string, historicalInsights?: string): Promise<ComprehensiveAnalysis> {"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 183,
    "code": "const prompt = this.buildAnalysisPrompt(ticker, companyData, historicalInsights);"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 217,
    "code": "private buildAnalysisPrompt(ticker: string, data: any, historicalInsights?: string): string {"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 221,
    "code": "// Add historical performance insights if available"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 222,
    "code": "const performanceContext = historicalInsights || 'No historical performance data available yet.';"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 231,
    "code": "HISTORICAL PERFORMANCE INSIGHTS:"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 240,
    "code": "- Insider ownership and alignment"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 246,
    "code": "- Economic moat (switching costs, network effects, scale)"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 274,
    "code": "- P/E ratio vs historical and peers"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 284,
    "code": "- Institutional interest"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 298,
    "code": "- Compare to historical winners/losers"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 366,
    "code": "\"comparison\": \"Compare to historical winners/losers or similar companies. What pattern does this mat"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 376,
    "code": "// Company profile"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 377,
    "code": "if (data.profile) {"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 378,
    "code": "context += `COMPANY PROFILE:"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 379,
    "code": "- Name: ${data.profile.companyName || data.profile.symbol}"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 380,
    "code": "- Sector: ${data.profile.sector || 'Unknown'}"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 381,
    "code": "- Industry: ${data.profile.industry || 'Unknown'}"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 382,
    "code": "- Market Cap: $${(data.profile.mktCap / 1e9).toFixed(2)}B"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 383,
    "code": "- Description: ${data.profile.description?.substring(0, 300) || 'No description'}"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 384,
    "code": "- CEO: ${data.profile.ceo || 'Unknown'}"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 385,
    "code": "- Website: ${data.profile.website || 'Unknown'}"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 390,
    "code": "// Current quote"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 391,
    "code": "if (data.quote) {"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 392,
    "code": "context += `CURRENT QUOTE:"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 393,
    "code": "- Price: $${data.quote.price}"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 394,
    "code": "- Change: ${data.quote.changesPercentage?.toFixed(2)}%"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 395,
    "code": "- Volume: ${(data.quote.volume / 1e6).toFixed(2)}M"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 396,
    "code": "- Avg Volume: ${(data.quote.avgVolume / 1e6).toFixed(2)}M"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 397,
    "code": "- Market Cap: $${(data.quote.marketCap / 1e9).toFixed(2)}B"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 398,
    "code": "- P/E Ratio: ${data.quote.pe?.toFixed(2) || 'N/A'}"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 399,
    "code": "- 52W High: $${data.quote.yearHigh}"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 400,
    "code": "- 52W Low: $${data.quote.yearLow}"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 414,
    "code": "// Financial ratios"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 415,
    "code": "if (data.ratios) {"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 416,
    "code": "context += `FINANCIAL RATIOS (TTM):"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 417,
    "code": "- ROE: ${(data.ratios.returnOnEquityTTM * 100).toFixed(2)}%"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 418,
    "code": "- ROIC: ${data.ratios.returnOnCapitalEmployedTTM ? (data.ratios.returnOnCapitalEmployedTTM * 100).to"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 419,
    "code": "- Gross Margin: ${(data.ratios.grossProfitMarginTTM * 100).toFixed(2)}%"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 420,
    "code": "- Operating Margin: ${(data.ratios.operatingProfitMarginTTM * 100).toFixed(2)}%"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 421,
    "code": "- Net Margin: ${(data.ratios.netProfitMarginTTM * 100).toFixed(2)}%"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 422,
    "code": "- Current Ratio: ${data.ratios.currentRatioTTM?.toFixed(2)}"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 423,
    "code": "- Debt/Equity: ${data.ratios.debtEquityRatioTTM?.toFixed(2)}"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 428,
    "code": "// Growth metrics"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 430,
    "code": "context += `GROWTH METRICS:"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 471,
    "code": "// Insider trading"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 472,
    "code": "if (data.insiders && data.insiders.length > 0) {"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 473,
    "code": "const buyCount = data.insiders.filter((t: any) =>"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 477,
    "code": "const sellCount = data.insiders.filter((t: any) =>"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 481,
    "code": "context += `INSIDER TRADING (Recent):"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 482,
    "code": "- Total Transactions: ${data.insiders.length}"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 490,
    "code": "// Institutional ownership"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 491,
    "code": "if (data.institutional && data.institutional.length > 0) {"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 492,
    "code": "context += `INSTITUTIONAL OWNERSHIP:"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 493,
    "code": "- Top Holders: ${data.institutional.length}"
  },
  {
    "file": "src/services/comprehensiveBusinessAnalysis.ts",
    "line": 502,
    "code": "- FMP API data not available - analysis based on public information"
  },
  {
    "file": "src/services/confidenceAdjustmentService.ts",
    "line": 20,
    "code": "'insider_play': 80,"
  },
  {
    "file": "src/services/confidenceDriftService.ts",
    "line": 3,
    "code": "interface DriftMetrics {"
  },
  {
    "file": "src/services/confidenceDriftService.ts",
    "line": 8,
    "code": "status: 'STABLE' | 'INFLATED' | 'TIMID';"
  },
  {
    "file": "src/services/confidenceDriftService.ts",
    "line": 13,
    "code": "private cache: DriftMetrics | null = null;"
  },
  {
    "file": "src/services/confidenceDriftService.ts",
    "line": 19,
    "code": "async getDriftCorrection(): Promise<DriftMetrics> {"
  },
  {
    "file": "src/services/confidenceDriftService.ts",
    "line": 33,
    "code": "let status: DriftMetrics['status'] = 'STABLE';"
  },
  {
    "file": "src/services/confidenceDriftService.ts",
    "line": 37,
    "code": "const metrics: DriftMetrics = {"
  },
  {
    "file": "src/services/confidenceDriftService.ts",
    "line": 45,
    "code": "this.cache = metrics;"
  },
  {
    "file": "src/services/confidenceDriftService.ts",
    "line": 47,
    "code": "return metrics;"
  },
  {
    "file": "src/services/confidenceDriftService.ts",
    "line": 50,
    "code": "return { correction_factor: 1.0, drift_bias: 0, avg_confidence: 75, actual_win_rate: 75, status: 'ST"
  },
  {
    "file": "src/services/confidenceLedgerService.ts",
    "line": 5,
    "code": "// 1. ADJUST: Apply historical truth to current optimism"
  },
  {
    "file": "src/services/confidenceLedgerService.ts",
    "line": 24,
    "code": "reason: `[CONFIDENCE LEDGER] System is historically overconfident on ${bucket} ${sector} picks (Real"
  },
  {
    "file": "src/services/confidenceRecalibrationService.ts",
    "line": 81,
    "code": "const dsc = await drawdownSensitivityService.getRiskProfile(tier);"
  },
  {
    "file": "src/services/confidenceRecalibrationService.ts",
    "line": 99,
    "code": "if (weights.shadow > 1.1) topDriver = \"Institutional Flow\";"
  },
  {
    "file": "src/services/consensusEngine.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/consensusEngine.ts",
    "line": 12,
    "code": "insider: boolean;"
  },
  {
    "file": "src/services/consensusEngine.ts",
    "line": 28,
    "code": "insider: false,"
  },
  {
    "file": "src/services/consensusEngine.ts",
    "line": 62,
    "code": "details.push(`Technical Stable (RSI ${tech.rsi.toFixed(0)})`);"
  },
  {
    "file": "src/services/consensusEngine.ts",
    "line": 87,
    "code": "if (factors.insider) score++;"
  },
  {
    "file": "src/services/corporateActionsEngine.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/corporateActionsEngine.ts",
    "line": 19,
    "code": "// Fetch raw data (simulated or real via FMP)"
  },
  {
    "file": "src/services/corporateActionsEngine.ts",
    "line": 20,
    "code": "const profile = await fmpService.getCompanyProfile(ticker);"
  },
  {
    "file": "src/services/corporateActionsEngine.ts",
    "line": 26,
    "code": "dividends: !!profile?.lastDiv,"
  },
  {
    "file": "src/services/corporateActionsEngine.ts",
    "line": 37,
    "code": "signal.details.push(`Pays Dividend: ${profile.lastDiv}`);"
  },
  {
    "file": "src/services/corporateQualityService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/corporateQualityService.ts",
    "line": 2,
    "code": "import historicalDataService from './historicalDataService.js';"
  },
  {
    "file": "src/services/corporateQualityService.ts",
    "line": 6,
    "code": "rating: 'PRISTINE' | 'STABLE' | 'WEAK' | 'DISTRESSED';"
  },
  {
    "file": "src/services/corporateQualityService.ts",
    "line": 24,
    "code": "const [ratios, income, balance, cashflow] = await Promise.all(["
  },
  {
    "file": "src/services/corporateQualityService.ts",
    "line": 25,
    "code": "fmpService.getFinancialRatios(ticker, 'annual', 1),"
  },
  {
    "file": "src/services/corporateQualityService.ts",
    "line": 26,
    "code": "fmpService.getIncomeStatement(ticker, 'annual', 2),"
  },
  {
    "file": "src/services/corporateQualityService.ts",
    "line": 27,
    "code": "fmpService.getBalanceSheet(ticker, 'quarter', 1),"
  },
  {
    "file": "src/services/corporateQualityService.ts",
    "line": 28,
    "code": "fmpService.getCashFlowStatement(ticker, 'annual', 1)"
  },
  {
    "file": "src/services/corporateQualityService.ts",
    "line": 33,
    "code": "if (!ratios || ratios.length === 0) {"
  },
  {
    "file": "src/services/corporateQualityService.ts",
    "line": 37,
    "code": "const r = ratios[0];"
  },
  {
    "file": "src/services/corporateQualityService.ts",
    "line": 66,
    "code": "else if (score < 85) rating = 'STABLE';"
  },
  {
    "file": "src/services/corporateQualityService.ts",
    "line": 78,
    "code": "const history = await historicalDataService.getStockHistory(ticker, 200);"
  },
  {
    "file": "src/services/corporateQualityService.ts",
    "line": 84,
    "code": "// If price > 200SMA, market trusts it (bullish/stable)"
  },
  {
    "file": "src/services/corporateQualityService.ts",
    "line": 86,
    "code": "return { score: 75, rating: 'STABLE', flags: ['Inferred from Uptrend'], passed: true, dilution_pct: "
  },
  {
    "file": "src/services/correlationAnalysisService.ts",
    "line": 2,
    "code": "import historicalDataService from './historicalDataService.js';"
  },
  {
    "file": "src/services/correlationAnalysisService.ts",
    "line": 16,
    "code": "const quote = await marketDataService.getStockPrice(d);"
  },
  {
    "file": "src/services/correlationAnalysisService.ts",
    "line": 17,
    "code": "if (quote) {"
  },
  {
    "file": "src/services/correlationAnalysisService.ts",
    "line": 19,
    "code": "const move = quote.changePercent || 0;"
  },
  {
    "file": "src/services/correlationAnalysisService.ts",
    "line": 20,
    "code": "driverData.set(d, { move, price: quote.price });"
  },
  {
    "file": "src/services/correlationAnalysisService.ts",
    "line": 39,
    "code": "const quote = await marketDataService.getStockPrice(ticker);"
  },
  {
    "file": "src/services/correlationAnalysisService.ts",
    "line": 40,
    "code": "// Fallback if quote fails: check DB"
  },
  {
    "file": "src/services/correlationAnalysisService.ts",
    "line": 41,
    "code": "let price = quote ? quote.price : 0;"
  },
  {
    "file": "src/services/correlationHunterService.ts",
    "line": 2,
    "code": "import historicalDataService from './historicalDataService.js';"
  },
  {
    "file": "src/services/correlationHunterService.ts",
    "line": 20,
    "code": "jobManager.startJob('CORRELATION', 'Fetching Historical Data...');"
  },
  {
    "file": "src/services/correlationHunterService.ts",
    "line": 32,
    "code": "const driverHist = await historicalDataService.getCryptoHistory(pair.driver, 90);"
  },
  {
    "file": "src/services/correlationHunterService.ts",
    "line": 33,
    "code": "const targetHist = await historicalDataService.getStockHistory(pair.target, 90);"
  },
  {
    "file": "src/services/crisisAmplifierService.ts",
    "line": 4,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/crisisAmplifierService.ts",
    "line": 20,
    "code": "const quote = await marketDataService.getStockPrice('^VIX');"
  },
  {
    "file": "src/services/crisisAmplifierService.ts",
    "line": 21,
    "code": "if (quote) vix = quote.price;"
  },
  {
    "file": "src/services/crisisAmplifierService.ts",
    "line": 58,
    "code": "const profile = await fmpService.getCompanyProfile(ticker);"
  },
  {
    "file": "src/services/crisisAmplifierService.ts",
    "line": 59,
    "code": "// FMP 'isEtf' check or just basic earnings check if available."
  },
  {
    "file": "src/services/crisisAmplifierService.ts",
    "line": 61,
    "code": "if (profile && !profile.isEtf && profile.beta > 1.5) {"
  },
  {
    "file": "src/services/crisisAmplifierService.ts",
    "line": 63,
    "code": "reason.push(`High Beta (${profile.beta}) penalised in crisis.`);"
  },
  {
    "file": "src/services/crossAssetCorrelationEngine.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/crossAssetCorrelationEngine.ts",
    "line": 34,
    "code": "details: ['Correlation stable']"
  },
  {
    "file": "src/services/crossAssetRiskService.ts",
    "line": 2,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/crossAssetRiskService.ts",
    "line": 9,
    "code": "metrics: {"
  },
  {
    "file": "src/services/crossAssetRiskService.ts",
    "line": 26,
    "code": "fmpService.getTreasuryRates(),"
  },
  {
    "file": "src/services/crossAssetRiskService.ts",
    "line": 33,
    "code": "// 2. CALCULATE METRICS"
  },
  {
    "file": "src/services/crossAssetRiskService.ts",
    "line": 106,
    "code": "metrics: {"
  },
  {
    "file": "src/services/crossAssetRiskService.ts",
    "line": 125,
    "code": "metrics: { yield_spread_10y2y: 0, credit_spread_hyg_ief: 0, oil_volatility: 0, dollar_strength: 0 },"
  },
  {
    "file": "src/services/crossAssetRiskService.ts",
    "line": 134,
    "code": "INSERT INTO cross_asset_risk_snapshots (risk_score, risk_regime, drivers, metrics, snapshot_date)"
  },
  {
    "file": "src/services/crossAssetRiskService.ts",
    "line": 137,
    "code": "risk_score = $1, risk_regime = $2, drivers = $3, metrics = $4, created_at = NOW()"
  },
  {
    "file": "src/services/crossAssetRiskService.ts",
    "line": 138,
    "code": "`, [data.risk_score, data.regime, JSON.stringify(data.drivers), JSON.stringify(data.metrics)]);"
  },
  {
    "file": "src/services/cryptoIntelligenceService.ts",
    "line": 21,
    "code": "const res = await axios.get(`https://api.binance.com/api/v3/ticker/price?symbol=${symbol}`);"
  },
  {
    "file": "src/services/cryptoStockCorrelation.ts",
    "line": 14,
    "code": "const response = await axios.get('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT');"
  },
  {
    "file": "src/services/cryptoStockCorrelationService.ts",
    "line": 41,
    "code": "const res = await axios.get('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,sola"
  },
  {
    "file": "src/services/currencyShockService.ts",
    "line": 5,
    "code": "regime: 'KING_DOLLAR' | 'DOLLAR_CRASH' | 'CARRY_UNWIND' | 'STABLE';"
  },
  {
    "file": "src/services/currencyShockService.ts",
    "line": 22,
    "code": "const uupQuote = await marketDataService.getStockPrice('UUP');"
  },
  {
    "file": "src/services/currencyShockService.ts",
    "line": 25,
    "code": "const price = uupQuote ? (uupQuote.price * 3.6) : 104.50;"
  },
  {
    "file": "src/services/currencyShockService.ts",
    "line": 26,
    "code": "const change = uupQuote ? (uupQuote.changePercent || 0) : 0.0; // <-- FIX: Ensure 0 if undefined"
  },
  {
    "file": "src/services/currencyShockService.ts",
    "line": 29,
    "code": "let regime: CurrencyShock['regime'] = 'STABLE';"
  },
  {
    "file": "src/services/currencyShockService.ts",
    "line": 72,
    "code": "regime: 'STABLE', shock_level: 'LOW', confidence_modifier: 0,"
  },
  {
    "file": "src/services/currencyShockService.ts",
    "line": 73,
    "code": "reason: \"Data Error (Defaulting to Stable)\", dxy_price: 0, dxy_change: 0,"
  },
  {
    "file": "src/services/dailyIntelligenceService.ts",
    "line": 22,
    "code": "economicIndicators: any[];"
  },
  {
    "file": "src/services/dailyIntelligenceService.ts",
    "line": 55,
    "code": "economicIndicators: categorized.economic,"
  },
  {
    "file": "src/services/dailyIntelligenceService.ts",
    "line": 108,
    "code": "const economic = entries"
  },
  {
    "file": "src/services/dailyIntelligenceService.ts",
    "line": 109,
    "code": ".filter(e => e.source_type === 'economic')"
  },
  {
    "file": "src/services/dailyIntelligenceService.ts",
    "line": 120,
    "code": "economic,"
  },
  {
    "file": "src/services/dailyIntelligenceService.ts",
    "line": 173,
    "code": "return `You are a senior intelligence analyst preparing a daily briefing for institutional investors"
  },
  {
    "file": "src/services/dailyIntelligenceService.ts",
    "line": 181,
    "code": "**Economic Indicators (${categorized.economic.length}):**"
  },
  {
    "file": "src/services/dailyIntelligenceService.ts",
    "line": 182,
    "code": "${categorized.economic.map((e: any) => `- ${e.ai_summary}`).join('\\n')}"
  },
  {
    "file": "src/services/dailyIntelligenceService.ts",
    "line": 228,
    "code": "const economic = report.economicIndicators.map(e => ({"
  },
  {
    "file": "src/services/dailyIntelligenceService.ts",
    "line": 243,
    "code": "geopolitical_alerts, economic_indicators, crypto_trends, recommendations)"
  },
  {
    "file": "src/services/dailyIntelligenceService.ts",
    "line": 251,
    "code": "economic_indicators = EXCLUDED.economic_indicators,"
  },
  {
    "file": "src/services/dailyIntelligenceService.ts",
    "line": 261,
    "code": "JSON.stringify(economic),"
  },
  {
    "file": "src/services/dailySummaryService.ts",
    "line": 29,
    "code": "// Insider Moves"
  },
  {
    "file": "src/services/dailySummaryService.ts",
    "line": 30,
    "code": "const insiderRes = await pool.query(`"
  },
  {
    "file": "src/services/dailySummaryService.ts",
    "line": 31,
    "code": "SELECT details FROM insider_intent_logs"
  },
  {
    "file": "src/services/dailySummaryService.ts",
    "line": 49,
    "code": "MACRO: ${regime.current_regime} (${regime.metrics.inflation_trend} Inflation)"
  },
  {
    "file": "src/services/dailySummaryService.ts",
    "line": 51,
    "code": "INSIDER: ${insiderRes.rows.map(r => r.details).join(' | ')}"
  },
  {
    "file": "src/services/dailySummaryService.ts",
    "line": 96,
    "code": "bullets: [\"Analyzing latest data...\", \"Check back in 5 minutes.\", \"System is processing new signals."
  },
  {
    "file": "src/services/darkPoolService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/darkPoolService.ts",
    "line": 20,
    "code": "const candles = await fmpService.getIntraday(ticker);"
  },
  {
    "file": "src/services/dataIngestionService.ts",
    "line": 42,
    "code": "async fetchInsiderActivity() { return []; }"
  },
  {
    "file": "src/services/dataIngestionService.ts",
    "line": 43,
    "code": "async fetchEconomicCalendar() { return []; }"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 2,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 11,
    "code": "* Implements Waterfall Failover: FMP -> Tiingo -> Yahoo -> Null."
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 21,
    "code": "// 1. FMP - Primary"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 22,
    "code": "this.providers.push({ name: 'FMP', service: fmpService, priority: 1 });"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 32,
    "code": "if (p.name === 'FMP') {"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 33,
    "code": "const quote = await p.service.getPrice(ticker);"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 34,
    "code": "if (quote) return {"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 35,
    "code": "price: quote.price,"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 36,
    "code": "change: quote.change,"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 37,
    "code": "changePercent: quote.changesPercentage || quote.changePercent,"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 38,
    "code": "volume: quote.volume || 0,"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 40,
    "code": "source: 'FMP'"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 44,
    "code": "const quote = await p.service.getPrice(ticker);"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 45,
    "code": "if (quote && typeof quote.price === 'number') return {"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 46,
    "code": "price: quote.price,"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 47,
    "code": "change: quote.change || 0,"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 48,
    "code": "changePercent: quote.changePercent || 0,"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 49,
    "code": "volume: quote.volume || 0,"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 55,
    "code": "const quote = await p.service.getPrice(ticker);"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 56,
    "code": "if (quote) return {"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 57,
    "code": "price: quote.price,"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 58,
    "code": "change: quote.change,"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 59,
    "code": "changePercent: quote.pct,"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 72,
    "code": "const fmpHist = await fmpService.getDailyCandles(ticker, days);"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 73,
    "code": "if (fmpHist && fmpHist.length > 0) return fmpHist.map((c: any) => ({"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 87,
    "code": "const profile = await fmpService.getCompanyProfile(ticker);"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 88,
    "code": "const ratios = await fmpService.getFinancialRatios(ticker);"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 89,
    "code": "const metrics = await fmpService.getKeyMetrics(ticker);"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 91,
    "code": "if (profile) {"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 92,
    "code": "const m = metrics && metrics[0] ? metrics[0] : {};"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 93,
    "code": "const r = ratios && ratios[0] ? ratios[0] : {};"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 96,
    "code": "symbol: profile.symbol,"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 97,
    "code": "marketCap: profile.mktCap || 0,"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 103,
    "code": "revenue: m.revenuePerShare * profile.price || 0,"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 107,
    "code": "beta: profile.beta || 1,"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 108,
    "code": "source: 'FMP'"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 120,
    "code": "// 1. Try FMP News"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 122,
    "code": "const fmpNews = await fmpService.getCompanyNews(ticker, limit);"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 123,
    "code": "if (fmpNews && fmpNews.length > 0) {"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 124,
    "code": "return fmpNews.map((n: any) => ({"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 128,
    "code": "source: n.source || 'FMP',"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 132,
    "code": "sentiment: 'Neutral' // FMP doesn't give sentiment by default"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 135,
    "code": "} catch (e) { console.warn('[Grid] FMP News failed', e.message); }"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 144,
    "code": "const news = await fmpService.getMarketNews(limit);"
  },
  {
    "file": "src/services/dataProviderGrid.ts",
    "line": 150,
    "code": "source: n.source || 'FMP',"
  },
  {
    "file": "src/services/dataVerificationService.ts",
    "line": 43,
    "code": "`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=SPY&apikey=${API_KEY}`"
  },
  {
    "file": "src/services/dataVerificationService.ts",
    "line": 46,
    "code": "const quote = response.data['Global Quote'];"
  },
  {
    "file": "src/services/dataVerificationService.ts",
    "line": 47,
    "code": "if (quote && quote['05. price']) {"
  },
  {
    "file": "src/services/dataVerificationService.ts",
    "line": 52,
    "code": "lastPrice: parseFloat(quote['05. price']),"
  },
  {
    "file": "src/services/dataVerificationService.ts",
    "line": 53,
    "code": "timestamp: quote['07. latest trading day']"
  },
  {
    "file": "src/services/dataVerificationService.ts",
    "line": 74,
    "code": "'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=tru"
  },
  {
    "file": "src/services/deepDiveRoutes.ts",
    "line": 69,
    "code": "* Get historical pattern matches"
  },
  {
    "file": "src/services/deepValuationEngine.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/deepValuationEngine.ts",
    "line": 6,
    "code": "const metrics = await fmpService.getKeyMetrics(ticker);"
  },
  {
    "file": "src/services/deepValuationEngine.ts",
    "line": 8,
    "code": "if (!metrics || metrics.length === 0) {"
  },
  {
    "file": "src/services/deepValuationEngine.ts",
    "line": 14,
    "code": "metrics: { pe_ratio: 0, peg_ratio: 0, ev_ebitda: 0, fcf_yield: 0 },"
  },
  {
    "file": "src/services/deepValuationEngine.ts",
    "line": 19,
    "code": "const m = metrics[0];"
  },
  {
    "file": "src/services/deepValuationEngine.ts",
    "line": 31,
    "code": "metrics: {"
  },
  {
    "file": "src/services/deepValuationEngine.ts",
    "line": 41,
    "code": "return { score: 0, valuation_band: 'UNKNOWN', fair_value: 0, upside_percent: 0, metrics: { pe_ratio:"
  },
  {
    "file": "src/services/diagnosticsService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/diagnosticsService.ts",
    "line": 8,
    "code": "const fmpStatus = await fmpService.checkConnection();"
  },
  {
    "file": "src/services/diagnosticsService.ts",
    "line": 14,
    "code": "// FMP Online: +25"
  },
  {
    "file": "src/services/diagnosticsService.ts",
    "line": 15,
    "code": "// Even if FMP fails, we start at 75% (Operational but Degraded)"
  },
  {
    "file": "src/services/diagnosticsService.ts",
    "line": 18,
    "code": "if (fmpStatus.success) healthScore += 25;"
  },
  {
    "file": "src/services/diagnosticsService.ts",
    "line": 29,
    "code": "fmp: fmpStatus.success ? 'ONLINE' : 'WARN: Using Cached/Fallback Data',"
  },
  {
    "file": "src/services/divergenceDetectorService.ts",
    "line": 1,
    "code": "import historicalDataService from './historicalDataService.js';"
  },
  {
    "file": "src/services/divergenceDetectorService.ts",
    "line": 29,
    "code": "const history = await historicalDataService.getStockHistory(ticker, 150);"
  },
  {
    "file": "src/services/drawdownSensitivityService.ts",
    "line": 3,
    "code": "interface DSCProfile {"
  },
  {
    "file": "src/services/drawdownSensitivityService.ts",
    "line": 4,
    "code": "profile_key: string;"
  },
  {
    "file": "src/services/drawdownSensitivityService.ts",
    "line": 13,
    "code": "private cache: Record<string, DSCProfile> = {};"
  },
  {
    "file": "src/services/drawdownSensitivityService.ts",
    "line": 19,
    "code": "async getRiskProfile(tier: string): Promise<DSCProfile> {"
  },
  {
    "file": "src/services/drawdownSensitivityService.ts",
    "line": 24,
    "code": "profile_key: key,"
  },
  {
    "file": "src/services/drawdownSensitivityService.ts",
    "line": 33,
    "code": "* LEARN: Analyzes past trades to update sensitivity profiles"
  },
  {
    "file": "src/services/drawdownSensitivityService.ts",
    "line": 36,
    "code": "async calibrateProfiles() {"
  },
  {
    "file": "src/services/drawdownSensitivityService.ts",
    "line": 43,
    "code": "WITH metrics AS ("
  },
  {
    "file": "src/services/drawdownSensitivityService.ts",
    "line": 55,
    "code": "SELECT * FROM metrics"
  },
  {
    "file": "src/services/drawdownSensitivityService.ts",
    "line": 72,
    "code": "modifier = 0.9; // Tighten stops for stable assets"
  },
  {
    "file": "src/services/drawdownSensitivityService.ts",
    "line": 78,
    "code": "INSERT INTO drawdown_sensitivity_profiles ("
  },
  {
    "file": "src/services/drawdownSensitivityService.ts",
    "line": 79,
    "code": "profile_key, avg_mae_pct, max_tolerable_drawdown,"
  },
  {
    "file": "src/services/drawdownSensitivityService.ts",
    "line": 82,
    "code": "ON CONFLICT (profile_key) DO UPDATE SET"
  },
  {
    "file": "src/services/drawdownSensitivityService.ts",
    "line": 100,
    "code": "const res = await pool.query(\"SELECT * FROM drawdown_sensitivity_profiles\");"
  },
  {
    "file": "src/services/drawdownSensitivityService.ts",
    "line": 102,
    "code": "this.cache[r.profile_key] = {"
  },
  {
    "file": "src/services/drawdownSensitivityService.ts",
    "line": 103,
    "code": "profile_key: r.profile_key,"
  },
  {
    "file": "src/services/earningsDriftService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/earningsDriftService.ts",
    "line": 21,
    "code": "// Since FMP earnings calendar is future-focused, we use historical-surprises endpoint if available,"
  },
  {
    "file": "src/services/earningsDriftService.ts",
    "line": 27,
    "code": "const quote = await marketDataService.getStockPrice(ticker);"
  },
  {
    "file": "src/services/earningsDriftService.ts",
    "line": 28,
    "code": "if (!quote) throw new Error(\"No price data\");"
  },
  {
    "file": "src/services/earningsDriftService.ts",
    "line": 38,
    "code": "const recentMove = quote.changePercent;"
  },
  {
    "file": "src/services/earningsDriftService.ts",
    "line": 51,
    "code": "reason = `PEAD BULL: Stock surged +${recentMove.toFixed(1)}% with low volatility. Institutional accu"
  },
  {
    "file": "src/services/earningsDriftService.ts",
    "line": 90,
    "code": "// Proxy: Use beta from profile or calculate from history"
  },
  {
    "file": "src/services/earningsDriftService.ts",
    "line": 91,
    "code": "const profile = await fmpService.getCompanyProfile(ticker);"
  },
  {
    "file": "src/services/earningsDriftService.ts",
    "line": 92,
    "code": "return Number(profile?.beta || 1.5);"
  },
  {
    "file": "src/services/earningsIntelligence.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/earningsIntelligence.ts",
    "line": 17,
    "code": "// Real: Fetch calendar from FMP"
  },
  {
    "file": "src/services/earningsIntelligence.ts",
    "line": 24,
    "code": "// Use FMP Economic Calendar or Earnings Calendar endpoint"
  },
  {
    "file": "src/services/earningsIntelligence.ts",
    "line": 25,
    "code": "// For now, if fmpService doesn't expose it, return empty."
  },
  {
    "file": "src/services/earningsIntelligence.ts",
    "line": 39,
    "code": "const estimates = await fmpService.getAnalystEstimates(ticker);"
  },
  {
    "file": "src/services/earningsIntelligence.ts",
    "line": 43,
    "code": "source: 'FMP',"
  },
  {
    "file": "src/services/earningsWhisperService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/earningsWhisperService.ts",
    "line": 13,
    "code": "const estimates = await fmpService.getAnalystEstimates(ticker);"
  },
  {
    "file": "src/services/economicCalendarService.ts",
    "line": 1,
    "code": "// src/services/economicCalendarService.ts"
  },
  {
    "file": "src/services/economicCalendarService.ts",
    "line": 11,
    "code": "interface FinnhubEconomicEvent {"
  },
  {
    "file": "src/services/economicCalendarService.ts",
    "line": 21,
    "code": "class EconomicCalendarService {"
  },
  {
    "file": "src/services/economicCalendarService.ts",
    "line": 24,
    "code": "* Fetch upcoming economic events from Finnhub"
  },
  {
    "file": "src/services/economicCalendarService.ts",
    "line": 33,
    "code": "console.log('üìÖ Fetching economic calendar from Finnhub...');"
  },
  {
    "file": "src/services/economicCalendarService.ts",
    "line": 40,
    "code": "`https://finnhub.io/api/v1/calendar/economic?from=${fromDate}&to=${toDate}&token=${FINNHUB_API_KEY}`"
  },
  {
    "file": "src/services/economicCalendarService.ts",
    "line": 48,
    "code": "const events: FinnhubEconomicEvent[] = data.economicCalendar || [];"
  },
  {
    "file": "src/services/economicCalendarService.ts",
    "line": 57,
    "code": "await pool.query('DELETE FROM economic_events WHERE scheduled_date < CURRENT_DATE', []);"
  },
  {
    "file": "src/services/economicCalendarService.ts",
    "line": 70,
    "code": "INSERT INTO economic_events ("
  },
  {
    "file": "src/services/economicCalendarService.ts",
    "line": 111,
    "code": "message: `Successfully fetched ${inserted} economic events`"
  },
  {
    "file": "src/services/economicCalendarService.ts",
    "line": 115,
    "code": "console.error('‚ùå Economic calendar fetch failed:', error);"
  },
  {
    "file": "src/services/economicCalendarService.ts",
    "line": 165,
    "code": "return 'Economic Indicator';"
  },
  {
    "file": "src/services/economicCalendarService.ts",
    "line": 198,
    "code": "FROM economic_events"
  },
  {
    "file": "src/services/economicCalendarService.ts",
    "line": 206,
    "code": "return 'No major economic events scheduled in the next 7 days.';"
  },
  {
    "file": "src/services/economicCalendarService.ts",
    "line": 217,
    "code": "return `UPCOMING ECONOMIC EVENTS (Next 7 Days):\\n${context}`;"
  },
  {
    "file": "src/services/economicCalendarService.ts",
    "line": 220,
    "code": "return 'Economic calendar data unavailable.';"
  },
  {
    "file": "src/services/economicCalendarService.ts",
    "line": 225,
    "code": "export default new EconomicCalendarService();"
  },
  {
    "file": "src/services/economicDataService.ts",
    "line": 1,
    "code": "// backend/src/services/economicDataService.ts"
  },
  {
    "file": "src/services/economicDataService.ts",
    "line": 2,
    "code": "// Economic Indicators & Data - Free Government Sources"
  },
  {
    "file": "src/services/economicDataService.ts",
    "line": 7,
    "code": "interface EconomicIndicator {"
  },
  {
    "file": "src/services/economicDataService.ts",
    "line": 17,
    "code": "class EconomicDataService {"
  },
  {
    "file": "src/services/economicDataService.ts",
    "line": 19,
    "code": "private ECONOMIC_RSS_FEEDS = ["
  },
  {
    "file": "src/services/economicDataService.ts",
    "line": 21,
    "code": "{ url: 'https://www.bls.gov/feed/bls_latest.rss', name: 'BLS Economic News', category: 'employment' "
  },
  {
    "file": "src/services/economicDataService.ts",
    "line": 24,
    "code": "{ url: 'https://www.census.gov/economic-indicators/indicator.xml', name: 'Census Economic Indicators"
  },
  {
    "file": "src/services/economicDataService.ts",
    "line": 26,
    "code": "// Federal Reserve Economic Data (FRED)"
  },
  {
    "file": "src/services/economicDataService.ts",
    "line": 27,
    "code": "{ url: 'https://fred.stlouisfed.org/feed/rss', name: 'FRED Updates', category: 'economic' },"
  },
  {
    "file": "src/services/economicDataService.ts",
    "line": 34,
    "code": "* Get economic indicators from RSS feeds"
  },
  {
    "file": "src/services/economicDataService.ts",
    "line": 36,
    "code": "async getEconomicIndicators(): Promise<EconomicIndicator[]> {"
  },
  {
    "file": "src/services/economicDataService.ts",
    "line": 37,
    "code": "const indicators: EconomicIndicator[] = [];"
  },
  {
    "file": "src/services/economicDataService.ts",
    "line": 39,
    "code": "for (const feed of this.ECONOMIC_RSS_FEEDS) {"
  },
  {
    "file": "src/services/economicDataService.ts",
    "line": 122,
    "code": "* Calculate relevance score for economic data"
  },
  {
    "file": "src/services/economicDataService.ts",
    "line": 124,
    "code": "calculateRelevance(indicator: EconomicIndicator): number {"
  },
  {
    "file": "src/services/economicDataService.ts",
    "line": 125,
    "code": "let score = 80; // Base score for economic data (always important)"
  },
  {
    "file": "src/services/economicDataService.ts",
    "line": 155,
    "code": "* Get major economic releases (scheduled)"
  },
  {
    "file": "src/services/economicDataService.ts",
    "line": 158,
    "code": "// This would fetch from economic calendar APIs"
  },
  {
    "file": "src/services/economicDataService.ts",
    "line": 160,
    "code": "// TODO: Integrate with free economic calendar sources"
  },
  {
    "file": "src/services/economicDataService.ts",
    "line": 193,
    "code": "export default new EconomicDataService();"
  },
  {
    "file": "src/services/economicSurpriseService.ts",
    "line": 1,
    "code": "import economicCalendarService from './economicCalendarService.js';"
  },
  {
    "file": "src/services/economicSurpriseService.ts",
    "line": 4,
    "code": "interface ESIMetrics {"
  },
  {
    "file": "src/services/economicSurpriseService.ts",
    "line": 11,
    "code": "class EconomicSurpriseService {"
  },
  {
    "file": "src/services/economicSurpriseService.ts",
    "line": 13,
    "code": "async calculateESI(): Promise<ESIMetrics> {"
  },
  {
    "file": "src/services/economicSurpriseService.ts",
    "line": 14,
    "code": "console.log('      üìä ESI: Calculating Economic Surprise Index...');"
  },
  {
    "file": "src/services/economicSurpriseService.ts",
    "line": 17,
    "code": "// 1. Get recent economic events with actual values"
  },
  {
    "file": "src/services/economicSurpriseService.ts",
    "line": 18,
    "code": "// Query our local DB populated by economicCalendarService"
  },
  {
    "file": "src/services/economicSurpriseService.ts",
    "line": 21,
    "code": "FROM economic_events"
  },
  {
    "file": "src/services/economicSurpriseService.ts",
    "line": 43,
    "code": "// Invert logic for \"Bad is Good\" metrics (Unemployment, Claims)"
  },
  {
    "file": "src/services/economicSurpriseService.ts",
    "line": 64,
    "code": "let trend: ESIMetrics['trend'] = 'NEUTRAL';"
  },
  {
    "file": "src/services/economicSurpriseService.ts",
    "line": 91,
    "code": "export default new EconomicSurpriseService();"
  },
  {
    "file": "src/services/edgarService.ts",
    "line": 251,
    "code": "FROM economic_events"
  },
  {
    "file": "src/services/enhancedDeepDiveService.ts",
    "line": 21,
    "code": "historicalPatterns: string;"
  },
  {
    "file": "src/services/enhancedDeepDiveService.ts",
    "line": 27,
    "code": "historicalComparisons: any[];"
  },
  {
    "file": "src/services/enhancedDeepDiveService.ts",
    "line": 152,
    "code": "\"historicalPatterns\": \"History...\","
  },
  {
    "file": "src/services/enhancedDeepDiveService.ts",
    "line": 158,
    "code": "\"historicalComparisons\": [],"
  },
  {
    "file": "src/services/enhancedDeepDiveService.ts",
    "line": 196,
    "code": "historicalPatterns: 'Pending.',"
  },
  {
    "file": "src/services/enhancedDeepDiveService.ts",
    "line": 202,
    "code": "historicalComparisons: [],"
  },
  {
    "file": "src/services/enhancedIntelligenceService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/enhancedIntelligenceService.ts",
    "line": 4,
    "code": "optionsFlow: any;"
  },
  {
    "file": "src/services/enhancedIntelligenceService.ts",
    "line": 5,
    "code": "insiderActivity: any;"
  },
  {
    "file": "src/services/enhancedIntelligenceService.ts",
    "line": 15,
    "code": "const [insider, earnings, sentiment] = await Promise.all(["
  },
  {
    "file": "src/services/enhancedIntelligenceService.ts",
    "line": 16,
    "code": "this.getInsiderActivity(),"
  },
  {
    "file": "src/services/enhancedIntelligenceService.ts",
    "line": 22,
    "code": "optionsFlow: await this.getOptionsFlow(), // Real Logic"
  },
  {
    "file": "src/services/enhancedIntelligenceService.ts",
    "line": 23,
    "code": "insiderActivity: insider,"
  },
  {
    "file": "src/services/enhancedIntelligenceService.ts",
    "line": 31,
    "code": "private async getOptionsFlow() {"
  },
  {
    "file": "src/services/enhancedIntelligenceService.ts",
    "line": 44,
    "code": "private async getInsiderActivity() {"
  },
  {
    "file": "src/services/enhancedIntelligenceService.ts",
    "line": 45,
    "code": "const feed = await fmpService.getInsiderFeed();"
  },
  {
    "file": "src/services/etfLeakageService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/etfLeakageService.ts",
    "line": 17,
    "code": "const holdings = await fmpService.getEtfHoldings(etf);"
  },
  {
    "file": "src/services/etfShadowService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/etfShadowService.ts",
    "line": 23,
    "code": "const holdings = await fmpService.getEtfHoldings(etf);"
  },
  {
    "file": "src/services/eventReactionService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/eventReactionService.ts",
    "line": 4,
    "code": "interface ReactionProfile {"
  },
  {
    "file": "src/services/eventReactionService.ts",
    "line": 9,
    "code": "volume_profile: string;"
  },
  {
    "file": "src/services/eventReactionService.ts",
    "line": 15,
    "code": "async analyzeReactionProfile(ticker: string): Promise<ReactionProfile> {"
  },
  {
    "file": "src/services/eventReactionService.ts",
    "line": 16,
    "code": "// Default profile"
  },
  {
    "file": "src/services/eventReactionService.ts",
    "line": 17,
    "code": "const result: ReactionProfile = {"
  },
  {
    "file": "src/services/eventReactionService.ts",
    "line": 22,
    "code": "volume_profile: 'Normal',"
  },
  {
    "file": "src/services/eventReactionService.ts",
    "line": 27,
    "code": "// 1. Fetch Profile for Beta & Volume"
  },
  {
    "file": "src/services/eventReactionService.ts",
    "line": 28,
    "code": "const profile = await fmpService.getCompanyProfile(ticker);"
  },
  {
    "file": "src/services/eventReactionService.ts",
    "line": 29,
    "code": "const quote = await marketDataService.getStockPrice(ticker);"
  },
  {
    "file": "src/services/eventReactionService.ts",
    "line": 31,
    "code": "if (!profile || !quote) return result;"
  },
  {
    "file": "src/services/eventReactionService.ts",
    "line": 33,
    "code": "const beta = Number(profile?.beta || 1.5);"
  },
  {
    "file": "src/services/eventReactionService.ts",
    "line": 34,
    "code": "const avgVol = profile.volAvg || 1000000;"
  },
  {
    "file": "src/services/eventReactionService.ts",
    "line": 35,
    "code": "const currentVol = quote.volume || 0;"
  },
  {
    "file": "src/services/eventReactionService.ts",
    "line": 47,
    "code": "result.volume_profile = 'High Frequency';"
  },
  {
    "file": "src/services/eventReactionService.ts",
    "line": 50,
    "code": "// SCENARIO B: INSTITUTIONAL DRIFT (Low Beta, Huge Float)"
  },
  {
    "file": "src/services/eventReactionService.ts",
    "line": 56,
    "code": "result.volume_profile = 'Institutional Flow';"
  },
  {
    "file": "src/services/eventReactionService.ts",
    "line": 64,
    "code": "result.volume_profile = 'Retail/Mixed';"
  },
  {
    "file": "src/services/eventReactionService.ts",
    "line": 79,
    "code": "console.error(`Reaction Profile Error for ${ticker}`, e);"
  },
  {
    "file": "src/services/executiveSummaryService.ts",
    "line": 168,
    "code": "const prompt = `You are a senior market strategist creating today's executive summary for institutio"
  },
  {
    "file": "src/services/executiveSummaryService.ts",
    "line": 252,
    "code": "'Economic uncertainty',"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 2,
    "code": "// Analyzes CEO, CFO, Board quality and insider transactions"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 15,
    "code": "interface ExecutiveProfile {"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 24,
    "code": "interface InsiderTransaction {"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 54,
    "code": "insiderActivity: string;"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 72,
    "code": "insiderActivity: {"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 76,
    "code": "transactions: InsiderTransaction[];"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 92,
    "code": "// Fetch company profile from Alpha Vantage"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 93,
    "code": "const profile = await this.getCompanyProfile(ticker);"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 95,
    "code": "// Fetch insider transactions"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 96,
    "code": "const insiderActivity = await this.getInsiderTransactions(ticker);"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 99,
    "code": "const ceoScore = this.scoreCEO(profile, insiderActivity);"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 102,
    "code": "const cfoScore = this.scoreCFO(profile);"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 105,
    "code": "const boardScore = this.scoreBoardQuality(profile);"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 108,
    "code": "const alignmentScore = this.scoreAlignment(insiderActivity);"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 119,
    "code": "const strengths = this.identifyStrengths(ceoScore, cfoScore, boardScore, insiderActivity);"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 120,
    "code": "const concerns = this.identifyConcerns(ceoScore, cfoScore, boardScore, insiderActivity);"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 135,
    "code": "insiderActivity,"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 152,
    "code": "* Get company profile from Alpha Vantage"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 154,
    "code": "private async getCompanyProfile(ticker: string): Promise<any> {"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 166,
    "code": "console.error(`Failed to get profile for ${ticker}`);"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 172,
    "code": "* Get insider transactions (mock for now - real SEC EDGAR integration in production)"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 174,
    "code": "private async getInsiderTransactions(ticker: string): Promise<any> {"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 176,
    "code": "// For now, analyze based on institutional ownership changes"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 179,
    "code": "// Use Alpha Vantage institutional holdings as proxy"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 184,
    "code": "const institutionalOwnership = parseFloat(data.PercentInstitutionOwned || '0');"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 185,
    "code": "const insiderOwnership = parseFloat(data.PercentInsiders || '0');"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 187,
    "code": "// Infer insider activity based on ownership levels"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 188,
    "code": "const recentBuying = insiderOwnership > 5; // >5% indicates strong alignment"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 189,
    "code": "const recentSelling = insiderOwnership < 1; // <1% indicates weak alignment"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 195,
    "code": "insiderOwnership,"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 196,
    "code": "institutionalOwnership,"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 205,
    "code": "insiderOwnership: 0,"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 206,
    "code": "institutionalOwnership: 0,"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 215,
    "code": "private scoreCEO(profile: any, insiderActivity: any): any {"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 216,
    "code": "if (!profile || !profile.Symbol) {"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 223,
    "code": "insiderActivity: 'Unknown',"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 235,
    "code": "const profitMargin = parseFloat(profile.ProfitMargin || '0') * 100;"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 236,
    "code": "const revenueGrowth = parseFloat(profile.QuarterlyRevenueGrowthYOY || '0') * 100;"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 248,
    "code": "// Insider ownership (alignment)"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 249,
    "code": "if (insiderActivity.recentBuying) {"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 251,
    "code": "} else if (insiderActivity.recentSelling) {"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 253,
    "code": "redFlags.push('Insider selling activity');"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 259,
    "code": "const beta = parseFloat(profile.Beta || '1');"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 267,
    "code": "name: profile.Name || 'CEO',"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 271,
    "code": "insiderActivity: insiderActivity.netActivity,"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 279,
    "code": "private scoreCFO(profile: any): any {"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 280,
    "code": "if (!profile || !profile.Symbol) {"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 292,
    "code": "const debtToEquity = parseFloat(profile.DebtToEquity || '100');"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 293,
    "code": "const currentRatio = parseFloat(profile.CurrentRatio || '1');"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 294,
    "code": "const returnOnEquity = parseFloat(profile.ReturnOnEquityTTM || '0') * 100;"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 328,
    "code": "private scoreBoardQuality(profile: any): any {"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 329,
    "code": "if (!profile || !profile.Symbol) {"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 341,
    "code": "const marketCap = parseFloat(profile.MarketCapitalization || '0') / 1e9; // In billions"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 349,
    "code": "const sector = profile.Sector || 'Unknown';"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 357,
    "code": "// Institutional ownership as proxy for board trust"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 358,
    "code": "const institutionalOwnership = parseFloat(profile.PercentInstitutionOwned || '0') * 100;"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 359,
    "code": "if (institutionalOwnership > 70) score += 3;"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 360,
    "code": "else if (institutionalOwnership > 50) score += 2;"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 361,
    "code": "else if (institutionalOwnership > 30) score += 1;"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 376,
    "code": "private scoreAlignment(insiderActivity: any): number {"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 379,
    "code": "// Insider ownership"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 380,
    "code": "const insiderOwnership = insiderActivity.insiderOwnership || 0;"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 381,
    "code": "if (insiderOwnership > 5) score += 5; // Strong alignment"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 382,
    "code": "else if (insiderOwnership > 2) score += 3;"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 383,
    "code": "else if (insiderOwnership > 1) score += 2;"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 387,
    "code": "if (insiderActivity.recentBuying) {"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 389,
    "code": "} else if (insiderActivity.recentSelling) {"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 418,
    "code": "insiderActivity: any"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 425,
    "code": "if (insiderActivity.recentBuying) strengths.push('Recent insider buying signals confidence');"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 426,
    "code": "if (insiderActivity.institutionalOwnership > 60) strengths.push('Strong institutional investor confi"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 438,
    "code": "insiderActivity: any"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 445,
    "code": "if (insiderActivity.recentSelling) concerns.push('Recent insider selling activity');"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 446,
    "code": "if (insiderActivity.insiderOwnership < 1) concerns.push('Low insider ownership');"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 488,
    "code": "insiderActivity: 'Unknown',"
  },
  {
    "file": "src/services/executiveVettingService.ts",
    "line": 503,
    "code": "insiderActivity: {"
  },
  {
    "file": "src/services/fedSpeakService.ts",
    "line": 22,
    "code": "// 1. Get Political/Economic News"
  },
  {
    "file": "src/services/fedSpeakService.ts",
    "line": 26,
    "code": "WHERE (source_type = 'political' OR source_type = 'economic')"
  },
  {
    "file": "src/services/financialClockService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/financialClockService.ts",
    "line": 18,
    "code": "// Note: FMP Economic Indicator returns chronological data"
  },
  {
    "file": "src/services/financialClockService.ts",
    "line": 20,
    "code": "fmpService.getEconomicIndicator('GDP'),"
  },
  {
    "file": "src/services/financialClockService.ts",
    "line": 21,
    "code": "fmpService.getEconomicIndicator('CPI')"
  },
  {
    "file": "src/services/financialHealthService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/financialHealthService.ts",
    "line": 8,
    "code": "metrics: any;"
  },
  {
    "file": "src/services/financialHealthService.ts",
    "line": 15,
    "code": "const estimates = await fmpService.getAnalystEstimates(ticker);"
  },
  {
    "file": "src/services/financialHealthService.ts",
    "line": 26,
    "code": "metrics: {},"
  },
  {
    "file": "src/services/financialHealthService.ts",
    "line": 30,
    "code": "return { ticker, quality_score: 50, earnings_risk_score: 50, traffic_light: 'YELLOW', metrics: {}, d"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 11,
    "code": "interface StockQuote {"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 22,
    "code": "interface CompanyProfile {"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 62,
    "code": "* Get real-time stock quote"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 65,
    "code": "async getQuote(ticker: string): Promise<{ price: number; change: number; changePercent: number } | n"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 67,
    "code": "console.log(`üìä Finnhub: Fetching quote for ${ticker}...`);"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 69,
    "code": "const response = await axios.get<StockQuote>(`${BASE_URL}/quote`, {"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 77,
    "code": "const quote = response.data;"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 80,
    "code": "if (quote.c === 0 && quote.pc === 0) {"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 85,
    "code": "console.log(`  ‚úì ${ticker}: $${quote.c.toFixed(2)} (${quote.dp >= 0 ? '+' : ''}${quote.dp.toFixed(2)"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 88,
    "code": "price: quote.c,"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 89,
    "code": "change: quote.d,"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 90,
    "code": "changePercent: quote.dp"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 100,
    "code": "* Get company profile/overview"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 102,
    "code": "async getCompanyProfile(ticker: string): Promise<CompanyProfile | null> {"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 104,
    "code": "console.log(`üè¢ Finnhub: Fetching profile for ${ticker}...`);"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 106,
    "code": "const response = await axios.get<CompanyProfile>(`${BASE_URL}/stock/profile2`, {"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 115,
    "code": "console.log(`  ‚ö†Ô∏è ${ticker}: No profile data`);"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 123,
    "code": "console.error(`  ‚úó Finnhub profile error for ${ticker}:`, error.message);"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 248,
    "code": "* Batch get quotes for multiple tickers (efficient!)"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 250,
    "code": "async getBatchQuotes(tickers: string[]): Promise<Map<string, { price: number; changePercent: number "
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 251,
    "code": "console.log(`üìä Finnhub: Batch fetching ${tickers.length} quotes...`);"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 258,
    "code": "const quote = await this.getQuote(ticker);"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 259,
    "code": "if (quote) {"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 261,
    "code": "price: quote.price,"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 262,
    "code": "changePercent: quote.changePercent"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 270,
    "code": "console.log(`  ‚úì Successfully fetched ${results.size}/${tickers.length} quotes`);"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 280,
    "code": "const quote = await this.getQuote('AAPL');"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 281,
    "code": "return quote !== null;"
  },
  {
    "file": "src/services/finnhubService.ts",
    "line": 295,
    "code": "- Company profiles ‚úì"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 5,
    "code": "* FMP Service (Phase 52 - Latest API Enforcement)"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 7,
    "code": "* Base URL: https://financialmodelingprep.com/api/latest"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 8,
    "code": "* Policy: NO v3, NO v4, NO Legacy endpoints."
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 11,
    "code": "class FmpService {"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 13,
    "code": "private baseUrl = 'https://financialmodelingprep.com/api/latest';"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 16,
    "code": "quote: 'UNKNOWN',"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 17,
    "code": "profile: 'UNKNOWN',"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 18,
    "code": "historical: 'UNKNOWN',"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 22,
    "code": "institutional: 'UNKNOWN',"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 23,
    "code": "insider: 'UNKNOWN',"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 25,
    "code": "economic: 'UNKNOWN',"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 26,
    "code": "options: 'UNKNOWN',"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 33,
    "code": "this.apiKey = process.env.FMP_API_KEY || '';"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 34,
    "code": "if (!this.apiKey) console.error('[FMP] CRITICAL: API Key Missing');"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 48,
    "code": "// console.log(`[FMP] GET ${masked}`);"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 59,
    "code": "console.error(`[FMP] HTTP ${response.status} for ${masked}`);"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 66,
    "code": "console.warn(`[FMP] API Error: ${data['Error Message']}`);"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 83,
    "code": "console.warn(`[FMP] Capability Disabled: ${category} (${status}) - ${path}`);"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 86,
    "code": "console.error(`[FMP] Network Error: ${error.message}`);"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 95,
    "code": "const data = await this.fetchRaw(`quote/${ticker}`, 'quote');"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 99,
    "code": "async getQuote(ticker: string): Promise<any> { return this.getPrice(ticker); }"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 104,
    "code": "return await this.fetchRaw(`quote/${tickers.join(',')}`, 'quote') || [];"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 108,
    "code": "// Note: \"historical-price-full\" is legacy. Latest often uses specific historical endpoints."
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 110,
    "code": "const data = await this.fetchRaw(`historical-price-full/${ticker}?timeseries=${limit}`, 'historical'"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 111,
    "code": "return data && data.historical ? data.historical : [];"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 115,
    "code": "return await this.fetchRaw(`historical-chart/${interval}/${ticker}`, 'intraday') || [];"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 120,
    "code": "async getCompanyProfile(ticker: string): Promise<any> {"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 121,
    "code": "const data = await this.fetchRaw(`profile/${ticker}`, 'profile');"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 127,
    "code": "async getFinancialRatios(ticker: string, period: string = 'annual', limit: number = 1): Promise<any>"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 128,
    "code": "return await this.fetchRaw(`ratios-ttm/${ticker}`, 'financials') || [];"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 131,
    "code": "async getKeyMetrics(ticker: string, limit: number = 1): Promise<any> {"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 132,
    "code": "return await this.fetchRaw(`key-metrics-ttm/${ticker}`, 'financials') || [];"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 156,
    "code": "// stock-news is often v3. latest might be 'news'. Trying 'stock-news' on latest base."
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 163,
    "code": "// --- 5. INSTITUTIONAL / INSIDER ---"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 164,
    "code": "async getInsiderTrades(ticker: string): Promise<any[]> {"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 165,
    "code": "return await this.fetchRaw(`insider-trading?symbol=${ticker}&limit=100`, 'insider') || [];"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 168,
    "code": "async getInsiderFeed(): Promise<any[]> {"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 169,
    "code": "return await this.fetchRaw(`insider-trading?limit=50`, 'insider') || [];"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 172,
    "code": "async getInstitutionalHolders(ticker: string): Promise<any[]> {"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 173,
    "code": "return await this.fetchRaw(`institutional-ownership/${ticker}`, 'institutional') || [];"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 177,
    "code": "return await this.fetchRaw(`etf-holder/${ticker}`, 'institutional') || [];"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 181,
    "code": "return await this.fetchRaw(`13f/${cik}`, 'institutional') || [];"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 184,
    "code": "// --- 6. MACRO & OPTIONS ---"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 186,
    "code": "return await this.fetchRaw(`option-chain/${ticker}`, 'options') || [];"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 189,
    "code": "async getEconomicIndicator(name: string): Promise<any[]> {"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 190,
    "code": "return await this.fetchRaw(`economic?symbol=${encodeURIComponent(name)}`, 'economic') || [];"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 193,
    "code": "async getEconomicData(name: string): Promise<any[]> { return this.getEconomicIndicator(name); }"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 194,
    "code": "async getTreasuryRates(): Promise<any[]> { return this.getEconomicIndicator('10Y'); }"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 216,
    "code": "const [profile, metrics, ratios, income] = await Promise.all(["
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 217,
    "code": "this.getCompanyProfile(ticker),"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 218,
    "code": "this.getKeyMetrics(ticker),"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 219,
    "code": "this.getFinancialRatios(ticker),"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 222,
    "code": "return { profile, metrics, ratios, income };"
  },
  {
    "file": "src/services/fmpService.ts",
    "line": 231,
    "code": "export default new FmpService();"
  },
  {
    "file": "src/services/futures.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/futures.ts",
    "line": 18,
    "code": "const quote = await fmpService.getPrice(symbol);"
  },
  {
    "file": "src/services/futures.ts",
    "line": 22,
    "code": "name: quote?.name || symbol,"
  },
  {
    "file": "src/services/futures.ts",
    "line": 23,
    "code": "price: quote?.price || 0,"
  },
  {
    "file": "src/services/futures.ts",
    "line": 32,
    "code": "const data = await fmpService.getBatchPrices(contracts);"
  },
  {
    "file": "src/services/gammaExposureService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/gammaExposureService.ts",
    "line": 3,
    "code": "interface GammaProfile {"
  },
  {
    "file": "src/services/gammaExposureService.ts",
    "line": 16,
    "code": "async analyze(ticker: string): Promise<GammaProfile> {"
  },
  {
    "file": "src/services/gammaExposureService.ts",
    "line": 19,
    "code": "const chain = await fmpService.getOptionChain(ticker);"
  },
  {
    "file": "src/services/gammaExposureService.ts",
    "line": 46,
    "code": "const candles = await fmpService.getDailyCandles(ticker, 30);"
  },
  {
    "file": "src/services/globalCalendarService.ts",
    "line": 2,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/globalCalendarService.ts",
    "line": 14,
    "code": "// Syncs external FMP data into our risk calendar"
  },
  {
    "file": "src/services/globalCalendarService.ts",
    "line": 17,
    "code": "// 1. Get Economic Calendar"
  },
  {
    "file": "src/services/globalCalendarService.ts",
    "line": 18,
    "code": "const eco = await fmpService.getEconomicIndicator('CPI'); // Proxy check"
  },
  {
    "file": "src/services/globalDivergenceService.ts",
    "line": 8,
    "code": "metrics: {"
  },
  {
    "file": "src/services/globalDivergenceService.ts",
    "line": 30,
    "code": "const quotes = await marketDataService.getMultiplePrices(["
  },
  {
    "file": "src/services/globalDivergenceService.ts",
    "line": 34,
    "code": "const us = quotes.get(PROXIES.US)?.changePercent || 0;"
  },
  {
    "file": "src/services/globalDivergenceService.ts",
    "line": 35,
    "code": "const eu = quotes.get(PROXIES.EU)?.changePercent || 0;"
  },
  {
    "file": "src/services/globalDivergenceService.ts",
    "line": 36,
    "code": "const asia = quotes.get(PROXIES.ASIA)?.changePercent || 0;"
  },
  {
    "file": "src/services/globalDivergenceService.ts",
    "line": 37,
    "code": "const em = quotes.get(PROXIES.EM)?.changePercent || 0;"
  },
  {
    "file": "src/services/globalDivergenceService.ts",
    "line": 75,
    "code": "metrics: { us, eu, asia, em }"
  },
  {
    "file": "src/services/globalDivergenceService.ts",
    "line": 82,
    "code": "metrics: { us: 0, eu: 0, asia: 0, em: 0 }"
  },
  {
    "file": "src/services/globalEtfUniverseEngine.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/globalEtfUniverseEngine.ts",
    "line": 44,
    "code": "const holdings = await fmpService.getEtfHoldings(etf);"
  },
  {
    "file": "src/services/globalEtfUniverseEngine.ts",
    "line": 69,
    "code": "* Useful for \"Institutional Support\" analysis."
  },
  {
    "file": "src/services/globalEtfUniverseEngine.ts",
    "line": 100,
    "code": "// FMP returns { asset: 'AAPL', sharesNumber: 123, weightPercentage: 5.4, ... }"
  },
  {
    "file": "src/services/globalMacroForecastService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/globalMacroForecastService.ts",
    "line": 6,
    "code": "const gdp = await fmpService.getEconomicData('GDP');"
  },
  {
    "file": "src/services/globalNewsAttentionEngine.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/globalRiskService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/globalRiskService.ts",
    "line": 31,
    "code": "const gold = await fmpService.getPrice('GLD');"
  },
  {
    "file": "src/services/globalRiskService.ts",
    "line": 38,
    "code": "const oil = await fmpService.getPrice('USO');"
  },
  {
    "file": "src/services/googleScraper.ts",
    "line": 7,
    "code": "const url = `https://www.google.com/finance/quote/${ticker}:NYSE`;"
  },
  {
    "file": "src/services/governmentDataAdapter.ts",
    "line": 2,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/governmentDataAdapter.ts",
    "line": 8,
    "code": "* Standardized Government/Institutional Data Interface"
  },
  {
    "file": "src/services/governmentDataAdapter.ts",
    "line": 29,
    "code": "export interface InsiderRecord {"
  },
  {
    "file": "src/services/governmentDataAdapter.ts",
    "line": 46,
    "code": "// Real Source: FMP Senate RSS Feed"
  },
  {
    "file": "src/services/governmentDataAdapter.ts",
    "line": 47,
    "code": "const feed = await fmpService.getInsiderFeed();"
  },
  {
    "file": "src/services/governmentDataAdapter.ts",
    "line": 51,
    "code": "// Currently FMP mixes them, so we map what we can"
  },
  {
    "file": "src/services/governmentDataAdapter.ts",
    "line": 60,
    "code": "source: 'FMP/Senate'"
  },
  {
    "file": "src/services/governmentDataAdapter.ts",
    "line": 100,
    "code": "// --- INSIDER & INSTITUTIONAL ---"
  },
  {
    "file": "src/services/governmentDataAdapter.ts",
    "line": 102,
    "code": "async getInsiderTrades(ticker: string): Promise<InsiderRecord[]> {"
  },
  {
    "file": "src/services/governmentDataAdapter.ts",
    "line": 104,
    "code": "const trades = await fmpService.getInsiderTrades(ticker);"
  },
  {
    "file": "src/services/governmentDataAdapter.ts",
    "line": 122,
    "code": "async getInstitutionalHoldings(ticker: string) {"
  },
  {
    "file": "src/services/governmentDataAdapter.ts",
    "line": 123,
    "code": "return await fmpService.getInstitutionalHolders(ticker);"
  },
  {
    "file": "src/services/governmentDataAdapter.ts",
    "line": 134,
    "code": "// FMP provides this in higher tiers via /quote-short/"
  },
  {
    "file": "src/services/hedgeFund13FEngine.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/hedgeFund13FEngine.ts",
    "line": 12,
    "code": "const holders = await fmpService.getInstitutionalHolders(ticker);"
  },
  {
    "file": "src/services/hedgeFund13FEngine.ts",
    "line": 23,
    "code": "// If Price > VWAP consistently -> Institutional Buying"
  },
  {
    "file": "src/services/hedgeFund13FEngine.ts",
    "line": 24,
    "code": "const candles = await fmpService.getIntraday(ticker);"
  },
  {
    "file": "src/services/hedgeFundPatternEngine.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/hedgeFundPatternEngine.ts",
    "line": 19,
    "code": "const candles = await fmpService.getDailyCandles(ticker, 40); // Look at last ~2 months"
  },
  {
    "file": "src/services/hedgeFundPatternEngine.ts",
    "line": 23,
    "code": "// FMP returns newest first. Reverse for chronological analysis"
  },
  {
    "file": "src/services/historicalDataFetcher.ts",
    "line": 1,
    "code": "// src/services/historicalDataFetcher.ts"
  },
  {
    "file": "src/services/historicalDataFetcher.ts",
    "line": 7,
    "code": "class HistoricalDataFetcher {"
  },
  {
    "file": "src/services/historicalDataFetcher.ts",
    "line": 20,
    "code": "async fetchCryptoHistorical(symbol: string = 'BTC', years: number = 3) {"
  },
  {
    "file": "src/services/historicalDataFetcher.ts",
    "line": 21,
    "code": "console.log(`üìä Fetching ${years} years of ${symbol} historical data...`);"
  },
  {
    "file": "src/services/historicalDataFetcher.ts",
    "line": 84,
    "code": "* Fetch historical stock data from Polygon"
  },
  {
    "file": "src/services/historicalDataFetcher.ts",
    "line": 86,
    "code": "async fetchStockHistorical(symbol: string, years: number = 3) {"
  },
  {
    "file": "src/services/historicalDataFetcher.ts",
    "line": 162,
    "code": "INSERT INTO crypto_historical_prices"
  },
  {
    "file": "src/services/historicalDataFetcher.ts",
    "line": 193,
    "code": "INSERT INTO stock_historical_prices"
  },
  {
    "file": "src/services/historicalDataFetcher.ts",
    "line": 247,
    "code": "async fetchAllHistorical() {"
  },
  {
    "file": "src/services/historicalDataFetcher.ts",
    "line": 248,
    "code": "console.log('üöÄ Starting comprehensive historical data collection...');"
  },
  {
    "file": "src/services/historicalDataFetcher.ts",
    "line": 265,
    "code": "const records = await this.fetchCryptoHistorical(crypto, 3);"
  },
  {
    "file": "src/services/historicalDataFetcher.ts",
    "line": 277,
    "code": "const records = await this.fetchStockHistorical(stock, 3);"
  },
  {
    "file": "src/services/historicalDataFetcher.ts",
    "line": 292,
    "code": "export default new HistoricalDataFetcher();"
  },
  {
    "file": "src/services/historicalDataService.ts",
    "line": 3,
    "code": "const FMP_KEY = process.env.FMP_API_KEY;"
  },
  {
    "file": "src/services/historicalDataService.ts",
    "line": 9,
    "code": "class HistoricalDataService {"
  },
  {
    "file": "src/services/historicalDataService.ts",
    "line": 13,
    "code": "// STRATEGY A: FMP (Primary)"
  },
  {
    "file": "src/services/historicalDataService.ts",
    "line": 14,
    "code": "if (FMP_KEY) {"
  },
  {
    "file": "src/services/historicalDataService.ts",
    "line": 17,
    "code": "const url = `https://financialmodelingprep.com/stable/historical-price-full/${ticker}?apikey=${FMP_K"
  },
  {
    "file": "src/services/historicalDataService.ts",
    "line": 20,
    "code": "if (res.data && res.data.historical) {"
  },
  {
    "file": "src/services/historicalDataService.ts",
    "line": 21,
    "code": "return res.data.historical.slice(0, days).map((p: any) => ({"
  },
  {
    "file": "src/services/historicalDataService.ts",
    "line": 35,
    "code": "const url = `https://api.coingecko.com/api/v3/coins/${id}/market_chart?vs_currency=usd&days=${days}&"
  },
  {
    "file": "src/services/historicalDataService.ts",
    "line": 49,
    "code": "// STRATEGY A: FMP"
  },
  {
    "file": "src/services/historicalDataService.ts",
    "line": 50,
    "code": "if (FMP_KEY) {"
  },
  {
    "file": "src/services/historicalDataService.ts",
    "line": 52,
    "code": "const url = `https://financialmodelingprep.com/stable/historical-price-full/${ticker}?apikey=${FMP_K"
  },
  {
    "file": "src/services/historicalDataService.ts",
    "line": 54,
    "code": "if (res.data.historical) {"
  },
  {
    "file": "src/services/historicalDataService.ts",
    "line": 55,
    "code": "return res.data.historical.slice(0, days).map((p: any) => ({"
  },
  {
    "file": "src/services/historicalDataService.ts",
    "line": 73,
    "code": "if (result && result.timestamp && result.indicators?.quote?.[0]) {"
  },
  {
    "file": "src/services/historicalDataService.ts",
    "line": 74,
    "code": "const quotes = result.indicators.quote[0];"
  },
  {
    "file": "src/services/historicalDataService.ts",
    "line": 77,
    "code": "price: quotes.close[i] || quotes.open[i]"
  },
  {
    "file": "src/services/historicalDataService.ts",
    "line": 92,
    "code": "export default new HistoricalDataService();"
  },
  {
    "file": "src/services/historicalRAGEngine.ts",
    "line": 9,
    "code": "interface HistoricalMatch {"
  },
  {
    "file": "src/services/historicalRAGEngine.ts",
    "line": 16,
    "code": "class HistoricalRAGEngine {"
  },
  {
    "file": "src/services/historicalRAGEngine.ts",
    "line": 18,
    "code": "// Match current market conditions to historical database"
  },
  {
    "file": "src/services/historicalRAGEngine.ts",
    "line": 19,
    "code": "async match(currentContext: string): Promise<HistoricalMatch[]> {"
  },
  {
    "file": "src/services/historicalRAGEngine.ts",
    "line": 20,
    "code": "console.log('      üè∫ Historical RAG: Searching Vector Space...');"
  },
  {
    "file": "src/services/historicalRAGEngine.ts",
    "line": 23,
    "code": "// 1. Get Historical Events (The Knowledge Base)"
  },
  {
    "file": "src/services/historicalRAGEngine.ts",
    "line": 27,
    "code": "FROM historical_events"
  },
  {
    "file": "src/services/historicalRAGEngine.ts",
    "line": 45,
    "code": "HISTORICAL ARCHIVE:"
  },
  {
    "file": "src/services/historicalRAGEngine.ts",
    "line": 48,
    "code": "TASK: Find the top 3 historical parallels."
  },
  {
    "file": "src/services/historicalRAGEngine.ts",
    "line": 80,
    "code": "INSERT INTO active_market_echoes (historical_event_name, resonance_score, narrative_parallel, affect"
  },
  {
    "file": "src/services/historicalRAGEngine.ts",
    "line": 96,
    "code": "export default new HistoricalRAGEngine();"
  },
  {
    "file": "src/services/inflationMapService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/inflationMapService.ts",
    "line": 4,
    "code": "state: 'ACCELERATING' | 'DECELERATING' | 'STABLE';"
  },
  {
    "file": "src/services/inflationMapService.ts",
    "line": 25,
    "code": "'Utilities': { pro_inflation: false, defensiveness: 0.7 }, // Rates hurt, but stable"
  },
  {
    "file": "src/services/inflationMapService.ts",
    "line": 34,
    "code": "const cpiData = await fmpService.getEconomicIndicator('CPI');"
  },
  {
    "file": "src/services/inflationMapService.ts",
    "line": 37,
    "code": "return { state: 'STABLE', cpi_yoy: 3.0, trend_description: \"Data Unavailable, assuming Stable.\" };"
  },
  {
    "file": "src/services/inflationMapService.ts",
    "line": 46,
    "code": "let state: 'ACCELERATING' | 'DECELERATING' | 'STABLE' = 'STABLE';"
  },
  {
    "file": "src/services/inflationMapService.ts",
    "line": 57,
    "code": "return { state: 'STABLE', cpi_yoy: 3.0, trend_description: \"Error fetching CPI.\" };"
  },
  {
    "file": "src/services/inflationMapService.ts",
    "line": 87,
    "code": "reason = `[INFLATION NEUTRAL] Macro environment stable.`;"
  },
  {
    "file": "src/services/ingestion/economicIngestionService.ts",
    "line": 1,
    "code": "import fmpService from '../fmpService.js';"
  },
  {
    "file": "src/services/ingestion/economicIngestionService.ts",
    "line": 5,
    "code": "class EconomicIngestionService {"
  },
  {
    "file": "src/services/ingestion/economicIngestionService.ts",
    "line": 9,
    "code": "fmpService.getEconomicData('GDP'),"
  },
  {
    "file": "src/services/ingestion/economicIngestionService.ts",
    "line": 10,
    "code": "fmpService.getEconomicData('CPI'),"
  },
  {
    "file": "src/services/ingestion/economicIngestionService.ts",
    "line": 11,
    "code": "fmpService.getTreasuryRates()"
  },
  {
    "file": "src/services/ingestion/economicIngestionService.ts",
    "line": 27,
    "code": "VALUES ($1, $2, $3, 'FMP')"
  },
  {
    "file": "src/services/ingestion/economicIngestionService.ts",
    "line": 39,
    "code": "source: 'Economic (FMP)',"
  },
  {
    "file": "src/services/ingestion/economicIngestionService.ts",
    "line": 45,
    "code": "return { success: false, source: 'Economic', recordsProcessed: 0, timestamp: new Date().toISOString("
  },
  {
    "file": "src/services/ingestion/economicIngestionService.ts",
    "line": 49,
    "code": "export default new EconomicIngestionService();"
  },
  {
    "file": "src/services/ingestion/historicalIngestionService.ts",
    "line": 5,
    "code": "class HistoricalIngestionService {"
  },
  {
    "file": "src/services/ingestion/historicalIngestionService.ts",
    "line": 8,
    "code": "const dataPath = path.resolve(__dirname, 'historicalData.json');"
  },
  {
    "file": "src/services/ingestion/historicalIngestionService.ts",
    "line": 14,
    "code": "// TODO: Upsert into DB (HistoricalEvents table)"
  },
  {
    "file": "src/services/ingestion/historicalIngestionService.ts",
    "line": 18,
    "code": "source: 'Historical Events',"
  },
  {
    "file": "src/services/ingestion/historicalIngestionService.ts",
    "line": 27,
    "code": "source: 'Historical Events',"
  },
  {
    "file": "src/services/ingestion/historicalIngestionService.ts",
    "line": 35,
    "code": "export default new HistoricalIngestionService();"
  },
  {
    "file": "src/services/ingestion/insiderIngestionService.ts",
    "line": 1,
    "code": "import fmpService from '../fmpService.js';"
  },
  {
    "file": "src/services/ingestion/insiderIngestionService.ts",
    "line": 5,
    "code": "class InsiderIngestionService {"
  },
  {
    "file": "src/services/ingestion/insiderIngestionService.ts",
    "line": 8,
    "code": "const trades = await fmpService.getInsiderFeed();"
  },
  {
    "file": "src/services/ingestion/insiderIngestionService.ts",
    "line": 11,
    "code": "return { success: true, source: 'Insider (FMP)', recordsProcessed: 0, timestamp: new Date().toISOStr"
  },
  {
    "file": "src/services/ingestion/insiderIngestionService.ts",
    "line": 20,
    "code": "INSERT INTO insider_trades ("
  },
  {
    "file": "src/services/ingestion/insiderIngestionService.ts",
    "line": 48,
    "code": "source: 'Insider (FMP)',"
  },
  {
    "file": "src/services/ingestion/insiderIngestionService.ts",
    "line": 54,
    "code": "return { success: false, source: 'Insider', recordsProcessed: 0, timestamp: new Date().toISOString()"
  },
  {
    "file": "src/services/ingestion/insiderIngestionService.ts",
    "line": 58,
    "code": "export default new InsiderIngestionService();"
  },
  {
    "file": "src/services/ingestion/institutionalIngestionService.ts",
    "line": 1,
    "code": "import fmpService from '../fmpService.js';"
  },
  {
    "file": "src/services/ingestion/institutionalIngestionService.ts",
    "line": 4,
    "code": "class InstitutionalIngestionService {"
  },
  {
    "file": "src/services/ingestion/institutionalIngestionService.ts",
    "line": 7,
    "code": "const holders = await fmpService.getInstitutionalHolders(ticker);"
  },
  {
    "file": "src/services/ingestion/institutionalIngestionService.ts",
    "line": 10,
    "code": "source: `Institutional (${ticker})`,"
  },
  {
    "file": "src/services/ingestion/institutionalIngestionService.ts",
    "line": 16,
    "code": "return { success: false, source: 'Institutional', recordsProcessed: 0, timestamp: new Date().toISOSt"
  },
  {
    "file": "src/services/ingestion/institutionalIngestionService.ts",
    "line": 20,
    "code": "export default new InstitutionalIngestionService();"
  },
  {
    "file": "src/services/ingestion/newsIngestionService.ts",
    "line": 1,
    "code": "import fmpService from '../fmpService.js';"
  },
  {
    "file": "src/services/ingestion/newsIngestionService.ts",
    "line": 8,
    "code": "const news = await fmpService.getMarketNews(50);"
  },
  {
    "file": "src/services/ingestion/newsIngestionService.ts",
    "line": 11,
    "code": "return { success: true, source: 'News (FMP)', recordsProcessed: 0, timestamp: new Date().toISOString"
  },
  {
    "file": "src/services/ingestion/newsIngestionService.ts",
    "line": 28,
    "code": "n.site || 'FMP',"
  },
  {
    "file": "src/services/ingestion/newsIngestionService.ts",
    "line": 41,
    "code": "source: 'News (FMP)',"
  },
  {
    "file": "src/services/ingestion/optionsIngestionService.ts",
    "line": 1,
    "code": "import fmpService from '../fmpService.js';"
  },
  {
    "file": "src/services/ingestion/optionsIngestionService.ts",
    "line": 4,
    "code": "class OptionsIngestionService {"
  },
  {
    "file": "src/services/ingestion/optionsIngestionService.ts",
    "line": 7,
    "code": "const chain = await fmpService.getOptionChain(ticker);"
  },
  {
    "file": "src/services/ingestion/optionsIngestionService.ts",
    "line": 10,
    "code": "source: 'Options',"
  },
  {
    "file": "src/services/ingestion/optionsIngestionService.ts",
    "line": 16,
    "code": "return { success: false, source: 'Options', recordsProcessed: 0, timestamp: new Date().toISOString()"
  },
  {
    "file": "src/services/ingestion/optionsIngestionService.ts",
    "line": 20,
    "code": "export default new OptionsIngestionService();"
  },
  {
    "file": "src/services/insiderAccuracyService.ts",
    "line": 3,
    "code": "interface InsiderSignal {"
  },
  {
    "file": "src/services/insiderAccuracyService.ts",
    "line": 6,
    "code": "top_insider: string | null;"
  },
  {
    "file": "src/services/insiderAccuracyService.ts",
    "line": 7,
    "code": "top_insider_accuracy: number;"
  },
  {
    "file": "src/services/insiderAccuracyService.ts",
    "line": 12,
    "code": "class InsiderAccuracyService {"
  },
  {
    "file": "src/services/insiderAccuracyService.ts",
    "line": 14,
    "code": "async analyze(ticker: string): Promise<InsiderSignal> {"
  },
  {
    "file": "src/services/insiderAccuracyService.ts",
    "line": 16,
    "code": "const trades = await governmentDataAdapter.getInsiderTrades(ticker);"
  },
  {
    "file": "src/services/insiderAccuracyService.ts",
    "line": 22,
    "code": "top_insider: null,"
  },
  {
    "file": "src/services/insiderAccuracyService.ts",
    "line": 23,
    "code": "top_insider_accuracy: 0,"
  },
  {
    "file": "src/services/insiderAccuracyService.ts",
    "line": 25,
    "code": "details: ['No recent insider trades found']"
  },
  {
    "file": "src/services/insiderAccuracyService.ts",
    "line": 36,
    "code": "top_insider: buys.length > 0 ? buys[0].name : null,"
  },
  {
    "file": "src/services/insiderAccuracyService.ts",
    "line": 37,
    "code": "top_insider_accuracy: 0,"
  },
  {
    "file": "src/services/insiderAccuracyService.ts",
    "line": 39,
    "code": "details: [`${buys.length} insider buys detected`]"
  },
  {
    "file": "src/services/insiderAccuracyService.ts",
    "line": 46,
    "code": "top_insider: null,"
  },
  {
    "file": "src/services/insiderAccuracyService.ts",
    "line": 47,
    "code": "top_insider_accuracy: 0,"
  },
  {
    "file": "src/services/insiderAccuracyService.ts",
    "line": 55,
    "code": "export default new InsiderAccuracyService();"
  },
  {
    "file": "src/services/insiderIntentService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/insiderIntentService.ts",
    "line": 3,
    "code": "class InsiderIntentService {"
  },
  {
    "file": "src/services/insiderIntentService.ts",
    "line": 6,
    "code": "const trades = await fmpService.getInsiderTrades(ticker);"
  },
  {
    "file": "src/services/insiderIntentService.ts",
    "line": 24,
    "code": "insiders_involved: trades.slice(0,3).map((t:any) => t.reportingName)"
  },
  {
    "file": "src/services/insiderIntentService.ts",
    "line": 29,
    "code": "const quote = await fmpService.getPrice(ticker);"
  },
  {
    "file": "src/services/insiderIntentService.ts",
    "line": 30,
    "code": "const price = quote?.price || 0;"
  },
  {
    "file": "src/services/insiderIntentService.ts",
    "line": 31,
    "code": "const open = quote?.open || price;"
  },
  {
    "file": "src/services/insiderIntentService.ts",
    "line": 40,
    "code": "insiders_involved: []"
  },
  {
    "file": "src/services/insiderIntentService.ts",
    "line": 44,
    "code": "return { ticker, confidence: 0, classification: 'UNKNOWN', details: 'Error', signal_strength: 0, ins"
  },
  {
    "file": "src/services/insiderIntentService.ts",
    "line": 48,
    "code": "export default new InsiderIntentService();"
  },
  {
    "file": "src/services/insiderPatternEngine.ts",
    "line": 2,
    "code": "// Insider Pattern Engine (2025 Stable API Compatible)"
  },
  {
    "file": "src/services/insiderPatternEngine.ts",
    "line": 5,
    "code": "// Analyzes insider trades for patterns like:"
  },
  {
    "file": "src/services/insiderPatternEngine.ts",
    "line": 12,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/insiderPatternEngine.ts",
    "line": 14,
    "code": "class InsiderPatternEngine {"
  },
  {
    "file": "src/services/insiderPatternEngine.ts",
    "line": 17,
    "code": "const trades = await fmpService.getInsiderTrades(ticker);"
  },
  {
    "file": "src/services/insiderPatternEngine.ts",
    "line": 24,
    "code": "summary: 'No recent insider activity detected.',"
  },
  {
    "file": "src/services/insiderPatternEngine.ts",
    "line": 25,
    "code": "insiders: []"
  },
  {
    "file": "src/services/insiderPatternEngine.ts",
    "line": 29,
    "code": "// Extract metrics"
  },
  {
    "file": "src/services/insiderPatternEngine.ts",
    "line": 32,
    "code": "const insiders = new Set<string>();"
  },
  {
    "file": "src/services/insiderPatternEngine.ts",
    "line": 38,
    "code": "insiders.add(t.reportingName);"
  },
  {
    "file": "src/services/insiderPatternEngine.ts",
    "line": 60,
    "code": "summary: `Net insider flow: ${net} shares`,"
  },
  {
    "file": "src/services/insiderPatternEngine.ts",
    "line": 61,
    "code": "insiders: Array.from(insiders).slice(0, 10)"
  },
  {
    "file": "src/services/insiderPatternEngine.ts",
    "line": 69,
    "code": "summary: 'Error analyzing insider trades',"
  },
  {
    "file": "src/services/insiderPatternEngine.ts",
    "line": 70,
    "code": "insiders: []"
  },
  {
    "file": "src/services/insiderPatternEngine.ts",
    "line": 76,
    "code": "export default new InsiderPatternEngine();"
  },
  {
    "file": "src/services/insiderPatternService.ts",
    "line": 3,
    "code": "const FMP_KEY = process.env.FMP_API_KEY;"
  },
  {
    "file": "src/services/insiderPatternService.ts",
    "line": 5,
    "code": "interface InsiderBreak {"
  },
  {
    "file": "src/services/insiderPatternService.ts",
    "line": 13,
    "code": "class InsiderPatternService {"
  },
  {
    "file": "src/services/insiderPatternService.ts",
    "line": 15,
    "code": "async analyzePattern(ticker: string): Promise<InsiderBreak> {"
  },
  {
    "file": "src/services/insiderPatternService.ts",
    "line": 16,
    "code": "if (!FMP_KEY) return { is_break: false, pattern_type: 'NONE', confidence_boost: 0, reason: 'No API K"
  },
  {
    "file": "src/services/insiderPatternService.ts",
    "line": 19,
    "code": "// 1. Get Insider History (Last 100 transactions)"
  },
  {
    "file": "src/services/insiderPatternService.ts",
    "line": 20,
    "code": "const url = `https://financialmodelingprep.com/stable/insider-trading?symbol=${ticker}&limit=100&api"
  },
  {
    "file": "src/services/insiderPatternService.ts",
    "line": 49,
    "code": "reason: `CLUSTER BUY: ${buyers.size} unique insiders bought recently.`,"
  },
  {
    "file": "src/services/insiderPatternService.ts",
    "line": 84,
    "code": "details: `Insider sentiment shifting.`"
  },
  {
    "file": "src/services/insiderPatternService.ts",
    "line": 97,
    "code": "export default new InsiderPatternService();"
  },
  {
    "file": "src/services/institutionalFlowEngine.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/institutionalFlowEngine.ts",
    "line": 3,
    "code": "class InstitutionalFlowEngine {"
  },
  {
    "file": "src/services/institutionalFlowEngine.ts",
    "line": 6,
    "code": "const holders = await fmpService.getInstitutionalHolders(ticker);"
  },
  {
    "file": "src/services/institutionalFlowEngine.ts",
    "line": 20,
    "code": "const candles = await fmpService.getIntraday(ticker);"
  },
  {
    "file": "src/services/institutionalFlowEngine.ts",
    "line": 44,
    "code": "export default new InstitutionalFlowEngine();"
  },
  {
    "file": "src/services/institutionalFlowService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/institutionalFlowService.ts",
    "line": 11,
    "code": "class InstitutionalFlowService {"
  },
  {
    "file": "src/services/institutionalFlowService.ts",
    "line": 19,
    "code": "const quotes = await fmpService.getBatchPrices(this.SECTOR_ETFS);"
  },
  {
    "file": "src/services/institutionalFlowService.ts",
    "line": 21,
    "code": "if (!quotes || quotes.length === 0) return [];"
  },
  {
    "file": "src/services/institutionalFlowService.ts",
    "line": 25,
    "code": "const sorted = quotes"
  },
  {
    "file": "src/services/institutionalFlowService.ts",
    "line": 56,
    "code": "const quote = await fmpService.getPrice(ticker);"
  },
  {
    "file": "src/services/institutionalFlowService.ts",
    "line": 57,
    "code": "if (!quote) return null;"
  },
  {
    "file": "src/services/institutionalFlowService.ts",
    "line": 59,
    "code": "const profile = await fmpService.getCompanyProfile(ticker);"
  },
  {
    "file": "src/services/institutionalFlowService.ts",
    "line": 60,
    "code": "const avgVol = profile?.volAvg || 1000000;"
  },
  {
    "file": "src/services/institutionalFlowService.ts",
    "line": 63,
    "code": "if (quote.volume > avgVol * 1.5 && quote.changesPercentage > 0) {"
  },
  {
    "file": "src/services/institutionalFlowService.ts",
    "line": 68,
    "code": "reason: `High Volume Buying: ${((quote.volume / avgVol) * 100).toFixed(0)}% of avg volume`"
  },
  {
    "file": "src/services/institutionalFlowService.ts",
    "line": 78,
    "code": "export default new InstitutionalFlowService();"
  },
  {
    "file": "src/services/institutionalIntelligence.ts",
    "line": 3,
    "code": "interface InstitutionalData {"
  },
  {
    "file": "src/services/institutionalIntelligence.ts",
    "line": 13,
    "code": "class InstitutionalIntelligenceService {"
  },
  {
    "file": "src/services/institutionalIntelligence.ts",
    "line": 15,
    "code": "async fetchAll(): Promise<InstitutionalData[]> {"
  },
  {
    "file": "src/services/institutionalIntelligence.ts",
    "line": 16,
    "code": "// Cannot scan entire market institutionally in one go efficiently"
  },
  {
    "file": "src/services/institutionalIntelligence.ts",
    "line": 20,
    "code": "async getForTicker(ticker: string): Promise<InstitutionalData[]> {"
  },
  {
    "file": "src/services/institutionalIntelligence.ts",
    "line": 21,
    "code": "const holdings = await governmentDataAdapter.getInstitutionalHoldings(ticker);"
  },
  {
    "file": "src/services/institutionalIntelligence.ts",
    "line": 26,
    "code": "source: 'SEC/FMP',"
  },
  {
    "file": "src/services/institutionalIntelligence.ts",
    "line": 27,
    "code": "type: 'institutional_holding',"
  },
  {
    "file": "src/services/institutionalIntelligence.ts",
    "line": 43,
    "code": "export default new InstitutionalIntelligenceService();"
  },
  {
    "file": "src/services/institutionalOrderFlowService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/institutionalOrderFlowService.ts",
    "line": 6,
    "code": "metrics: {"
  },
  {
    "file": "src/services/institutionalOrderFlowService.ts",
    "line": 15,
    "code": "class InstitutionalOrderFlowService {"
  },
  {
    "file": "src/services/institutionalOrderFlowService.ts",
    "line": 18,
    "code": "* Analyzes intraday data to find institutional footprints."
  },
  {
    "file": "src/services/institutionalOrderFlowService.ts",
    "line": 23,
    "code": "const candles = await fmpService.getIntraday(ticker, '5min');"
  },
  {
    "file": "src/services/institutionalOrderFlowService.ts",
    "line": 28,
    "code": "// Note: FMP returns newest first usually"
  },
  {
    "file": "src/services/institutionalOrderFlowService.ts",
    "line": 69,
    "code": "// 4. Calculate Metrics"
  },
  {
    "file": "src/services/institutionalOrderFlowService.ts",
    "line": 103,
    "code": "metrics: {"
  },
  {
    "file": "src/services/institutionalOrderFlowService.ts",
    "line": 122,
    "code": "metrics: {"
  },
  {
    "file": "src/services/institutionalOrderFlowService.ts",
    "line": 133,
    "code": "export default new InstitutionalOrderFlowService();"
  },
  {
    "file": "src/services/ivNavigatorService.ts",
    "line": 3,
    "code": "const FMP_KEY = process.env.FMP_API_KEY;"
  },
  {
    "file": "src/services/ivNavigatorService.ts",
    "line": 5,
    "code": "interface IVMetrics {"
  },
  {
    "file": "src/services/ivNavigatorService.ts",
    "line": 17,
    "code": "async analyzeIV(ticker: string): Promise<IVMetrics> {"
  },
  {
    "file": "src/services/ivNavigatorService.ts",
    "line": 18,
    "code": "const result: IVMetrics = {"
  },
  {
    "file": "src/services/ivNavigatorService.ts",
    "line": 23,
    "code": "if (!FMP_KEY) return result;"
  },
  {
    "file": "src/services/ivNavigatorService.ts",
    "line": 26,
    "code": "// Using ATR as Volatility Proxy since real-time options chain is premium only"
  },
  {
    "file": "src/services/ivNavigatorService.ts",
    "line": 27,
    "code": "const url = `https://financialmodelingprep.com/stable/technical_indicator/1day/${ticker}?type=atr&pe"
  },
  {
    "file": "src/services/ivNavigatorService.ts",
    "line": 42,
    "code": "result.recommendation = 'Long Options viable.';"
  },
  {
    "file": "src/services/ivNavigatorService.ts",
    "line": 46,
    "code": "result.recommendation = 'Sell Premium / Avoid Long Options.';"
  },
  {
    "file": "src/services/liquidityTrapService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/liquidityTrapService.ts",
    "line": 7,
    "code": "metrics: {"
  },
  {
    "file": "src/services/liquidityTrapService.ts",
    "line": 23,
    "code": "// Skip strict checks for Crypto (different liquidity profile)"
  },
  {
    "file": "src/services/liquidityTrapService.ts",
    "line": 27,
    "code": "metrics: { marketCap: 0, avgVolume: 0, price: 0 }"
  },
  {
    "file": "src/services/liquidityTrapService.ts",
    "line": 32,
    "code": "const profile = await fmpService.getCompanyProfile(ticker);"
  },
  {
    "file": "src/services/liquidityTrapService.ts",
    "line": 35,
    "code": "if (!profile) {"
  },
  {
    "file": "src/services/liquidityTrapService.ts",
    "line": 38,
    "code": "metrics: { marketCap: 0, avgVolume: 0, price: 0 }"
  },
  {
    "file": "src/services/liquidityTrapService.ts",
    "line": 42,
    "code": "const mktCap = profile.mktCap || 0;"
  },
  {
    "file": "src/services/liquidityTrapService.ts",
    "line": 43,
    "code": "const avgVol = profile.volAvg || 0;"
  },
  {
    "file": "src/services/liquidityTrapService.ts",
    "line": 44,
    "code": "const price = profile.price || 0;"
  },
  {
    "file": "src/services/liquidityTrapService.ts",
    "line": 52,
    "code": "metrics: { marketCap: mktCap, avgVolume: avgVol, price }"
  },
  {
    "file": "src/services/liquidityTrapService.ts",
    "line": 61,
    "code": "metrics: { marketCap: mktCap, avgVolume: avgVol, price }"
  },
  {
    "file": "src/services/liquidityTrapService.ts",
    "line": 70,
    "code": "metrics: { marketCap: mktCap, avgVolume: avgVol, price }"
  },
  {
    "file": "src/services/liquidityTrapService.ts",
    "line": 74,
    "code": "// 4. Dollar Volume Check (Institutional Relevance)"
  },
  {
    "file": "src/services/liquidityTrapService.ts",
    "line": 79,
    "code": "metrics: { marketCap: mktCap, avgVolume: avgVol, price }"
  },
  {
    "file": "src/services/liquidityTrapService.ts",
    "line": 85,
    "code": "metrics: { marketCap: mktCap, avgVolume: avgVol, price }"
  },
  {
    "file": "src/services/liquidityTrapService.ts",
    "line": 91,
    "code": "metrics: { marketCap: 0, avgVolume: 0, price: 0 }"
  },
  {
    "file": "src/services/liveCorrelationPredictor.ts",
    "line": 95,
    "code": "FROM crypto_historical_prices"
  },
  {
    "file": "src/services/liveCorrelationPredictor.ts",
    "line": 131,
    "code": "const url = `https://api.coingecko.com/api/v3/simple/price?ids=${coinId}&vs_currencies=usd`;"
  },
  {
    "file": "src/services/liveCorrelationPredictor.ts",
    "line": 233,
    "code": "FROM stock_historical_prices"
  },
  {
    "file": "src/services/liveCorrelationPredictor.ts",
    "line": 246,
    "code": "console.log('üìä Updating pattern performance metrics...');"
  },
  {
    "file": "src/services/macroIntelligence.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/macroIntelligence.ts",
    "line": 17,
    "code": "this.fetchEconomicIndicators(),"
  },
  {
    "file": "src/services/macroIntelligence.ts",
    "line": 23,
    "code": "private async fetchEconomicIndicators(): Promise<MacroData[]> {"
  },
  {
    "file": "src/services/macroIntelligence.ts",
    "line": 25,
    "code": "const gdp = await fmpService.getEconomicIndicator('GDP');"
  },
  {
    "file": "src/services/macroIntelligence.ts",
    "line": 26,
    "code": "const cpi = await fmpService.getEconomicIndicator('CPI');"
  },
  {
    "file": "src/services/macroIntelligence.ts",
    "line": 32,
    "code": "source: 'FMP', type: 'macro_gdp', title: 'GDP Update',"
  },
  {
    "file": "src/services/macroIntelligence.ts",
    "line": 39,
    "code": "source: 'FMP', type: 'macro_cpi', title: 'CPI Inflation',"
  },
  {
    "file": "src/services/macroIntelligence.ts",
    "line": 52,
    "code": "const rates = await fmpService.getTreasuryRates();"
  },
  {
    "file": "src/services/macroIntelligence.ts",
    "line": 56,
    "code": "source: 'FMP',"
  },
  {
    "file": "src/services/macroLiquidityPulseEngine.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/macroLiquidityPulseEngine.ts",
    "line": 6,
    "code": "// Use Treasury as primary signal (always available via economic)"
  },
  {
    "file": "src/services/macroLiquidityPulseEngine.ts",
    "line": 7,
    "code": "const rates = await fmpService.getTreasuryRates();"
  },
  {
    "file": "src/services/macroLiquidityPulseEngine.ts",
    "line": 13,
    "code": "// FMP treasury format varies, look for 10Y"
  },
  {
    "file": "src/services/macroLiquidityPulseEngine.ts",
    "line": 25,
    "code": "const gdp = await fmpService.getEconomicData('GDP');"
  },
  {
    "file": "src/services/macroLiquidityService.ts",
    "line": 55,
    "code": "let trendDesc = \"Stable\";"
  },
  {
    "file": "src/services/macroRegimeService.ts",
    "line": 13,
    "code": "// console.log(\"   üåç Macro: Analyzing Economic Weather (via GMF)...\");"
  },
  {
    "file": "src/services/marketBreadthEngine.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/marketBreadthEngine.ts",
    "line": 7,
    "code": "metrics: { ad_ratio: number; sector_breadth: number; rsp_spy_divergence: number };"
  },
  {
    "file": "src/services/marketBreadthEngine.ts",
    "line": 15,
    "code": "const spy = await fmpService.getPrice('SPY');"
  },
  {
    "file": "src/services/marketBreadthEngine.ts",
    "line": 16,
    "code": "// We need change data. If getPrice is quote-short, it might not have change."
  },
  {
    "file": "src/services/marketBreadthEngine.ts",
    "line": 17,
    "code": "// FmpService polyfill sets change to 0 if missing."
  },
  {
    "file": "src/services/marketBreadthEngine.ts",
    "line": 18,
    "code": "// Let's try to get profile for price/changes"
  },
  {
    "file": "src/services/marketBreadthEngine.ts",
    "line": 19,
    "code": "const profile = await fmpService.getCompanyProfile('SPY');"
  },
  {
    "file": "src/services/marketBreadthEngine.ts",
    "line": 20,
    "code": "const change = profile && profile.changes ? profile.changes : 0;"
  },
  {
    "file": "src/services/marketBreadthEngine.ts",
    "line": 29,
    "code": "metrics: { ad_ratio: 1, sector_breadth: 50, rsp_spy_divergence: 0 },"
  },
  {
    "file": "src/services/marketBreadthEngine.ts",
    "line": 33,
    "code": "return { score: 0, regime: 'NEUTRAL', thrust_detected: false, metrics: {ad_ratio:0, sector_breadth:0"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 5,
    "code": "interface StockQuote {"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 16,
    "code": "private cache: Map<string, StockQuote> = new Map();"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 19,
    "code": "private getFmpKey(): string | undefined { return process.env.FMP_API_KEY; }"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 21,
    "code": "async getStockPrice(rawSymbol: string): Promise<StockQuote | null> {"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 32,
    "code": "let fmpSymbol = symbol;"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 37,
    "code": "fmpSymbol = `${clean}USD`;"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 41,
    "code": "let quote: StockQuote | null = null;"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 42,
    "code": "const fmpKey = this.getFmpKey();"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 44,
    "code": "// 2. FMP STABLE (Primary)"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 45,
    "code": "if (fmpKey) {"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 47,
    "code": "const url = `https://financialmodelingprep.com/stable/quote?symbol=${fmpSymbol}&apikey=${fmpKey}`;"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 52,
    "code": "quote = {"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 58,
    "code": "source: 'FMP',"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 66,
    "code": "if (!quote && !isCrypto) {"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 70,
    "code": "quote = {"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 84,
    "code": "if (!quote) {"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 88,
    "code": "quote = {"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 101,
    "code": "if (quote) {"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 102,
    "code": "this.cache.set(symbol, quote);"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 103,
    "code": "return quote;"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 113,
    "code": "const quote = await this.getStockPrice(s);"
  },
  {
    "file": "src/services/marketDataService.ts",
    "line": 114,
    "code": "if(quote) map.set(s, quote);"
  },
  {
    "file": "src/services/marketSentimentService.ts",
    "line": 1,
    "code": "interface SentimentProfile {"
  },
  {
    "file": "src/services/marketSentimentService.ts",
    "line": 5,
    "code": "metrics: {"
  },
  {
    "file": "src/services/marketSentimentService.ts",
    "line": 17,
    "code": "async getThermometer(): Promise<SentimentProfile> {"
  },
  {
    "file": "src/services/marketSentimentService.ts",
    "line": 18,
    "code": "// Real Logic: In production, fetch VIX and PCR from FMP/Tiingo"
  },
  {
    "file": "src/services/marketSentimentService.ts",
    "line": 24,
    "code": "metrics: {"
  },
  {
    "file": "src/services/masterIngestionService.ts",
    "line": 17,
    "code": "import { collectInsiderTrades } from './collectors/insiderCollector.js';"
  },
  {
    "file": "src/services/masterIngestionService.ts",
    "line": 31,
    "code": "const widgets = ['news','fmp','alpha','coingecko','fred','congress','whitehouse','tariff','social','"
  },
  {
    "file": "src/services/masterIngestionService.ts",
    "line": 48,
    "code": "await this.processSource('fmp', 'Market Data', collectApiData);"
  },
  {
    "file": "src/services/masterIngestionService.ts",
    "line": 56,
    "code": "await this.processSource('sec', 'SEC EDGAR', collectInsiderTrades);"
  },
  {
    "file": "src/services/metaLearning/evolutionLoopController.ts",
    "line": 8,
    "code": "import { historicalReplaySimulator } from './historicalReplaySimulator.js';"
  },
  {
    "file": "src/services/metaLearning/evolutionLoopController.ts",
    "line": 40,
    "code": "historicalReplaySimulator.simulate();"
  },
  {
    "file": "src/services/metaLearning/historicalReplaySimulator.ts",
    "line": 1,
    "code": "export const historicalReplaySimulator = {"
  },
  {
    "file": "src/services/metaLearning/memorySnapshotLogger.ts",
    "line": 5,
    "code": "INSERT INTO meta_learning_snapshots (active_biases, drift_metrics, created_at)"
  },
  {
    "file": "src/services/microstructureService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/microstructureService.ts",
    "line": 4,
    "code": "const FMP_KEY = process.env.FMP_API_KEY;"
  },
  {
    "file": "src/services/microstructureService.ts",
    "line": 6,
    "code": "interface MicroStructureMetrics {"
  },
  {
    "file": "src/services/microstructureService.ts",
    "line": 17,
    "code": "async scan(ticker: string): Promise<MicroStructureMetrics> {"
  },
  {
    "file": "src/services/microstructureService.ts",
    "line": 21,
    "code": "// 1. Get Real-Time Quote (Bid/Ask Size)"
  },
  {
    "file": "src/services/microstructureService.ts",
    "line": 23,
    "code": "const quoteRes = await axios.get(`https://financialmodelingprep.com/stable/quote/${ticker}?apikey=${"
  },
  {
    "file": "src/services/microstructureService.ts",
    "line": 24,
    "code": "const quote = quoteRes.data[0];"
  },
  {
    "file": "src/services/microstructureService.ts",
    "line": 26,
    "code": "if (!quote) throw new Error(\"No Quote Data\");"
  },
  {
    "file": "src/services/microstructureService.ts",
    "line": 29,
    "code": "const bidSize = quote.bidSize || 0;"
  },
  {
    "file": "src/services/microstructureService.ts",
    "line": 30,
    "code": "const askSize = quote.askSize || 0;"
  },
  {
    "file": "src/services/microstructureService.ts",
    "line": 40,
    "code": "const spread = quote.ask - quote.bid;"
  },
  {
    "file": "src/services/microstructureService.ts",
    "line": 41,
    "code": "const spreadPct = (spread / quote.price) * 100;"
  },
  {
    "file": "src/services/microstructureService.ts",
    "line": 46,
    "code": "const candles = await fmpService.getIntraday(ticker); // Should be 1min or 5min"
  },
  {
    "file": "src/services/momentumService.ts",
    "line": 1,
    "code": "import historicalDataService from './historicalDataService.js';"
  },
  {
    "file": "src/services/momentumService.ts",
    "line": 3,
    "code": "interface MomentumProfile {"
  },
  {
    "file": "src/services/momentumService.ts",
    "line": 16,
    "code": "async analyzeMomentum(ticker: string): Promise<MomentumProfile> {"
  },
  {
    "file": "src/services/momentumService.ts",
    "line": 18,
    "code": "// 1. Get Historical Data (Need 60+ days)"
  },
  {
    "file": "src/services/momentumService.ts",
    "line": 19,
    "code": "const history = await historicalDataService.getStockHistory(ticker, 70);"
  },
  {
    "file": "src/services/momentumService.ts",
    "line": 38,
    "code": "let alignment: MomentumProfile['alignment'] = 'MIXED';"
  },
  {
    "file": "src/services/multiAgentValidationService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/multiAgentValidationService.ts",
    "line": 38,
    "code": "const [profile, keyMetrics, technicals, news] = await Promise.all(["
  },
  {
    "file": "src/services/multiAgentValidationService.ts",
    "line": 39,
    "code": "fmpService.getCompanyProfile(ticker),"
  },
  {
    "file": "src/services/multiAgentValidationService.ts",
    "line": 40,
    "code": "fmpService.getCompleteFundamentals(ticker), // Includes ratios"
  },
  {
    "file": "src/services/multiAgentValidationService.ts",
    "line": 47,
    "code": "Price: ${profile?.price}"
  },
  {
    "file": "src/services/multiAgentValidationService.ts",
    "line": 56,
    "code": "P/E: ${keyMetrics?.ratios[0]?.peRatioTTM || 'N/A'}"
  },
  {
    "file": "src/services/multiAgentValidationService.ts",
    "line": 57,
    "code": "P/B: ${keyMetrics?.ratios[0]?.priceToBookRatioTTM || 'N/A'}"
  },
  {
    "file": "src/services/multiAgentValidationService.ts",
    "line": 58,
    "code": "Debt/Equity: ${keyMetrics?.ratios[0]?.debtEquityRatioTTM || 'N/A'}"
  },
  {
    "file": "src/services/multiAgentValidationService.ts",
    "line": 59,
    "code": "FCF Growth: ${keyMetrics?.cashFlow[0]?.freeCashFlow || 'N/A'}"
  },
  {
    "file": "src/services/multiAgentValidationService.ts",
    "line": 60,
    "code": "Sector: ${profile?.sector}"
  },
  {
    "file": "src/services/multiMarketArbitrageService.ts",
    "line": 39,
    "code": "const quotes = await marketDataService.getMultiplePrices(Array.from(allTickers));"
  },
  {
    "file": "src/services/multiMarketArbitrageService.ts",
    "line": 43,
    "code": "const driverQ = quotes.get(pair.driver);"
  },
  {
    "file": "src/services/multiMarketArbitrageService.ts",
    "line": 44,
    "code": "const targetQ = quotes.get(pair.target);"
  },
  {
    "file": "src/services/narrativePressureService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/narrativePressureService.ts",
    "line": 2,
    "code": "import { PressureMetrics } from '../types/intelligenceBundle.js';"
  },
  {
    "file": "src/services/narrativePressureService.ts",
    "line": 5,
    "code": "async calculatePressure(ticker: string): Promise<PressureMetrics> {"
  },
  {
    "file": "src/services/narrativePressureService.ts",
    "line": 6,
    "code": "const news = await fmpService.getCompanyNews(ticker);"
  },
  {
    "file": "src/services/narrativePressureService.ts",
    "line": 15,
    "code": "sources_breakdown: { social_velocity: 0, news_volume: score, political_heat: 0, institutional_urgenc"
  },
  {
    "file": "src/services/narrativePressureService.ts",
    "line": 20,
    "code": "const candles = await fmpService.getIntraday(ticker);"
  },
  {
    "file": "src/services/narrativePressureService.ts",
    "line": 34,
    "code": "sources_breakdown: { social_velocity: 0, news_volume: 0, political_heat: 0, institutional_urgency: M"
  },
  {
    "file": "src/services/narrativePressureService.ts",
    "line": 38,
    "code": "return { ticker, pressure_score: 0, regime: 'NORMAL', dominant_narrative: 'None', sources_breakdown:"
  },
  {
    "file": "src/services/narrativeSentimentService.ts",
    "line": 44,
    "code": "// 2. Deep Psychological Profile Prompt"
  },
  {
    "file": "src/services/neuralChatService.ts",
    "line": 3,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/neuralChatService.ts",
    "line": 59,
    "code": "const quote = await marketDataService.getStockPrice(ticker);"
  },
  {
    "file": "src/services/neuralChatService.ts",
    "line": 60,
    "code": "if (quote) context += `\\n[LIVE PRICE]: $${quote.price} (${quote.changePercent}%)\\n`;"
  },
  {
    "file": "src/services/neuralChatService.ts",
    "line": 92,
    "code": "- If discussing a specific stock, reference the specific \"Decision Matrix\" factors (e.g., \"I recomme"
  },
  {
    "file": "src/services/neuralChatService.ts",
    "line": 99,
    "code": "\"sources\": [\"List of engines used, e.g. 'Insider Anomaly', 'Macro Liquidity'\"],"
  },
  {
    "file": "src/services/optionsFlowIntelligenceEngine.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/optionsFlowIntelligenceEngine.ts",
    "line": 12,
    "code": "class OptionsFlowIntelligenceEngine {"
  },
  {
    "file": "src/services/optionsFlowIntelligenceEngine.ts",
    "line": 19,
    "code": "const chain = await fmpService.getOptionChain(ticker);"
  },
  {
    "file": "src/services/optionsFlowIntelligenceEngine.ts",
    "line": 48,
    "code": "// Metrics"
  },
  {
    "file": "src/services/optionsFlowIntelligenceEngine.ts",
    "line": 106,
    "code": "export default new OptionsFlowIntelligenceEngine();"
  },
  {
    "file": "src/services/optionsRadarService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/optionsRadarService.ts",
    "line": 3,
    "code": "interface OptionsAlert {"
  },
  {
    "file": "src/services/optionsRadarService.ts",
    "line": 11,
    "code": "class OptionsRadarService {"
  },
  {
    "file": "src/services/optionsRadarService.ts",
    "line": 13,
    "code": "// Scans for unusual options activity"
  },
  {
    "file": "src/services/optionsRadarService.ts",
    "line": 14,
    "code": "// FALLBACK: If no options data, scan for unusual PRICE/VOLUME activity (Proxy)"
  },
  {
    "file": "src/services/optionsRadarService.ts",
    "line": 15,
    "code": "async scanFlows(): Promise<OptionsAlert[]> {"
  },
  {
    "file": "src/services/optionsRadarService.ts",
    "line": 19,
    "code": "const quotes = await fmpService.getBatchPrices(universe);"
  },
  {
    "file": "src/services/optionsRadarService.ts",
    "line": 21,
    "code": "const alerts: OptionsAlert[] = [];"
  },
  {
    "file": "src/services/optionsRadarService.ts",
    "line": 23,
    "code": "quotes.forEach((q: any) => {"
  },
  {
    "file": "src/services/optionsRadarService.ts",
    "line": 31,
    "code": "details: `Heavy price movement (${q.changesPercentage}%) suggests options hedging`,"
  },
  {
    "file": "src/services/optionsRadarService.ts",
    "line": 44,
    "code": "async checkTicker(ticker: string): Promise<OptionsAlert | null> {"
  },
  {
    "file": "src/services/optionsRadarService.ts",
    "line": 49,
    "code": "export default new OptionsRadarService();"
  },
  {
    "file": "src/services/outlierDetectionService.ts",
    "line": 1,
    "code": "import historicalDataService from './historicalDataService.js';"
  },
  {
    "file": "src/services/outlierDetectionService.ts",
    "line": 19,
    "code": "const quote = await marketDataService.getStockPrice(ticker);"
  },
  {
    "file": "src/services/outlierDetectionService.ts",
    "line": 20,
    "code": "if (!quote) throw new Error(\"No live quote\");"
  },
  {
    "file": "src/services/outlierDetectionService.ts",
    "line": 22,
    "code": "// 2. Get Historical Baseline (30 Days)"
  },
  {
    "file": "src/services/outlierDetectionService.ts",
    "line": 23,
    "code": "const history = await historicalDataService.getStockHistory(ticker, 30);"
  },
  {
    "file": "src/services/outlierDetectionService.ts",
    "line": 28,
    "code": "// Need to ensure historical service returns volume, if not mock it for safety"
  },
  {
    "file": "src/services/outlierDetectionService.ts",
    "line": 29,
    "code": "// Actually, FMP history returns 'volume'. We need to make sure historicalDataService passes it."
  },
  {
    "file": "src/services/outlierDetectionService.ts",
    "line": 37,
    "code": "const currentMove = Math.abs(quote.changePercent);"
  },
  {
    "file": "src/services/outlierDetectionService.ts",
    "line": 38,
    "code": "// Historical moves (absolute)"
  },
  {
    "file": "src/services/outlierDetectionService.ts",
    "line": 39,
    "code": "const historicalMoves = returns.map(r => Math.abs(r * 100));"
  },
  {
    "file": "src/services/outlierDetectionService.ts",
    "line": 41,
    "code": "const zScore = TechnicalMath.calculateZScore(currentMove, historicalMoves);"
  },
  {
    "file": "src/services/pairsTradingService.ts",
    "line": 2,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/pairsTradingService.ts",
    "line": 44,
    "code": "const quotes = await marketDataService.getMultiplePrices(topHoldings);"
  },
  {
    "file": "src/services/pairsTradingService.ts",
    "line": 50,
    "code": "const quote = quotes.get(ticker);"
  },
  {
    "file": "src/services/pairsTradingService.ts",
    "line": 51,
    "code": "if (!quote) continue;"
  },
  {
    "file": "src/services/pairsTradingService.ts",
    "line": 60,
    "code": "const score = (rsi) + (quote.changePercent * 10);"
  },
  {
    "file": "src/services/pairsTradingService.ts",
    "line": 61,
    "code": "scored.push({ ticker, score, rsi, change: quote.changePercent });"
  },
  {
    "file": "src/services/paperTradingService.ts",
    "line": 53,
    "code": "const quote = await marketDataService.getStockPrice(signal.ticker);"
  },
  {
    "file": "src/services/paperTradingService.ts",
    "line": 54,
    "code": "if (!quote || quote.price <= 0) continue;"
  },
  {
    "file": "src/services/paperTradingService.ts",
    "line": 57,
    "code": "const shares = Math.floor(targetAmount / quote.price);"
  },
  {
    "file": "src/services/paperTradingService.ts",
    "line": 59,
    "code": "if (shares > 0 && parseFloat(portfolio.current_cash) >= (shares * quote.price)) {"
  },
  {
    "file": "src/services/paperTradingService.ts",
    "line": 60,
    "code": "console.log(`   üöÄ Executing BUY: ${signal.ticker} (${shares} shares @ $${quote.price})`);"
  },
  {
    "file": "src/services/paperTradingService.ts",
    "line": 66,
    "code": "price: quote.price,"
  },
  {
    "file": "src/services/paperTradingService.ts",
    "line": 90,
    "code": "const quote = await marketDataService.getStockPrice(pos.ticker);"
  },
  {
    "file": "src/services/paperTradingService.ts",
    "line": 91,
    "code": "if (!quote) continue;"
  },
  {
    "file": "src/services/paperTradingService.ts",
    "line": 93,
    "code": "const currentVal = parseFloat(pos.shares) * quote.price;"
  },
  {
    "file": "src/services/paperTradingService.ts",
    "line": 100,
    "code": "`, [quote.price, currentVal, pnl, pos.id]);"
  },
  {
    "file": "src/services/paperTradingService.ts",
    "line": 103,
    "code": "if (pos.stop_loss && quote.price < pos.stop_loss) exitReason = \"Stop Loss Hit\";"
  },
  {
    "file": "src/services/paperTradingService.ts",
    "line": 104,
    "code": "if (pos.target_price && quote.price > pos.target_price) exitReason = \"Target Hit\";"
  },
  {
    "file": "src/services/paperTradingService.ts",
    "line": 113,
    "code": "price: quote.price,"
  },
  {
    "file": "src/services/performanceAnalysisService.ts",
    "line": 40,
    "code": "successProfile: string;"
  },
  {
    "file": "src/services/performanceAnalysisService.ts",
    "line": 113,
    "code": "// Build success profile"
  },
  {
    "file": "src/services/performanceAnalysisService.ts",
    "line": 114,
    "code": "const successProfile = this.buildSuccessProfile(winnerPatterns, loserPatterns);"
  },
  {
    "file": "src/services/performanceAnalysisService.ts",
    "line": 145,
    "code": "successProfile,"
  },
  {
    "file": "src/services/performanceAnalysisService.ts",
    "line": 379,
    "code": "* Build success profile from patterns"
  },
  {
    "file": "src/services/performanceAnalysisService.ts",
    "line": 381,
    "code": "private buildSuccessProfile(winnerPatterns: string[], loserPatterns: string[]): string {"
  },
  {
    "file": "src/services/performanceAnalysisService.ts",
    "line": 382,
    "code": "const profile = ["
  },
  {
    "file": "src/services/performanceAnalysisService.ts",
    "line": 390,
    "code": "return profile.join('\\n');"
  },
  {
    "file": "src/services/performanceAnalysisService.ts",
    "line": 438,
    "code": "=== HISTORICAL PERFORMANCE ANALYSIS ==="
  },
  {
    "file": "src/services/portfolio.ts",
    "line": 5,
    "code": "* depend on futuresService margin / options / positions logic anymore."
  },
  {
    "file": "src/services/portfolio.ts",
    "line": 17,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/portfolio.ts",
    "line": 55,
    "code": "const prices = await fmpService.getBatchPrices(tickers);"
  },
  {
    "file": "src/services/portfolioIntelligenceEngine.ts",
    "line": 5,
    "code": "portfolio_metrics: {"
  },
  {
    "file": "src/services/portfolioIntelligenceEngine.ts",
    "line": 36,
    "code": "portfolio_metrics: {"
  },
  {
    "file": "src/services/portfolioIntelligenceEngine.ts",
    "line": 74,
    "code": "beta: bundle.engines.fsi.metrics?.beta || 1.0, // Assuming beta populated if available"
  },
  {
    "file": "src/services/portfolioIntelligenceEngine.ts",
    "line": 84,
    "code": "// 3. Calculate Portfolio Metrics (Real Math)"
  },
  {
    "file": "src/services/portfolioIntelligenceEngine.ts",
    "line": 113,
    "code": "portfolio_metrics: {"
  },
  {
    "file": "src/services/portfolioManagerService.ts",
    "line": 9,
    "code": "volatilityProfile: string"
  },
  {
    "file": "src/services/portfolioManagerService.ts",
    "line": 41,
    "code": "case 'insider_play':"
  },
  {
    "file": "src/services/portfolioManagerService.ts",
    "line": 47,
    "code": "if (volatilityProfile === 'High') {"
  },
  {
    "file": "src/services/portfolioManagerService.ts",
    "line": 55,
    "code": "const reason = `Kelly Score: ${kellyPct.toFixed(2)}. Capped at ${maxCap*100}%. Volatility: ${volatil"
  },
  {
    "file": "src/services/portfolioManagerService.ts",
    "line": 66,
    "code": "volatilityProfile: string"
  },
  {
    "file": "src/services/portfolioManagerService.ts",
    "line": 86,
    "code": "case 'insider_play':"
  },
  {
    "file": "src/services/portfolioManagerService.ts",
    "line": 93,
    "code": "if (volatilityProfile === 'High') {"
  },
  {
    "file": "src/services/portfolioManagerService.ts",
    "line": 96,
    "code": "} else if (volatilityProfile === 'Low') {"
  },
  {
    "file": "src/services/predictionReviewService.ts",
    "line": 43,
    "code": "const quote = await marketDataService.getStockPrice(pred.ticker);"
  },
  {
    "file": "src/services/predictionReviewService.ts",
    "line": 45,
    "code": "if (!quote) {"
  },
  {
    "file": "src/services/predictionReviewService.ts",
    "line": 50,
    "code": "const currentPrice = quote.price;"
  },
  {
    "file": "src/services/predictionReviewService.ts",
    "line": 57,
    "code": "// 2. Calculate Metrics"
  },
  {
    "file": "src/services/predictionReviewService.ts",
    "line": 62,
    "code": "// In production, we would query historical bars between pred.date_predicted and NOW()"
  },
  {
    "file": "src/services/priceService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/priceService.ts",
    "line": 19,
    "code": "const raw = await fmpService.getPrice(ticker);"
  },
  {
    "file": "src/services/priceService.ts",
    "line": 25,
    "code": "// Note: quote-short doesn't give change/changePercent."
  },
  {
    "file": "src/services/priceService.ts",
    "line": 26,
    "code": "// We can either fetch full quote or calculate if we have prev close."
  },
  {
    "file": "src/services/priceStabilityService.ts",
    "line": 1,
    "code": "import historicalDataService from './historicalDataService.js';"
  },
  {
    "file": "src/services/priceStabilityService.ts",
    "line": 4,
    "code": "interface StabilityMetrics {"
  },
  {
    "file": "src/services/priceStabilityService.ts",
    "line": 15,
    "code": "async analyzeStability(ticker: string): Promise<StabilityMetrics> {"
  },
  {
    "file": "src/services/priceStabilityService.ts",
    "line": 20,
    "code": "const history = await historicalDataService.getStockHistory(ticker, 30);"
  },
  {
    "file": "src/services/priceStabilityService.ts",
    "line": 42,
    "code": "let regime: StabilityMetrics['volatility_regime'] = 'CALM';"
  },
  {
    "file": "src/services/priceStabilityService.ts",
    "line": 52,
    "code": "let rec: StabilityMetrics['recommendation'] = 'ENTER';"
  },
  {
    "file": "src/services/priceStabilityService.ts",
    "line": 62,
    "code": "reason = `Stable Trend (Score: ${score.toFixed(0)}). Volatility is manageable.`;"
  },
  {
    "file": "src/services/priceUpdaterService.ts",
    "line": 28,
    "code": "const url = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${ticker}&apikey=${ALPHA"
  },
  {
    "file": "src/services/priceUpdaterService.ts",
    "line": 31,
    "code": "const quote = response.data['Global Quote'];"
  },
  {
    "file": "src/services/priceUpdaterService.ts",
    "line": 32,
    "code": "if (!quote || !quote['05. price']) {"
  },
  {
    "file": "src/services/priceUpdaterService.ts",
    "line": 37,
    "code": "const price = parseFloat(quote['05. price']);"
  },
  {
    "file": "src/services/realDataCollector.ts",
    "line": 2,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/realDataCollector.ts",
    "line": 20,
    "code": "const prices = await fmpService.getBatchPrices(batch);"
  },
  {
    "file": "src/services/realDataCollector.ts",
    "line": 26,
    "code": "// Real: Get actives from FMP"
  },
  {
    "file": "src/services/realDataCollector.ts",
    "line": 28,
    "code": "// Return top 10 from universe as \"Trending\" proxy until we add FMP /actives endpoint"
  },
  {
    "file": "src/services/realDataIntegrationService.ts",
    "line": 9,
    "code": "insiderTrades: any[];"
  },
  {
    "file": "src/services/realDataIntegrationService.ts",
    "line": 13,
    "code": "totalInsiderTrades: number;"
  },
  {
    "file": "src/services/realDataIntegrationService.ts",
    "line": 27,
    "code": "const [insiderTrades, socialSentiment] = await Promise.all(["
  },
  {
    "file": "src/services/realDataIntegrationService.ts",
    "line": 29,
    "code": "secEdgarService.getRecentInsiderTrades(30), // Reduced from 50 to 30"
  },
  {
    "file": "src/services/realDataIntegrationService.ts",
    "line": 44,
    "code": "const allTickers = this.extractUniqueTickers(insiderTrades, socialSentiment);"
  },
  {
    "file": "src/services/realDataIntegrationService.ts",
    "line": 64,
    "code": "totalInsiderTrades: insiderTrades.length,"
  },
  {
    "file": "src/services/realDataIntegrationService.ts",
    "line": 73,
    "code": "console.log(`   Insider Trades: ${insiderTrades.length}`);"
  },
  {
    "file": "src/services/realDataIntegrationService.ts",
    "line": 79,
    "code": "insiderTrades,"
  },
  {
    "file": "src/services/realDataIntegrationService.ts",
    "line": 90,
    "code": "insiderTrades: [],"
  },
  {
    "file": "src/services/realDataIntegrationService.ts",
    "line": 94,
    "code": "totalInsiderTrades: 0,"
  },
  {
    "file": "src/services/realDataIntegrationService.ts",
    "line": 129,
    "code": "const [insiderTrades, technical] = await Promise.all(["
  },
  {
    "file": "src/services/realDataIntegrationService.ts",
    "line": 131,
    "code": "secEdgarService.getInsiderTradesForTicker(ticker),"
  },
  {
    "file": "src/services/realDataIntegrationService.ts",
    "line": 149,
    "code": "insiderTrades,"
  },
  {
    "file": "src/services/realDataIntegrationService.ts",
    "line": 161,
    "code": "private extractUniqueTickers(insiderTrades: any[], socialSentiment: any[]): string[] {"
  },
  {
    "file": "src/services/realDataIntegrationService.ts",
    "line": 164,
    "code": "// Add tickers from insider trades"
  },
  {
    "file": "src/services/realDataIntegrationService.ts",
    "line": 165,
    "code": "insiderTrades.forEach(trade => {"
  },
  {
    "file": "src/services/realDataIntegrationService.ts",
    "line": 178,
    "code": "const aCount = insiderTrades.filter(t => t.ticker === a).length +"
  },
  {
    "file": "src/services/realDataIntegrationService.ts",
    "line": 180,
    "code": "const bCount = insiderTrades.filter(t => t.ticker === b).length +"
  },
  {
    "file": "src/services/realTimeFeedService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/realTimeFeedService.ts",
    "line": 15,
    "code": "vap_profile: { price_level: number; volume: number; intensity: number }[];"
  },
  {
    "file": "src/services/realTimeFeedService.ts",
    "line": 16,
    "code": "options_flow: {"
  },
  {
    "file": "src/services/realTimeFeedService.ts",
    "line": 27,
    "code": "const quote = await fmpService.getPrice(ticker);"
  },
  {
    "file": "src/services/realTimeFeedService.ts",
    "line": 28,
    "code": "if (!quote) return null;"
  },
  {
    "file": "src/services/realTimeFeedService.ts",
    "line": 36,
    "code": "price: quote.price,"
  },
  {
    "file": "src/services/realTimeFeedService.ts",
    "line": 37,
    "code": "bid: quote.price - 0.01, // Minimal spread assumption if missing"
  },
  {
    "file": "src/services/realTimeFeedService.ts",
    "line": 38,
    "code": "ask: quote.price + 0.01,"
  },
  {
    "file": "src/services/realTimeFeedService.ts",
    "line": 42,
    "code": "volume: quote.volume,"
  },
  {
    "file": "src/services/realTimeFeedService.ts",
    "line": 43,
    "code": "vwap: quote.price, // Fallback to price if VWAP missing"
  },
  {
    "file": "src/services/realTimeFeedService.ts",
    "line": 45,
    "code": "vap_profile: [],"
  },
  {
    "file": "src/services/realTimeFeedService.ts",
    "line": 46,
    "code": "options_flow: {"
  },
  {
    "file": "src/services/realityCheckService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/realityCheckService.ts",
    "line": 18,
    "code": "const candles = await fmpService.getIntraday(ticker);"
  },
  {
    "file": "src/services/recessionPredictorService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/recessionPredictorService.ts",
    "line": 5,
    "code": "interface RecessionMetrics {"
  },
  {
    "file": "src/services/recessionPredictorService.ts",
    "line": 19,
    "code": "async predictRecessionRisk(): Promise<RecessionMetrics> {"
  },
  {
    "file": "src/services/recessionPredictorService.ts",
    "line": 25,
    "code": "unemployment: \"Stable\","
  },
  {
    "file": "src/services/recessionPredictorService.ts",
    "line": 32,
    "code": "const treasury = await fmpService.getTreasuryRates();"
  },
  {
    "file": "src/services/recessionPredictorService.ts",
    "line": 50,
    "code": "const quotes = await marketDataService.getMultiplePrices(['HYG', 'IEF']);"
  },
  {
    "file": "src/services/recessionPredictorService.ts",
    "line": 51,
    "code": "const hyg = quotes.get('HYG');"
  },
  {
    "file": "src/services/recessionPredictorService.ts",
    "line": 52,
    "code": "const ief = quotes.get('IEF');"
  },
  {
    "file": "src/services/recessionPredictorService.ts",
    "line": 62,
    "code": "signals.credit_spreads = \"STABLE\";"
  },
  {
    "file": "src/services/recessionPredictorService.ts",
    "line": 66,
    "code": "// 3. ECONOMIC ACTIVITY (PMI)"
  },
  {
    "file": "src/services/recessionPredictorService.ts",
    "line": 67,
    "code": "// Using ISM Manufacturing PMI via FMP Economic Indicator"
  },
  {
    "file": "src/services/recessionPredictorService.ts",
    "line": 68,
    "code": "const pmiData = await fmpService.getEconomicIndicator('PMI');"
  },
  {
    "file": "src/services/recessionPredictorService.ts",
    "line": 84,
    "code": "const unrateData = await fmpService.getEconomicIndicator('Unemployment Rate');"
  },
  {
    "file": "src/services/recessionPredictorService.ts",
    "line": 98,
    "code": "signals.unemployment = `STABLE (${currentU3}%)`;"
  },
  {
    "file": "src/services/recessionPredictorService.ts",
    "line": 106,
    "code": "let regime: RecessionMetrics['regime'] = 'GROWTH';"
  },
  {
    "file": "src/services/regimeTransitionService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/regimeTransitionService.ts",
    "line": 5,
    "code": "transition_signal: 'STABLE' | 'TRANSITIONING' | 'VOLATILE';"
  },
  {
    "file": "src/services/regimeTransitionService.ts",
    "line": 8,
    "code": "metrics: {"
  },
  {
    "file": "src/services/regimeTransitionService.ts",
    "line": 9,
    "code": "inflation_trend: 'HEATING' | 'COOLING' | 'STABLE';"
  },
  {
    "file": "src/services/regimeTransitionService.ts",
    "line": 10,
    "code": "growth_trend: 'EXPANDING' | 'CONTRACTING' | 'STABLE';"
  },
  {
    "file": "src/services/regimeTransitionService.ts",
    "line": 21,
    "code": "// console.log(`      üß≠ Macro: Detecting Economic Regime...`);"
  },
  {
    "file": "src/services/regimeTransitionService.ts",
    "line": 26,
    "code": "fmpService.getEconomicIndicator('CPI'),"
  },
  {
    "file": "src/services/regimeTransitionService.ts",
    "line": 27,
    "code": "fmpService.getEconomicIndicator('GDP'), // Or PMI if available"
  },
  {
    "file": "src/services/regimeTransitionService.ts",
    "line": 28,
    "code": "fmpService.getTreasuryRates()"
  },
  {
    "file": "src/services/regimeTransitionService.ts",
    "line": 32,
    "code": "let inflationTrend: 'HEATING' | 'COOLING' | 'STABLE' = 'STABLE';"
  },
  {
    "file": "src/services/regimeTransitionService.ts",
    "line": 43,
    "code": "let growthTrend: 'EXPANDING' | 'CONTRACTING' | 'STABLE' = 'STABLE';"
  },
  {
    "file": "src/services/regimeTransitionService.ts",
    "line": 61,
    "code": "if (growthTrend === 'EXPANDING' || growthTrend === 'STABLE') {"
  },
  {
    "file": "src/services/regimeTransitionService.ts",
    "line": 62,
    "code": "if (inflationTrend === 'COOLING' || inflationTrend === 'STABLE') {"
  },
  {
    "file": "src/services/regimeTransitionService.ts",
    "line": 85,
    "code": "let transition = 'STABLE';"
  },
  {
    "file": "src/services/regimeTransitionService.ts",
    "line": 102,
    "code": "metrics: {"
  },
  {
    "file": "src/services/regimeTransitionService.ts",
    "line": 115,
    "code": "current_regime: 'GOLDILOCKS', transition_signal: 'STABLE', next_likely_regime: 'SAME',"
  },
  {
    "file": "src/services/regimeTransitionService.ts",
    "line": 116,
    "code": "probability: 50, metrics: { inflation_trend: 'STABLE', growth_trend: 'STABLE', yield_curve_slope: 0 "
  },
  {
    "file": "src/services/researchAgentService.ts",
    "line": 24,
    "code": "ai_summary ILIKE '%insider%' OR ai_summary ILIKE '%fda%' OR"
  },
  {
    "file": "src/services/researchAgentService.ts",
    "line": 73,
    "code": "INSERT INTO historical_events (event, event_date, event_type, description, affected_sectors, recover"
  },
  {
    "file": "src/services/retailInterpretabilityService.ts",
    "line": 19,
    "code": "// 1. WHALE / INSTITUTIONAL"
  },
  {
    "file": "src/services/retailInterpretabilityService.ts",
    "line": 26,
    "code": "// 2. INSIDER ACTIVITY"
  },
  {
    "file": "src/services/retailInterpretabilityService.ts",
    "line": 27,
    "code": "if (engines.insider === 'OPPORTUNISTIC' || engines.insider === 'COORDINATED') {"
  },
  {
    "file": "src/services/retailInterpretabilityService.ts",
    "line": 28,
    "code": "badges.push({ id: 'insider_buy', label: 'Insiders Buying', icon: 'üèõÔ∏è', color: 'green', description:"
  },
  {
    "file": "src/services/retailInterpretabilityService.ts",
    "line": 46,
    "code": "badges.push({ id: 'pinned', label: 'Stable', icon: 'üõ°Ô∏è', color: 'gray', description: 'Price is stuc"
  },
  {
    "file": "src/services/retailInterpretabilityService.ts",
    "line": 62,
    "code": "// Reason 1: Insiders"
  },
  {
    "file": "src/services/retailInterpretabilityService.ts",
    "line": 63,
    "code": "if (engines.insider === 'OPPORTUNISTIC' || engines.insider_intent?.classification === 'OPPORTUNISTIC"
  },
  {
    "file": "src/services/reversalTrapService.ts",
    "line": 3,
    "code": "import historicalDataService from './historicalDataService.js';"
  },
  {
    "file": "src/services/reversalTrapService.ts",
    "line": 6,
    "code": "interface TrapMetrics {"
  },
  {
    "file": "src/services/reversalTrapService.ts",
    "line": 16,
    "code": "private cache: Record<string, TrapMetrics> = {};"
  },
  {
    "file": "src/services/reversalTrapService.ts",
    "line": 19,
    "code": "async analyzeTrapRisk(ticker: string, volatilityRegime: string = 'NORMAL'): Promise<TrapMetrics> {"
  },
  {
    "file": "src/services/reversalTrapService.ts",
    "line": 37,
    "code": "const hist = await historicalDataService.getStockHistory(ticker, 30);"
  },
  {
    "file": "src/services/reverseArbitrageService.ts",
    "line": 17,
    "code": "const quotes = await marketDataService.getMultiplePrices(['BTC-USD', 'COIN']);"
  },
  {
    "file": "src/services/reverseArbitrageService.ts",
    "line": 18,
    "code": "if (quotes.get('BTC-USD') && quotes.get('COIN')) {"
  },
  {
    "file": "src/services/reverseCorrelationService.ts",
    "line": 32,
    "code": "const driverQuotes = await marketDataService.getMultiplePrices(drivers);"
  },
  {
    "file": "src/services/reverseCorrelationService.ts",
    "line": 34,
    "code": "const targetQuotes = await marketDataService.getMultiplePrices(targets.map(t => t + '-USD'));"
  },
  {
    "file": "src/services/reverseCorrelationService.ts",
    "line": 38,
    "code": "const dQuote = driverQuotes.get(p.driver_asset);"
  },
  {
    "file": "src/services/reverseCorrelationService.ts",
    "line": 42,
    "code": "if (!targetQuotes.has(tTicker)) tTicker = p.target_asset + '-USD';"
  },
  {
    "file": "src/services/reverseCorrelationService.ts",
    "line": 43,
    "code": "const tQuote = targetQuotes.get(tTicker);"
  },
  {
    "file": "src/services/reverseCorrelationService.ts",
    "line": 45,
    "code": "if (dQuote && tQuote) {"
  },
  {
    "file": "src/services/reverseCorrelationService.ts",
    "line": 47,
    "code": "const dMove = dQuote.changePercent; // e.g. +2.5%"
  },
  {
    "file": "src/services/reverseCorrelationService.ts",
    "line": 48,
    "code": "const tMove = tQuote.changePercent; // e.g. +0.5%"
  },
  {
    "file": "src/services/reverseScannerService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/reverseScannerService.ts",
    "line": 13,
    "code": "type: string; // 'EARNINGS', 'CONTRACT', 'REGULATION', 'INSIDER', 'MACRO', 'NONE'"
  },
  {
    "file": "src/services/reverseScannerService.ts",
    "line": 26,
    "code": "const [news, profile, gov, insider] = await Promise.all(["
  },
  {
    "file": "src/services/reverseScannerService.ts",
    "line": 28,
    "code": "fmpService.getCompanyProfile(ticker),"
  },
  {
    "file": "src/services/reverseScannerService.ts",
    "line": 30,
    "code": "fmpService.getInsiderFeed() // We filter this list in memory for speed"
  },
  {
    "file": "src/services/reverseScannerService.ts",
    "line": 33,
    "code": "// Filter insider for specific ticker"
  },
  {
    "file": "src/services/reverseScannerService.ts",
    "line": 34,
    "code": "const specificInsider = insider.filter((t: any) => t.symbol === ticker);"
  },
  {
    "file": "src/services/reverseScannerService.ts",
    "line": 38,
    "code": "PROFILE: ${profile?.companyName || ticker}, Sector: ${profile?.sector}"
  },
  {
    "file": "src/services/reverseScannerService.ts",
    "line": 45,
    "code": "INSIDER TRADING:"
  },
  {
    "file": "src/services/reverseScannerService.ts",
    "line": 46,
    "code": "${specificInsider.map((i: any) => `- ${i.reportingName} ${i.transactionType} ${i.securitiesTransacte"
  },
  {
    "file": "src/services/reverseScannerService.ts",
    "line": 62,
    "code": "- Massive Insider Buy/Sell"
  },
  {
    "file": "src/services/revisionVelocityService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/revisionVelocityService.ts",
    "line": 3,
    "code": "interface RevisionMetrics {"
  },
  {
    "file": "src/services/revisionVelocityService.ts",
    "line": 6,
    "code": "upgrade_momentum: 'ACCELERATING' | 'STABLE' | 'DECELERATING';"
  },
  {
    "file": "src/services/revisionVelocityService.ts",
    "line": 15,
    "code": "async analyzeVelocity(ticker: string): Promise<RevisionMetrics> {"
  },
  {
    "file": "src/services/revisionVelocityService.ts",
    "line": 18,
    "code": "const result: RevisionMetrics = {"
  },
  {
    "file": "src/services/revisionVelocityService.ts",
    "line": 21,
    "code": "upgrade_momentum: 'STABLE',"
  },
  {
    "file": "src/services/revisionVelocityService.ts",
    "line": 29,
    "code": "// 1. Get Price Targets History (using existing FMP service)"
  },
  {
    "file": "src/services/revisionVelocityService.ts",
    "line": 30,
    "code": "// FMP usually returns current, but we can infer trend from 'upgrades_downgrades' endpoint if availa"
  },
  {
    "file": "src/services/revisionVelocityService.ts",
    "line": 35,
    "code": "const estimates = await fmpService.getAnalystEstimates(ticker); // Returns array if modified in prev"
  },
  {
    "file": "src/services/revisionVelocityService.ts",
    "line": 36,
    "code": "// Actually fmpService.getAnalystEstimates returns a SINGLE object in current implementation (limit="
  },
  {
    "file": "src/services/revisionVelocityService.ts",
    "line": 41,
    "code": "const changes = await (fmpService as any).getUpgradesDowngrades?.(ticker); // We will add this to FM"
  },
  {
    "file": "src/services/revisionVelocityService.ts",
    "line": 71,
    "code": "result.reason = \"Analyst consensus is stable.\";"
  },
  {
    "file": "src/services/riskConstraintService.ts",
    "line": 2,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/riskConstraintService.ts",
    "line": 27,
    "code": "// 1. Get New Asset Profile"
  },
  {
    "file": "src/services/riskConstraintService.ts",
    "line": 28,
    "code": "const profile = await fmpService.getCompanyProfile(ticker);"
  },
  {
    "file": "src/services/riskConstraintService.ts",
    "line": 29,
    "code": "if (!profile) return this.defaultPass(ticker); // If unknown, pass with caution"
  },
  {
    "file": "src/services/riskConstraintService.ts",
    "line": 31,
    "code": "const newSector = profile.sector || 'Unknown';"
  },
  {
    "file": "src/services/riskConstraintService.ts",
    "line": 32,
    "code": "const newBeta = Number(profile?.beta || 1.5);"
  },
  {
    "file": "src/services/riskConstraintService.ts",
    "line": 42,
    "code": "// Calculate Portfolio Metrics"
  },
  {
    "file": "src/services/riskValidatorService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/riskValidatorService.ts",
    "line": 16,
    "code": "const ratios = await fmpService.getFinancialRatios(ticker, 'annual', 1);"
  },
  {
    "file": "src/services/riskValidatorService.ts",
    "line": 19,
    "code": "const rsiData = await fmpService.getRSI(ticker);"
  },
  {
    "file": "src/services/schemaHarmonizerService.ts",
    "line": 20,
    "code": "await this.ensureColumn(client, 'ai_stock_tips', 'insider_data', 'JSONB');"
  },
  {
    "file": "src/services/schemaHarmonizerService.ts",
    "line": 22,
    "code": "await this.ensureColumn(client, 'ai_stock_tips', 'volatility_profile', 'VARCHAR(20)');"
  },
  {
    "file": "src/services/schemaHarmonizerService.ts",
    "line": 61,
    "code": "historical_precedent JSONB,"
  },
  {
    "file": "src/services/scoringWeightsMatrix.ts",
    "line": 9,
    "code": "insider: 0.10,   // Insider Activity"
  },
  {
    "file": "src/services/scoringWeightsMatrix.ts",
    "line": 10,
    "code": "gamma: 0.10,     // Options Gamma"
  },
  {
    "file": "src/services/scoringWeightsMatrix.ts",
    "line": 14,
    "code": "ife: 0.05,       // Institutional Flow"
  },
  {
    "file": "src/services/scoringWeightsMatrix.ts",
    "line": 16,
    "code": "seasonality: 0.05 // Historical Trend"
  },
  {
    "file": "src/services/seasonalityEngine.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/seasonalityEngine.ts",
    "line": 6,
    "code": "const history = await fmpService.getDailyCandles(ticker, 100);"
  },
  {
    "file": "src/services/secEdgarService.ts",
    "line": 3,
    "code": "interface InsiderTrade {"
  },
  {
    "file": "src/services/secEdgarService.ts",
    "line": 7,
    "code": "insider: string;"
  },
  {
    "file": "src/services/secEdgarService.ts",
    "line": 19,
    "code": "async getRecentInsiderTrades(limit = 20): Promise<InsiderTrade[]> {"
  },
  {
    "file": "src/services/secEdgarService.ts",
    "line": 24,
    "code": "// Map to InsiderTrade if needed"
  },
  {
    "file": "src/services/secEdgarService.ts",
    "line": 31,
    "code": "async getInsiderTradesForTicker(ticker: string) {"
  },
  {
    "file": "src/services/sectorCorrelationService.ts",
    "line": 1,
    "code": "import historicalDataService from './historicalDataService.js';"
  },
  {
    "file": "src/services/sectorCorrelationService.ts",
    "line": 34,
    "code": "const spyHist = await historicalDataService.getStockHistory('SPY', 60); // 60 Days"
  },
  {
    "file": "src/services/sectorCorrelationService.ts",
    "line": 41,
    "code": "const sectHist = await historicalDataService.getStockHistory(sector, 60);"
  },
  {
    "file": "src/services/sectorDiscoveryService.ts",
    "line": 3,
    "code": "const FMP_KEY = process.env.FMP_API_KEY;"
  },
  {
    "file": "src/services/sectorDiscoveryService.ts",
    "line": 4,
    "code": "const FMP_BASE = 'https://financialmodelingprep.com/stable';"
  },
  {
    "file": "src/services/sectorDiscoveryService.ts",
    "line": 64,
    "code": "if (!FMP_KEY) return;"
  },
  {
    "file": "src/services/sectorDiscoveryService.ts",
    "line": 68,
    "code": "const res = await axios.get(`${FMP_BASE}/sp500_constituent?apikey=${FMP_KEY}`);"
  },
  {
    "file": "src/services/sectorDiscoveryService.ts",
    "line": 76,
    "code": "const res = await axios.get(`${FMP_BASE}/stock_market/actives?apikey=${FMP_KEY}`);"
  },
  {
    "file": "src/services/sectorDiscoveryService.ts",
    "line": 86,
    "code": "const res = await axios.get(`${FMP_BASE}/etf-holder/${etf}?apikey=${FMP_KEY}`);"
  },
  {
    "file": "src/services/sectorStressService.ts",
    "line": 35,
    "code": "const spyQuote = await marketDataService.getStockPrice('SPY');"
  },
  {
    "file": "src/services/sectorStressService.ts",
    "line": 36,
    "code": "const spyChange = spyQuote?.changePercent || 0;"
  },
  {
    "file": "src/services/sectorStressService.ts",
    "line": 40,
    "code": "const quotes = await marketDataService.getMultiplePrices(tickers);"
  },
  {
    "file": "src/services/sectorStressService.ts",
    "line": 43,
    "code": "const quote = quotes.get(sector.ticker);"
  },
  {
    "file": "src/services/sectorStressService.ts",
    "line": 44,
    "code": "if (!quote) continue;"
  },
  {
    "file": "src/services/sectorStressService.ts",
    "line": 47,
    "code": "const relPerf = quote.changePercent - spyChange;"
  },
  {
    "file": "src/services/sectorStressService.ts",
    "line": 48,
    "code": "const absMove = Math.abs(quote.changePercent);"
  },
  {
    "file": "src/services/sectorStressService.ts",
    "line": 74,
    "code": "reason: `${sector.ticker} ${quote.changePercent > 0 ? 'Up' : 'Down'} ${Math.abs(quote.changePercent)"
  },
  {
    "file": "src/services/selfImprovementService.ts",
    "line": 42,
    "code": "if (drift.status !== 'STABLE') {"
  },
  {
    "file": "src/services/shadowLiquidityService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/shadowLiquidityService.ts",
    "line": 6,
    "code": "const intraday = await fmpService.getIntraday(ticker);"
  },
  {
    "file": "src/services/shortTrapService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/signalGeneratorService.ts",
    "line": 105,
    "code": "volatility_profile, allocation_pct, decision_matrix, phfa_data, sector)"
  },
  {
    "file": "src/services/signalGeneratorService.ts",
    "line": 114,
    "code": "bundle.price_data.volatility_profile,"
  },
  {
    "file": "src/services/sipeLearningService.ts",
    "line": 22,
    "code": "// Normalize sector string (FMP sector names can vary slightly)"
  },
  {
    "file": "src/services/sipeLearningService.ts",
    "line": 50,
    "code": "// Complex Query to calc performance metrics"
  },
  {
    "file": "src/services/smartMoneyHeatmapService.ts",
    "line": 1,
    "code": "import institutionalFlowService from './institutionalFlowService.js';"
  },
  {
    "file": "src/services/smartMoneyHeatmapService.ts",
    "line": 6,
    "code": "institutional_activity: 'High' | 'Medium' | 'Low';"
  },
  {
    "file": "src/services/smartMoneyHeatmapService.ts",
    "line": 15,
    "code": "options_whales: any[];"
  },
  {
    "file": "src/services/smartMoneyHeatmapService.ts",
    "line": 23,
    "code": "const flows = await institutionalFlowService.scanFlows();"
  },
  {
    "file": "src/services/smartMoneyHeatmapService.ts",
    "line": 33,
    "code": "options_whales: [],"
  },
  {
    "file": "src/services/smartMoneyService.ts",
    "line": 2,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/smartMoneyService.ts",
    "line": 28,
    "code": "console.log('      üë£ Smart Money: Scanning Institutional Footprints...');"
  },
  {
    "file": "src/services/smartMoneyService.ts",
    "line": 67,
    "code": "const quotes = await marketDataService.getMultiplePrices(watchlist);"
  },
  {
    "file": "src/services/smartMoneyService.ts",
    "line": 69,
    "code": "for (const [ticker, quote] of quotes.entries()) {"
  },
  {
    "file": "src/services/smartMoneyService.ts",
    "line": 70,
    "code": "const profile = await fmpService.getCompanyProfile(ticker);"
  },
  {
    "file": "src/services/smartMoneyService.ts",
    "line": 71,
    "code": "const avgVol = profile?.volAvg || 1000000;"
  },
  {
    "file": "src/services/smartMoneyService.ts",
    "line": 73,
    "code": "if (quote.volume > avgVol * 2.5 && Math.abs(quote.changePercent) < 1.0) {"
  },
  {
    "file": "src/services/smartMoneyService.ts",
    "line": 78,
    "code": "details: `Stealth Accumulation: Volume ${((quote.volume/avgVol)).toFixed(1)}x avg, but price flat.`"
  },
  {
    "file": "src/services/smartMoneyService.ts",
    "line": 88,
    "code": "const quotes = await marketDataService.getMultiplePrices(sectors);"
  },
  {
    "file": "src/services/smartMoneyService.ts",
    "line": 90,
    "code": ".map(s => ({ t: s, q: quotes.get(s) }))"
  },
  {
    "file": "src/services/smcwLearningService.ts",
    "line": 2,
    "code": "import economicCalendarService from './economicCalendarService.js';"
  },
  {
    "file": "src/services/smcwLearningService.ts",
    "line": 4,
    "code": "interface SeasonalProfile {"
  },
  {
    "file": "src/services/smcwLearningService.ts",
    "line": 9,
    "code": "historical_win_rate: number;"
  },
  {
    "file": "src/services/smcwLearningService.ts",
    "line": 16,
    "code": "private cache: SeasonalProfile | null = null;"
  },
  {
    "file": "src/services/smcwLearningService.ts",
    "line": 19,
    "code": "async getCurrentSeasonality(): Promise<SeasonalProfile> {"
  },
  {
    "file": "src/services/smcwLearningService.ts",
    "line": 28,
    "code": "// Simple check for now, ideally check economic_events table for 'Fed Interest Rate'"
  },
  {
    "file": "src/services/smcwLearningService.ts",
    "line": 29,
    "code": "const events = await economicCalendarService.getUpcomingEventsContext();"
  },
  {
    "file": "src/services/smcwLearningService.ts",
    "line": 36,
    "code": "// Fetch Profile"
  },
  {
    "file": "src/services/smcwLearningService.ts",
    "line": 51,
    "code": "const profile: SeasonalProfile = {"
  },
  {
    "file": "src/services/smcwLearningService.ts",
    "line": 56,
    "code": "historical_win_rate: parseFloat(data.avg_win_rate),"
  },
  {
    "file": "src/services/smcwLearningService.ts",
    "line": 61,
    "code": "this.cache = profile;"
  },
  {
    "file": "src/services/smcwLearningService.ts",
    "line": 63,
    "code": "return profile;"
  },
  {
    "file": "src/services/smcwLearningService.ts",
    "line": 66,
    "code": "return { month: 'UNK', is_fomc: false, is_earnings: false, confidence_modifier: 1.0, historical_win_"
  },
  {
    "file": "src/services/sourceGuardService.ts",
    "line": 3,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/sourceGuardService.ts",
    "line": 5,
    "code": "const STABLE_BASE = 'https://financialmodelingprep.com/stable';"
  },
  {
    "file": "src/services/sourceGuardService.ts",
    "line": 22,
    "code": "// 1. CHECK FMP STABLE"
  },
  {
    "file": "src/services/sourceGuardService.ts",
    "line": 23,
    "code": "const fmpStart = Date.now();"
  },
  {
    "file": "src/services/sourceGuardService.ts",
    "line": 26,
    "code": "const q = await fmpService.getPrice('AAPL');"
  },
  {
    "file": "src/services/sourceGuardService.ts",
    "line": 29,
    "code": "source: 'FMP Stable',"
  },
  {
    "file": "src/services/sourceGuardService.ts",
    "line": 31,
    "code": "latency_ms: Date.now() - fmpStart,"
  },
  {
    "file": "src/services/sourceGuardService.ts",
    "line": 36,
    "code": "source: 'FMP Stable',"
  },
  {
    "file": "src/services/sourceGuardService.ts",
    "line": 38,
    "code": "latency_ms: Date.now() - fmpStart,"
  },
  {
    "file": "src/services/sourceGuardService.ts",
    "line": 45,
    "code": "source: 'FMP Stable',"
  },
  {
    "file": "src/services/sourceGuardService.ts",
    "line": 47,
    "code": "latency_ms: Date.now() - fmpStart,"
  },
  {
    "file": "src/services/storyModeService.ts",
    "line": 36,
    "code": "OUTPUT: Just the story string. No quotes."
  },
  {
    "file": "src/services/supplyChainStressEngine.ts",
    "line": 3,
    "code": "// Static Healthy baseline as FMP doesn't have supply chain data"
  },
  {
    "file": "src/services/supplyChainStressEngine.ts",
    "line": 7,
    "code": "components: { pmi: 52, logistics_performance: 60, ppi_trend: 'STABLE' },"
  },
  {
    "file": "src/services/systemStabilityService.ts",
    "line": 13,
    "code": "status: 'STABLE' | 'COMPROMISED' | 'CRITICAL';"
  },
  {
    "file": "src/services/systemStabilityService.ts",
    "line": 25,
    "code": "'services/marketDataService.ts', 'services/fmpService.ts', 'services/tiingoService.ts',"
  },
  {
    "file": "src/services/systemStabilityService.ts",
    "line": 28,
    "code": "'services/catalystHunterService.ts', 'services/titanHunterService.ts', 'services/insiderPatternServi"
  },
  {
    "file": "src/services/systemStabilityService.ts",
    "line": 42,
    "code": "'historical_events': ['affected_sectors', 'recovery_pattern'],"
  },
  {
    "file": "src/services/systemStabilityService.ts",
    "line": 52,
    "code": "status: 'STABLE',"
  },
  {
    "file": "src/services/systemStabilityService.ts",
    "line": 83,
    "code": "if (!['fmpService', 'tiingoService', 'yahooFinanceService', 'lazarusService'].includes(serviceName))"
  },
  {
    "file": "src/services/technicalAnalysis.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/technicalAnalysis.ts",
    "line": 44,
    "code": "const hist = await fmpService.getDailyCandles(ticker, 200);"
  },
  {
    "file": "src/services/technicalAnalysis.ts",
    "line": 66,
    "code": "const hist = await fmpService.getDailyCandles(ticker, 40);"
  },
  {
    "file": "src/services/technicalIndicatorsService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/technicalIndicatorsService.ts",
    "line": 10,
    "code": "momentumProfile?: 'High' | 'Medium' | 'Low';"
  },
  {
    "file": "src/services/technicalIndicatorsService.ts",
    "line": 19,
    "code": "fmpService.getRSI(ticker),"
  },
  {
    "file": "src/services/technicalIndicatorsService.ts",
    "line": 20,
    "code": "fmpService.getSMA(ticker, 50),"
  },
  {
    "file": "src/services/technicalIndicatorsService.ts",
    "line": 21,
    "code": "fmpService.getSMA(ticker, 200)"
  },
  {
    "file": "src/services/tickerUniverseService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/tickerUniverseService.ts",
    "line": 16,
    "code": "console.log('[UNIVERSE] Refreshing dynamic universe from FMP Stable...');"
  },
  {
    "file": "src/services/tickerUniverseService.ts",
    "line": 18,
    "code": "// Uses /stable/sp500_constituents"
  },
  {
    "file": "src/services/tickerUniverseService.ts",
    "line": 19,
    "code": "const rawData = await fmpService.getSP500List();"
  },
  {
    "file": "src/services/tiingoService.ts",
    "line": 35,
    "code": "// --- STRESS TESTING METRICS ---"
  },
  {
    "file": "src/services/tiingoService.ts",
    "line": 36,
    "code": "async getStressMetrics(ticker: string): Promise<{ beta: number; maxDrawdown: number } | null> {"
  },
  {
    "file": "src/services/titanHunterService.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/titanHunterService.ts",
    "line": 19,
    "code": "console.log('   üèõÔ∏è  Titan Hunter: Scanning Institutional Portfolios...');"
  },
  {
    "file": "src/services/titanHunterService.ts",
    "line": 35,
    "code": "// Filter out obvious noise/indices if possible, but FMP usually gives tickers"
  },
  {
    "file": "src/services/titanHunterService.ts",
    "line": 36,
    "code": "if (stock.tickbum) { // FMP often returns 'tickbum' or 'symbol'"
  },
  {
    "file": "src/services/titanHunterService.ts",
    "line": 46,
    "code": "reason: `[Titan Conviction] Top holding of ${fund.name}. Institutional validation.`,"
  },
  {
    "file": "src/services/titanHunterService.ts",
    "line": 47,
    "code": "category: \"Institutional\""
  },
  {
    "file": "src/services/titanHunterService.ts",
    "line": 72,
    "code": "console.log(`      -> Titan Hunter identified ${finalResults.length} institutional picks.`);"
  },
  {
    "file": "src/services/tradeArchitectService.ts",
    "line": 27,
    "code": "volProfile: 'High' | 'Medium' | 'Low',"
  },
  {
    "file": "src/services/tradeArchitectService.ts",
    "line": 36,
    "code": "const insider = engines.insider?.classification || 'UNKNOWN';"
  },
  {
    "file": "src/services/tradeArchitectService.ts",
    "line": 49,
    "code": "const dsc = await drawdownSensitivityService.getRiskProfile(tier);"
  },
  {
    "file": "src/services/tradeArchitectService.ts",
    "line": 53,
    "code": "if (volProfile === 'High') volatilityPct = 0.08;"
  },
  {
    "file": "src/services/tradeArchitectService.ts",
    "line": 54,
    "code": "if (volProfile === 'Low') volatilityPct = 0.02;"
  },
  {
    "file": "src/services/tradeArchitectService.ts",
    "line": 96,
    "code": "let baseAlloc = portfolioManagerService.calculateAllocation(tier, confidence, volProfile);"
  },
  {
    "file": "src/services/tradeArchitectService.ts",
    "line": 99,
    "code": "if (insider === 'OPPORTUNISTIC' || insider === 'COORDINATED') allocPct = Math.min(allocPct * 1.25, 1"
  },
  {
    "file": "src/services/tradeArchitectService.ts",
    "line": 122,
    "code": "Risk Profile: ${volProfile} Vol. DSC Drawdown Protection: ${dsc.stop_loss_modifier}x."
  },
  {
    "file": "src/services/tradeArchitectService.ts",
    "line": 123,
    "code": "Edge: ${insider === 'OPPORTUNISTIC' ? 'Insider Alignment' : 'Statistical Reversion'}."
  },
  {
    "file": "src/services/tribunalService.ts",
    "line": 3,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/tribunalService.ts",
    "line": 28,
    "code": "const [profile, news, technicals] = await Promise.all(["
  },
  {
    "file": "src/services/tribunalService.ts",
    "line": 29,
    "code": "fmpService.getCompanyProfile(ticker),"
  },
  {
    "file": "src/services/tribunalService.ts",
    "line": 31,
    "code": "fmpService.getRSI(ticker)"
  },
  {
    "file": "src/services/tribunalService.ts",
    "line": 35,
    "code": "if (!profile) {"
  },
  {
    "file": "src/services/tribunalService.ts",
    "line": 36,
    "code": "return this.getMistrial(ticker, \"Insufficient Evidence (Profile Missing)\");"
  },
  {
    "file": "src/services/tribunalService.ts",
    "line": 40,
    "code": "TICKER: ${ticker} (${profile.companyName})"
  },
  {
    "file": "src/services/tribunalService.ts",
    "line": 41,
    "code": "PRICE: ${profile.price} (Beta: ${profile.beta})"
  },
  {
    "file": "src/services/tribunalService.ts",
    "line": 42,
    "code": "SECTOR: ${profile.sector}"
  },
  {
    "file": "src/services/unifiedIntelligenceEngine.ts",
    "line": 18,
    "code": "historical_precedent?: any;"
  },
  {
    "file": "src/services/unifiedIntelligenceEngine.ts",
    "line": 49,
    "code": "data_sources: ['Binance', 'FMP'],"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 9,
    "code": "import insiderIntentService from './insiderIntentService.js';"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 18,
    "code": "import institutionalFlowEngine from './institutionalFlowEngine.js';"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 20,
    "code": "import unusualOptionsEngine from './unusualOptionsEngine.js';"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 67,
    "code": "const insider = await safeRun('Insider', insiderIntentService.analyzeIntent(ticker),"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 68,
    "code": "{ ticker, confidence: 0, classification: 'UNKNOWN', details: 'No data', signal_strength: 0, insiders"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 74,
    "code": "{ ticker, pressure_score: 0, regime: 'NORMAL', dominant_narrative: 'None', sources_breakdown: {socia"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 82,
    "code": "const instFlow = await safeRun('InstFlow', institutionalFlowEngine.analyzeFlows(ticker),"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 88,
    "code": "const uoa = await safeRun('UOA', unusualOptionsEngine.analyze(ticker),"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 89,
    "code": "{ ticker, score: 0, sentiment: 'NEUTRAL', metrics: { call_put_ratio: 0, net_premium_flow:0, iv_rank:"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 98,
    "code": "{ score: 0, valuation_band: 'FAIR', fair_value: 0, upside_percent: 0, metrics: { pe_ratio:0, peg_rat"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 104,
    "code": "{ score: 0, regime: 'NEUTRAL', thrust_detected: false, metrics: {ad_ratio:0,sector_breadth:0,rsp_spy"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 107,
    "code": "{ regime: 'NORMAL', metrics: { vix: 0, atr_pct: 0, hv_30: 0 }, adaptations: { stop_loss_multiplier: "
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 123,
    "code": "insider: insider.confidence,"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 137,
    "code": "let volProfile: 'High' | 'Medium' | 'Low' = 'Medium';"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 138,
    "code": "if (volSurf.regime === 'HIGH_FEAR' || (vre.metrics.vix > 30)) volProfile = 'High';"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 139,
    "code": "else if (volSurf.regime === 'COMPRESSED' || (vre.metrics.vix < 12 && vre.metrics.vix > 0)) volProfil"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 142,
    "code": "ticker, priceData.price, scoringResult.final_score, volProfile, scoringResult.confidence_tier as any"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 149,
    "code": "price_data: { current: priceData.price, open: priceData.price, volatility_profile: volProfile },"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 151,
    "code": "fsi: merge({ score: fsi.overallScore, traffic_light: fsi.overallStatus === 'APPROVED' ? 'GREEN' : fs"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 162,
    "code": "iat: merge({ score: 0, alpha: 0, top_insider: null, validity: 'NEUTRAL', details: [] }, insider),"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 176,
    "code": "dve: merge({ score: dve.score, band: dve.valuation_band as any, fair_value: dve.fair_value, upside: "
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 177,
    "code": "ipe: merge({ score: insider.signal_strength, classification: insider.classification as any, cluster:"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 179,
    "code": "vre: merge({ regime: vre.regime as any, factors: { stop_mult: vre.adaptations.stop_loss_multiplier, "
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 183,
    "code": "insider: merge({ classification: insider.classification, score: insider.confidence }, insider),"
  },
  {
    "file": "src/services/unifiedIntelligenceFactory.ts",
    "line": 189,
    "code": "volatility: { regime: volSurf.regime, vix_level: vre.metrics.vix || 0 },"
  },
  {
    "file": "src/services/unusualOptionsEngine.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/unusualOptionsEngine.ts",
    "line": 3,
    "code": "class UnusualOptionsEngine {"
  },
  {
    "file": "src/services/unusualOptionsEngine.ts",
    "line": 7,
    "code": "// FMP Quote-Short gives us volume"
  },
  {
    "file": "src/services/unusualOptionsEngine.ts",
    "line": 8,
    "code": "const quote = await fmpService.getPrice(ticker);"
  },
  {
    "file": "src/services/unusualOptionsEngine.ts",
    "line": 10,
    "code": "// We need average volume to detect spike. Quote-Short doesn't have avgVolume."
  },
  {
    "file": "src/services/unusualOptionsEngine.ts",
    "line": 11,
    "code": "// Try profile."
  },
  {
    "file": "src/services/unusualOptionsEngine.ts",
    "line": 12,
    "code": "const profile = await fmpService.getCompanyProfile(ticker);"
  },
  {
    "file": "src/services/unusualOptionsEngine.ts",
    "line": 13,
    "code": "const avgVol = profile?.volAvg || 1000000;"
  },
  {
    "file": "src/services/unusualOptionsEngine.ts",
    "line": 14,
    "code": "const vol = quote?.volume || 0;"
  },
  {
    "file": "src/services/unusualOptionsEngine.ts",
    "line": 25,
    "code": "metrics: {"
  },
  {
    "file": "src/services/unusualOptionsEngine.ts",
    "line": 36,
    "code": "return { ticker, score: 0, sentiment: s, metrics: { call_put_ratio: 0, net_premium_flow:0, iv_rank:0"
  },
  {
    "file": "src/services/unusualOptionsEngine.ts",
    "line": 40,
    "code": "export default new UnusualOptionsEngine();"
  },
  {
    "file": "src/services/volatilityNormalizerService.ts",
    "line": 15,
    "code": "// Using Yahoo/FMP fallback logic in marketDataService for indices"
  },
  {
    "file": "src/services/volatilityNormalizerService.ts",
    "line": 18,
    "code": "const quote = await marketDataService.getStockPrice('^VIX');"
  },
  {
    "file": "src/services/volatilityNormalizerService.ts",
    "line": 19,
    "code": "if (quote && quote.price > 0) {"
  },
  {
    "file": "src/services/volatilityNormalizerService.ts",
    "line": 20,
    "code": "vix = quote.price;"
  },
  {
    "file": "src/services/volatilityNormalizerService.ts",
    "line": 25,
    "code": "const quote = await marketDataService.getStockPrice('VIX');"
  },
  {
    "file": "src/services/volatilityNormalizerService.ts",
    "line": 26,
    "code": "if (quote && quote.price > 0) vix = quote.price;"
  },
  {
    "file": "src/services/volatilityRegimeEngine.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/volatilityRegimeEngine.ts",
    "line": 5,
    "code": "metrics: {"
  },
  {
    "file": "src/services/volatilityRegimeEngine.ts",
    "line": 20,
    "code": "// FmpService now has a getDailyCandles polyfill that falls back to intraday"
  },
  {
    "file": "src/services/volatilityRegimeEngine.ts",
    "line": 21,
    "code": "const candles = await fmpService.getDailyCandles(ticker, 20);"
  },
  {
    "file": "src/services/volatilityRegimeEngine.ts",
    "line": 24,
    "code": "return { regime: 'NORMAL', metrics: { vix: 0, atr_pct: 0, hv_30: 0 }, adaptations: { stop_loss_multi"
  },
  {
    "file": "src/services/volatilityRegimeEngine.ts",
    "line": 40,
    "code": "metrics: { vix: 0, atr_pct: parseFloat(volPct.toFixed(2)), hv_30: 0 },"
  },
  {
    "file": "src/services/volatilityRegimeEngine.ts",
    "line": 44,
    "code": "return { regime: 'NORMAL', metrics: { vix: 0, atr_pct: 0, hv_30: 0 }, adaptations: { stop_loss_multi"
  },
  {
    "file": "src/services/volatilityShockAwarenessService.ts",
    "line": 4,
    "code": "interface VSAMetrics {"
  },
  {
    "file": "src/services/volatilityShockAwarenessService.ts",
    "line": 14,
    "code": "private cache: VSAMetrics | null = null;"
  },
  {
    "file": "src/services/volatilityShockAwarenessService.ts",
    "line": 18,
    "code": "* Get current VSA metrics based on live VIX"
  },
  {
    "file": "src/services/volatilityShockAwarenessService.ts",
    "line": 20,
    "code": "async getMarketCondition(): Promise<VSAMetrics> {"
  },
  {
    "file": "src/services/volatilityShockAwarenessService.ts",
    "line": 28,
    "code": "const quote = await marketDataService.getStockPrice('^VIX');"
  },
  {
    "file": "src/services/volatilityShockAwarenessService.ts",
    "line": 29,
    "code": "if (quote) vix = quote.price;"
  },
  {
    "file": "src/services/volatilityShockAwarenessService.ts",
    "line": 33,
    "code": "let regime: VSAMetrics['regime'] = 'NORMAL';"
  },
  {
    "file": "src/services/volatilityShockAwarenessService.ts",
    "line": 50,
    "code": "const metrics: VSAMetrics = {"
  },
  {
    "file": "src/services/volatilityShockAwarenessService.ts",
    "line": 55,
    "code": "reason: `VIX ${vix.toFixed(1)} (${regime}). System historical win-rate in this regime adjusts confid"
  },
  {
    "file": "src/services/volatilityShockAwarenessService.ts",
    "line": 58,
    "code": "this.cache = metrics;"
  },
  {
    "file": "src/services/volatilityShockAwarenessService.ts",
    "line": 61,
    "code": "return metrics;"
  },
  {
    "file": "src/services/volatilityShockAwarenessService.ts",
    "line": 74,
    "code": "// This would query past trades joined with historical VIX levels"
  },
  {
    "file": "src/services/volatilitySurfaceEngine.ts",
    "line": 1,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/volatilitySurfaceEngine.ts",
    "line": 7,
    "code": "const candles = await fmpService.getDailyCandles(ticker, 14);"
  },
  {
    "file": "src/services/wdiwaAttributionService.ts",
    "line": 8,
    "code": "insider: number;"
  },
  {
    "file": "src/services/wdiwaAttributionService.ts",
    "line": 68,
    "code": "insider: 0, gamma: 0, narrative: 0, fsi: 0"
  },
  {
    "file": "src/services/wdiwaAttributionService.ts",
    "line": 81,
    "code": "if (signals.insider?.classification === 'OPPORTUNISTIC') scores.insider++;"
  },
  {
    "file": "src/services/wdiwaAttributionService.ts",
    "line": 137,
    "code": "insider: 1.0, gamma: 1.0, narrative: 1.0, fsi: 1.0"
  },
  {
    "file": "src/services/whaleContrarianService.ts",
    "line": 2,
    "code": "import institutionalFlowService from './institutionalFlowService.js';"
  },
  {
    "file": "src/services/whaleContrarianService.ts",
    "line": 3,
    "code": "import fmpService from './fmpService.js';"
  },
  {
    "file": "src/services/whaleContrarianService.ts",
    "line": 28,
    "code": "// 2. Get Institutional Flow (The Whales)"
  },
  {
    "file": "src/services/whaleContrarianService.ts",
    "line": 29,
    "code": "const flow = await institutionalFlowService.checkAccumulation(ticker);"
  },
  {
    "file": "src/services/whaleContrarianService.ts",
    "line": 48,
    "code": "const quote = await fmpService.getPrice(ticker);"
  },
  {
    "file": "src/services/whaleContrarianService.ts",
    "line": 49,
    "code": "if (quote && quote.changePercent < 0) {"
  },
  {
    "file": "src/services/yahooFinanceService.ts",
    "line": 4,
    "code": "// Uses the stable query2 API instead of scraping HTML"
  },
  {
    "file": "src/services/yahooFinanceService.ts",
    "line": 13,
    "code": "const url = `https://query2.finance.yahoo.com/v8/finance/quote?symbols=${symbol}`;"
  },
  {
    "file": "src/services/yahooFinanceService.ts",
    "line": 22,
    "code": "const result = res.data?.quoteResponse?.result?.[0];"
  },
  {
    "file": "src/services/yahooScraper.ts",
    "line": 15,
    "code": "const response = await axios.get(`https://finance.yahoo.com/quote/${ticker}`, {"
  },
  {
    "file": "src/types/intelligenceBundle.ts",
    "line": 3,
    "code": "export interface PressureMetrics {"
  },
  {
    "file": "src/types/intelligenceBundle.ts",
    "line": 12,
    "code": "institutional_urgency: number;"
  },
  {
    "file": "src/types/intelligenceBundle.ts",
    "line": 33,
    "code": "volatility_profile: 'High' | 'Medium' | 'Low';"
  },
  {
    "file": "src/types/intelligenceBundle.ts",
    "line": 37,
    "code": "fsi: { score: number; traffic_light: 'RED' | 'YELLOW' | 'GREEN'; details: any; metrics?: any };"
  },
  {
    "file": "src/types/intelligenceBundle.ts",
    "line": 48,
    "code": "iat: { score: number; alpha: number; top_insider: string | null; validity: 'HIGH_VALUE' | 'NOISE' | "
  },
  {
    "file": "src/types/intelligenceBundle.ts",
    "line": 54,
    "code": "dve: { score: number; band: 'DEEP_VALUE' | 'UNDERVALUED' | 'FAIR' | 'OVERVALUED' | 'BUBBLE'; fair_va"
  },
  {
    "file": "src/types/intelligenceBundle.ts",
    "line": 58,
    "code": "uoa: { score: number; sentiment: 'BULLISH' | 'BEARISH' | 'NEUTRAL'; metrics: { call_put_ratio: numbe"
  },
  {
    "file": "src/types/intelligenceBundle.ts",
    "line": 61,
    "code": "insider: { classification: string; score: number };"
  },
  {
    "file": "src/utils/uiResponseAdapter.ts",
    "line": 48,
    "code": "insider: bundle.engines?.insider?.score || 0"
  }
]
